{"version":3,"file":"WGtJDJfe.js","sources":["../../../../../../src/lib/utils/uplugin.ts"],"sourcesContent":["import { Validator } from '@cfworker/json-schema';\nimport { API_BASE } from '$lib/core';\n\nlet resolver;\nconst uPluginValidator = new Promise<Validator>((r) => (resolver = r));\n\nfetch(API_BASE + '/static/uplugin-json-schema.json')\n  .then((response) => response.json())\n  .then((json) => resolver(new Validator(json)));\n\nconst resolveValue = (object: unknown, path: string) => {\n  const parser = new RegExp(`\\\\['?(.+?)'?\\\\]|\\\\.([^\\\\.\\\\[\\\\]]+)`, `gm`);\n\n  try {\n    let value = object;\n    let key = parser.exec(path);\n    while (key !== null) {\n      value = value[key[1] || key[2]];\n      key = parser.exec(path);\n    }\n    return value;\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  } catch (e) {\n    // Ignore exception\n  }\n\n  return undefined;\n};\n\nexport const validateUPluginJson = async (input: string): Promise<string[]> => {\n  const validator = await uPluginValidator;\n\n  try {\n    const objInput = JSON.parse(input);\n    const result = validator.validate(objInput);\n\n    if (result.valid) {\n      return [];\n    }\n\n    return result.errors\n      .map((error) => {\n        if (error.keyword === '$ref') {\n          return undefined;\n        }\n\n        let message = '`' + error.instanceLocation + '`';\n\n        const value = resolveValue(objInput, error.instanceLocation);\n\n        if (typeof value !== 'object') {\n          message += ' **\"' + value + '\"**';\n        }\n\n        message += ': ' + error.error;\n\n        return message;\n      })\n      .filter((v) => !!v);\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  } catch (e) {\n    return ['Invalid JSON'];\n  }\n};\n"],"names":["resolver","uPluginValidator","r","API_BASE","response","json","Validator","resolveValue","object","path","parser","value","key","validateUPluginJson","input","validator","objInput","result","error","message","v"],"mappings":"gHAGA,IAAIA,EACJ,MAAMC,EAAmB,IAAI,QAAoBC,GAAOF,EAAWE,CAAE,EAErE,MAAMC,EAAW,kCAAkC,EAChD,KAAMC,GAAaA,EAAS,KAAA,CAAM,EAClC,KAAMC,GAASL,EAAS,IAAIM,EAAUD,CAAI,CAAC,CAAC,EAE/C,MAAME,EAAe,CAACC,EAAiBC,IAAiB,CACtD,MAAMC,EAAS,IAAI,OAAO,qCAAsC,IAAI,EAEpE,GAAI,CACF,IAAIC,EAAQH,EACRI,EAAMF,EAAO,KAAKD,CAAI,EAC1B,KAAOG,IAAQ,MACbD,EAAQA,EAAMC,EAAI,CAAC,GAAKA,EAAI,CAAC,CAAC,EAC9BA,EAAMF,EAAO,KAAKD,CAAI,EAExB,OAAOE,CAET,MAAY,CAEZ,CAGF,EAEaE,EAAsB,MAAOC,GAAqC,CAC7E,MAAMC,EAAY,MAAMd,EAExB,GAAI,CACF,MAAMe,EAAW,KAAK,MAAMF,CAAK,EAC3BG,EAASF,EAAU,SAASC,CAAQ,EAE1C,OAAIC,EAAO,MACF,CAAA,EAGFA,EAAO,OACX,IAAKC,GAAU,CACd,GAAIA,EAAM,UAAY,OACpB,OAGF,IAAIC,EAAU,IAAMD,EAAM,iBAAmB,IAE7C,MAAMP,EAAQJ,EAAaS,EAAUE,EAAM,gBAAgB,EAE3D,OAAI,OAAOP,GAAU,WACnBQ,GAAW,OAASR,EAAQ,OAG9BQ,GAAW,KAAOD,EAAM,MAEjBC,CACT,CAAC,EACA,OAAQC,GAAM,CAAC,CAACA,CAAC,CAEtB,MAAY,CACV,MAAO,CAAC,cAAc,CACxB,CACF"}
{"version":3,"file":"lP3m-nn-.js","sources":["../../../../../../src/lib/models/mods.ts","../../../../../../src/lib/components/mods/ModAuthor.svelte","../../../../../../src/lib/components/mods/ModForm.svelte"],"sourcesContent":["import * as zod from 'zod';\nimport type { CompatibilityState, Tag } from '$lib/generated';\n\nexport type ModData = {\n  name: string;\n  mod_reference: string;\n  short_description: string;\n  full_description?: string;\n  logo?: string;\n  source_url?: string;\n  authors?: {\n    role: string;\n    user_id: string;\n  }[];\n  compatibility?: {\n    EA: {\n      state: CompatibilityState;\n      note?: string;\n    };\n    EXP: {\n      state: CompatibilityState;\n      note?: string;\n    };\n  };\n  hidden: boolean;\n  tagIDs?: string[];\n  tags?: Tag[];\n};\n\nexport const modSchema = zod.object({\n  name: zod.string().min(3).max(32),\n  mod_reference: zod\n    .string()\n    .min(3)\n    .max(32)\n    .regex(/^([a-zA-Z][a-zA-Z0-9_]*)$/)\n    .refine(\n      async () =>\n        // TODO Check if mod reference exists\n        true\n    ),\n  short_description: zod.string().min(16).max(128),\n  full_description: zod.optional(zod.string()),\n  logo: zod.optional(zod.any().refine((logo) => 'name' in logo && 'size' in logo && 'type' in logo)),\n  source_url: zod.string().url().optional().or(zod.literal('')),\n  authors: zod.optional(\n    zod\n      .object({\n        role: zod.string(),\n        user_id: zod.string()\n      })\n      .array()\n  ),\n  compatibility: zod.optional(\n    zod.object({\n      EA: zod.object({\n        state: zod.string(),\n        note: zod.optional(zod.string())\n      }),\n      EXP: zod.object({\n        state: zod.string(),\n        note: zod.optional(zod.string())\n      })\n    })\n  ),\n  hidden: zod.boolean(),\n  tagIDs: zod.optional(zod.string().array())\n});\n","<script lang=\"ts\">\n  import { queryStore, getContextClient } from '@urql/svelte';\n  import { GetUserDocument } from '$lib/generated';\n  import { getTranslate } from '@tolgee/svelte';\n  import UserDisplay from '$lib/components/users/UserDisplay.svelte';\n\n  interface Props {\n    id: string;\n  }\n\n  let { id }: Props = $props();\n\n  export const { t } = getTranslate();\n\n  const client = getContextClient();\n\n  let user = $derived(\n    queryStore({\n      query: GetUserDocument,\n      client,\n      variables: { user: id }\n    })\n  );\n</script>\n\n{#if $user.fetching}\n  <p class=\"mr-2\">{$t('loading')}...</p>\n{:else if $user.error}\n  <p class=\"mr-2\">{$t('error.oh-no')}... {$user.error.message}</p>\n{:else if $user.data.getUser}\n  <div class=\"mr-2\">\n    <UserDisplay\n      user={{ id: $user.data.getUser.id, username: $user.data.getUser.username, avatar: $user.data.getUser.avatar }}\n      size=\"small\"\n      showLink={false}\n      gap=\"small\" />\n  </div>\n{:else}\n  <p class=\"mr-2 whitespace-nowrap\">Unknown User ID</p>\n{/if}\n","<script lang=\"ts\">\n  import { run } from 'svelte/legacy';\n\n  import { createForm } from 'felte';\n  import { validator } from '@felte/validator-zod';\n  import { reporter } from '@felte/reporter-svelte';\n  import type { ModData } from '$lib/models/mods';\n  import { modSchema } from '$lib/models/mods';\n  import { trimNonSchema } from '$lib/utils/forms';\n  import ModAuthor from '$lib/components/mods/ModAuthor.svelte';\n  import TagList from '$lib/components/utils/TagList.svelte';\n  import { CompatibilityState } from '$lib/generated';\n  import ModCompatibility from '$lib/components/mods/compatibility/ModCompatibilityEdit.svelte';\n  import { getTranslate } from '@tolgee/svelte';\n  import { Switch } from '@skeletonlabs/skeleton-svelte';\n  import FormField from '$lib/components/forms/FormField.svelte';\n  import FormMarkdownField from '$lib/components/forms/FormMarkdownField.svelte';\n  import FormFileField from '$lib/components/forms/FormFileField.svelte';\n\n  export const { t } = getTranslate();\n\n  interface Props {\n    onSubmit: (data: ModData) => void;\n    initialValues?: ModData;\n    submitText?: string;\n    editing?: boolean;\n  }\n\n  let {\n    onSubmit,\n    initialValues = {\n      full_description: '',\n      mod_reference: '',\n      name: '',\n      short_description: '',\n      source_url: '',\n      hidden: false,\n      tagIDs: [],\n      compatibility: {\n        EA: {\n          state: CompatibilityState.Works,\n          note: ''\n        },\n        EXP: {\n          state: CompatibilityState.Works,\n          note: ''\n        }\n      }\n    },\n    submitText = $t('entry.create'),\n    editing = false\n  }: Props = $props();\n\n  const { form, data } = createForm<ModData>({\n    initialValues: initialValues,\n    extend: [validator({ schema: modSchema }), reporter],\n    onSubmit: (submitted: ModData) => onSubmit(trimNonSchema(submitted, modSchema))\n  });\n\n  let tags = $state($data.tags);\n  const computeTags = () => {\n    $data.tagIDs = tags.map((tag) => tag.id);\n  };\n\n  run(() => {\n    if (tags) {\n      computeTags();\n    }\n  });\n\n  // The GQL type NewMod does not have a compatibility field.\n  // We remove the field from the data so that the GQL request is valid\n  run(() => {\n    if (!editing) {\n      delete $data.compatibility;\n    }\n  });\n\n  const addAuthor = () => {\n    $data.authors.push({ role: 'editor', user_id: '', key: '' });\n    $data.authors = $data.authors;\n  };\n\n  const removeAuthor = (i: number) => {\n    $data.authors.splice(i, 1);\n    $data.authors = $data.authors;\n  };\n\n  let editCompatibility = $state(false);\n  run(() => {\n    $data.compatibility = $data.compatibility ? $data.compatibility : undefined;\n  });\n</script>\n\n<form use:form>\n  <div class=\"grid grid-flow-row gap-6\">\n    <FormField label={$t('entry.name')} name=\"name\" bind:value={$data.name} required />\n\n    <FormField\n      label={$t('mod.reference')}\n      name=\"mod_reference\"\n      bind:value={$data.mod_reference}\n      required\n      disabled={editing}\n      helperText={!editing ? $t('mod.reference-warning') : undefined} />\n\n    <FormField\n      label={$t('entry.short-description')}\n      name=\"short_description\"\n      bind:value={$data.short_description}\n      required />\n\n    <FormMarkdownField\n      label={$t('entry.full-description')}\n      name=\"full_description\"\n      bind:value={$data.full_description}\n      required />\n\n    <div class=\"grid grid-flow-row gap-2\">\n      <TagList editable={true} bind:tags />\n    </div>\n\n    <FormFileField\n      label=\"{$t('logo')}:\"\n      name=\"logo\"\n      id=\"logo\"\n      accept=\"image/png,image/jpeg,image/gif\"\n      placeholder=\"Logo\" />\n\n    <FormField label={$t('entry.source-url')} name=\"source_url\" bind:value={$data.source_url} required />\n\n    <div class=\"grid grid-flow-row gap-2\">\n      <Switch checked={$data.hidden} onCheckedChange={(e) => ($data.hidden = e.checked)}>\n        <Switch.Control>\n          <Switch.Thumb />\n        </Switch.Control>\n        <Switch.Label>{$t('entry.hidden')}</Switch.Label>\n        <Switch.HiddenInput />\n      </Switch>\n    </div>\n    {#if editing}\n      <div>\n        <Switch checked={editCompatibility} onCheckedChange={(e) => (editCompatibility = e.checked)}>\n          <Switch.Control>\n            <Switch.Thumb />\n          </Switch.Control>\n          <Switch.Label>{$t('compatibility-info.edit')}</Switch.Label>\n          <Switch.HiddenInput />\n        </Switch>\n      </div>\n\n      {#if editCompatibility}\n        <ModCompatibility bind:compatibilityInfo={$data.compatibility} />\n      {/if}\n\n      <div class=\"grid grid-flow-row gap-2\">\n        <div class=\"flex items-center\">\n          <h4 class=\"mr-4\">{$t('authors')}</h4>\n          <button class=\"btn border border-primary-500 preset-tonal-primary\" type=\"button\" onclick={addAuthor}>\n            <span>{$t('add')}</span>\n          </button>\n        </div>\n        {#each $data.authors as author, i (author.key || i)}\n          <div class=\"flex items-end\">\n            {#if $data.authors[i].user_id}\n              <div class=\"p-2\">\n                <ModAuthor id={$data.authors[i].user_id} />\n              </div>\n            {/if}\n            <label class=\"label\">\n              <span>User ID</span>\n              <input\n                type=\"text\"\n                bind:value={$data.authors[i].user_id}\n                required\n                class=\"input p-2\"\n                disabled={author.role === 'creator'} />\n            </label>\n            {#if author.role !== 'creator'}\n              <button\n                class=\"btn border border-primary-500 preset-tonal-primary\"\n                type=\"button\"\n                onclick={() => removeAuthor(i)}>\n                <span>{$t('remove')}</span>\n              </button>\n            {/if}\n          </div>\n        {/each}\n      </div>\n    {/if}\n\n    <div>\n      <button class=\"btn border border-primary-500 preset-tonal-primary\" type=\"submit\">{submitText}</button>\n    </div>\n  </div>\n</form>\n"],"names":["modSchema","zod.object","zod.string","zod.optional","zod.any","logo","zod.literal","zod.boolean","t","getTranslate","client","getContextClient","user","$.tag","queryStore","GetUserDocument","$$props","$.template_effect","$0","$.set_text","text","$t","text_1","$user","$$render","consequent_2","alternate","consequent_1","alternate_1","consequent","alternate_2","initialValues","$.prop","CompatibilityState","submitText","editing","form","data","createForm","validator","reporter","submitted","trimNonSchema","tags","$.state","$.proxy","$data","computeTags","$.store_mutate","$.untrack","$.get","tag","run","addAuthor","removeAuthor","i","editCompatibility","$.derived","$$value","$1","e","$.set","author","$$anchor","button_1","text_4","$.bind_value","input","consequent_3"],"mappings":"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"}
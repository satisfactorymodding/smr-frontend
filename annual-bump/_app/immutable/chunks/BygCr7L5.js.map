{"version":3,"file":"BygCr7L5.js","sources":["../../../../../../src/lib/components/utils/TagDisplay.svelte","../../../../../../src/lib/components/utils/TagList.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { type Tag } from '$lib/generated';\n  import { Portal, Tooltip } from '@skeletonlabs/skeleton-svelte';\n\n  interface Props {\n    tag: Tag;\n    selected?: boolean;\n    onclick?: () => void;\n  }\n\n  let { tag, selected, onclick }: Props = $props();\n</script>\n\n<Tooltip>\n  <Tooltip.Trigger\n    class={selected ? 'selected-tag' : ''}\n    onclick={(e) => {\n      e.preventDefault();\n      onclick?.();\n    }}>\n    <span class=\"text-orange-500\">#</span>\n    <span class=\"text-neutral-300 lowercase\">{tag.name}</span>\n  </Tooltip.Trigger>\n  <Portal>\n    <Tooltip.Positioner>\n      <Tooltip.Content class=\"max-w-md card preset-filled-surface-100-900 bg-surface-100-900 p-2 shadow-xl\">\n        {tag.description}\n        <Tooltip.Arrow\n          style=\"--arrow-size: calc(var(--spacing) * 2); --arrow-background: var(--color-surface-100-900);\">\n          <Tooltip.ArrowTip />\n        </Tooltip.Arrow>\n      </Tooltip.Content>\n    </Tooltip.Positioner>\n  </Portal>\n</Tooltip>\n","<script lang=\"ts\">\n  import { GetTagsDocument } from '$lib/generated/graphql';\n  import type { Tag } from '$lib/generated/graphql';\n  import { queryStore, getContextClient } from '@urql/svelte';\n  import TagDisplay from './TagDisplay.svelte';\n  import { getTranslate } from '@tolgee/svelte';\n  import { Combobox, Portal, type ComboboxRootProps, useListCollection } from '@skeletonlabs/skeleton-svelte';\n\n  export const { t } = getTranslate();\n\n  const client = getContextClient();\n\n  const getAllTags = queryStore({\n    query: GetTagsDocument,\n    client,\n    variables: {\n      limit: 100\n    }\n  });\n\n  interface Props {\n    tags?: Tag[];\n    editable?: boolean;\n  }\n\n  let { tags = $bindable([]), editable = false }: Props = $props();\n\n  let allTags = $derived(\n    $getAllTags.data?.getTags?.map((tag) => ({\n      label: `${tag.name} - ${tag.description}`,\n      value: tag.id,\n      name: tag.name\n    })) || []\n  );\n\n  const addTag = (id: string) => {\n    const realTag = $getAllTags.data?.getTags?.find((tag) => tag.id == id);\n    tags = [\n      ...tags,\n      {\n        id,\n        name: realTag?.name,\n        description: realTag?.description\n      }\n    ];\n  };\n\n  const removeTag = (id: string) => {\n    const idx = tags.findIndex((tag) => tag.id === id);\n    tags = [...tags.slice(0, idx), ...tags.slice(idx + 1)];\n  };\n\n  const collection = $derived(\n    useListCollection({\n      items: allTags,\n      itemToString: (item) => item.label,\n      itemToValue: (item) => item.value\n    })\n  );\n\n  const onSelect: ComboboxRootProps['onSelect'] = (event) => {\n    console.log(event);\n    const id = event.itemValue;\n    console.log(\n      tags,\n      id,\n      tags.findIndex((tag) => tag.id == id)\n    );\n    if (tags.findIndex((tag) => tag.id == id) < 0) {\n      addTag(id);\n    } else {\n      removeTag(id);\n    }\n  };\n\n  let inputValue = $state('');\n  const onInputValueChange: ComboboxRootProps['onInputValueChange'] = (event) => {\n    inputValue = event.inputValue;\n  };\n\n  let filteredTags = $derived(allTags.filter((item) => item.label.toLowerCase().includes(inputValue)));\n</script>\n\n<div class=\"tags\">\n  {#if !editable}\n    {#if tags && tags.length > 0}\n      <div class=\"text-md flex flex-row flex-wrap gap-1\">\n        {#each tags as tag (tag.id)}\n          <TagDisplay {tag} />\n        {/each}\n      </div>\n    {/if}\n  {:else}\n    <div class=\"mb-2\">{$t('mod.tags.title')}</div>\n\n    <div\n      class=\"max-h-48 w-full max-w-full overflow-y-auto card preset-filled-surface-100-900\"\n      tabindex=\"-1\"\n      data-popup=\"popupAutocomplete\">\n      <Combobox\n        class=\"w-full\"\n        placeholder=\"Search...\"\n        {collection}\n        {onSelect}\n        {onInputValueChange}\n        value={tags.map((tag) => tag.id)}\n        openOnClick={true}\n        multiple={true}\n        allowCustomValue={false}\n        positioning={{ placement: 'top-end' }}>\n        <Combobox.Control>\n          <Combobox.Input />\n          <Combobox.Trigger />\n        </Combobox.Control>\n        <Portal>\n          <Combobox.Positioner class=\"z-[1]!\">\n            <Combobox.Content class=\"max-h-[30vh] overflow-auto\">\n              {#each filteredTags as item (item.value)}\n                <Combobox.Item {item}>\n                  <Combobox.ItemText>\n                    <span class=\"text-orange-500\">#</span>{item.label}\n                  </Combobox.ItemText>\n                  <Combobox.ItemIndicator />\n                </Combobox.Item>\n              {/each}\n            </Combobox.Content>\n          </Combobox.Positioner>\n        </Portal>\n      </Combobox>\n\n      <div class=\"text-md flex flex-row flex-wrap gap-1\">\n        {#each tags as tag (tag.id)}\n          <TagDisplay {tag} />\n        {/each}\n      </div>\n    </div>\n  {/if}\n</div>\n"],"names":["$0","$.derived","$$props","e","t","getTranslate","client","getContextClient","getAllTags","queryStore","GetTagsDocument","tags","$.prop","$.tag_proxy","$.proxy","editable","allTags","$.tag","$getAllTags","tag","addTag","id","realTag","$.equals","removeTag","idx","$.strict_equals","collection","useListCollection","item","onSelect","event","$.log_if_contains_state","inputValue","onInputValueChange","filteredTags","$.get","$.validate_each_keys","$.each","div_1","$$render","consequent","node_9","$.template_effect","$.set_text","text_1","div_4","text","$t","alternate","consequent_1"],"mappings":"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"}
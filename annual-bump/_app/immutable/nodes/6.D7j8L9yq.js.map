{"version":3,"file":"6.D7j8L9yq.js","sources":["../../../../../../src/routes/admin/tag-manager/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { getContextClient, queryStore } from '@urql/svelte';\n  import { CreateTagDocument, DeleteTagDocument, GetTagsDocument, UpdateTagDocument } from '$lib/generated';\n  import type { Tag } from '$lib/generated';\n  import { Accordion } from '@skeletonlabs/skeleton-svelte';\n  import { toaster } from '$lib/utils/toaster-svelte';\n\n  const client = getContextClient();\n\n  let tags: Tag[] = $state([]);\n  let tagNegativeID = -1;\n  const defaultNewTagName = 'New Tag';\n\n  const tagsQuery = queryStore({\n    query: GetTagsDocument,\n    client,\n    variables: {\n      limit: 100\n    }\n  });\n\n  tagsQuery.subscribe((val) => {\n    if (val.data?.getTags) {\n      tags = val.data?.getTags || [];\n    }\n  });\n\n  let value = $state(['0']);\n\n  function newTag() {\n    if (!tags.find((tag) => tag.name == defaultNewTagName)) {\n      const tag = { id: tagNegativeID--, name: defaultNewTagName, description: 'Description' } as Tag;\n      tags.push(tag);\n      tags = tags;\n      setTimeout(() => {\n        value = [tag.id];\n      }, 0);\n    } else {\n      value = [tags[tags.length - 1].id];\n    }\n  }\n\n  async function tagChange(tag: Tag) {\n    if (tag.name == defaultNewTagName) {\n      return;\n    }\n\n    let success = false;\n    if (tag.id < 0) {\n      // Create new tag & update tag.id with new DB id or re-fetch all tags\n      try {\n        const result = await client\n          .mutation(CreateTagDocument, { tagName: tag.name, description: tag.description })\n          .toPromise();\n        if (result.data) {\n          tag.id = result.data.createTag.id;\n          success = true;\n        }\n      } catch (err) {\n        console.log(err);\n      }\n      if (!success) {\n        toaster.error({\n          description: `Failed to create Tag '${tag.name}'!`,\n          duration: 2000\n        });\n        return;\n      }\n    } else {\n      // Update existing tag\n      try {\n        success =\n          (\n            await client\n              .mutation(UpdateTagDocument, { tagID: tag.id, tagName: tag.name, description: tag.description })\n              .toPromise()\n          ).data.updateTag != null;\n      } catch {\n        // nothing\n      }\n      if (!success) {\n        toaster.error({\n          description: `Failed to update Tag '${tag.name}'!`,\n          duration: 2000\n        });\n        return;\n      }\n    }\n\n    toaster.success({\n      description: `Tag '${tag.name}' saved!`,\n      duration: 2000\n    });\n  }\n\n  async function deleteTag(tag: Tag) {\n    if (tag.name != defaultNewTagName) {\n      // Remove tag\n      let success = false;\n      try {\n        const result = await client.mutation(DeleteTagDocument, { tagID: tag.id }).toPromise();\n        success = result.data.deleteTag;\n      } catch {\n        success = false;\n      }\n      if (!success) {\n        toaster.error({\n          description: `Failed to remove Tag '${tag.name}'!`,\n          duration: 2000\n        });\n        return;\n      }\n    } else {\n      tags.splice(tags.indexOf(tag), 1);\n    }\n\n    toaster.success({\n      description: `Tag '${tag.name}' removed!`,\n      duration: 2000\n    });\n  }\n\n  function onDeleteClick(e: Event, tag: Tag) {\n    e.stopPropagation();\n    deleteTag(tag);\n  }\n</script>\n\n<h1>Mod Tag Manager</h1>\n\n<div class=\"card preset-filled-surface-100-900\">\n  {#if $tagsQuery.fetching}\n    <h1>Loading tags...</h1>\n  {:else if $tagsQuery.error}\n    <h1>Failed to load tags: {$tagsQuery.error.message}</h1>\n  {:else}\n    <Accordion {value} onValueChange={(details) => (value = details.value)}>\n      {#each tags as tag (tag.id)}\n        <Accordion.Item value={tag.id}>\n          <Accordion.ItemTrigger>{tag.name}</Accordion.ItemTrigger>\n          <Accordion.ItemContent>\n            <div>\n              <div>Tag name</div>\n              <input\n                type=\"text\"\n                class=\"input p-2\"\n                bind:value={tag.name}\n                placeholder=\"Name\"\n                onchange={() => tagChange(tag)} />\n              <div>Tag description</div>\n              <input\n                type=\"text\"\n                class=\"input p-2\"\n                bind:value={tag.description}\n                placeholder=\"Description\"\n                onchange={() => tagChange(tag)} />\n            </div>\n            <span>Human-Readable name and description of the tag that is shown in UI</span>\n\n            <button class=\"btn border border-error-500 preset-tonal-error\" onclick={(e) => onDeleteClick(e, tag)}>\n              <span>Delete</span>\n            </button>\n          </Accordion.ItemContent>\n        </Accordion.Item>\n      {/each}\n    </Accordion>\n\n    <section class=\"p-4\">\n      <button class=\"btn border border-primary-500 preset-tonal-primary\" onclick={newTag}>\n        <span>Add new tag</span>\n        <span class=\"material-icons\">add</span>\n      </button>\n    </section>\n  {/if}\n</div>\n\n<style lang=\"postcss\">\n  @reference \"../../../app.css\";\n\n  h1 {\n    @apply my-4 text-4xl font-bold;\n  }\n</style>\n"],"names":["client","getContextClient","tags","$.tag","$.state","$.proxy","tagNegativeID","defaultNewTagName","tagsQuery","queryStore","GetTagsDocument","val","$.set","value","newTag","tag","$.equals","$.get","tagChange","success","result","CreateTagDocument","err","$.log_if_contains_state","toaster","UpdateTagDocument","deleteTag","$.track_reactivity_loss","DeleteTagDocument","onDeleteClick","$tagsQuery","details","$.validate_each_keys","$.each","node_3","$$index","$.template_effect","$.set_text","text_1","input","input_1","button","e","$.bind_value","$$value","$$render","consequent_1","alternate","consequent","alternate_1"],"mappings":"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"}
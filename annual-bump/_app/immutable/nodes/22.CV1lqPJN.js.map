{"version":3,"file":"22.CV1lqPJN.js","sources":["../../../../../../src/lib/components/mods/ModGrid.svelte","../../../../../../src/routes/mods/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { run } from 'svelte/legacy';\n\n  import { queryStore, getContextClient } from '@urql/svelte';\n  import { GetModsDocument, GetTagsDocument, ModFields, Order, type Tag } from '$lib/generated';\n  import ModCard from './ModCard.svelte';\n  import { base } from '$app/paths';\n  import { goto } from '$app/navigation';\n  import { page as storePage } from '$app/state';\n  import { user } from '$lib/stores/user';\n  import FicsitCard from '$lib/components/general/FicsitCard.svelte';\n  import { browser } from '$app/environment';\n  import { getTranslate } from '@tolgee/svelte';\n  import TagDisplay from '../utils/TagDisplay.svelte';\n  import Pager from '$lib/components/general/Pager.svelte';\n\n  interface Props {\n    colCount?: 4 | 5;\n    newMod?: boolean;\n    showSearch?: boolean;\n  }\n\n  let { colCount = 4, newMod = false, showSearch = false }: Props = $props();\n\n  const client = getContextClient();\n\n  let search = $state((browser && storePage.url.searchParams.get('q')) || '');\n\n  let order: Order = $state(Order.Desc);\n  let orderBy: ModFields = $state(ModFields.LastVersionDate);\n\n  let perPage = $state(32);\n  let page = $state(parseInt((browser && storePage.url.searchParams.get('p')) || '0', 10) || 0);\n\n  let selectedTags: string[] = $state([]);\n\n  let mods = $derived(\n    queryStore({\n      query: GetModsDocument,\n      client,\n      variables: { offset: page * perPage, limit: perPage, search, order, orderBy, tagIDs: selectedTags.sort() }\n    })\n  );\n\n  let allTags = $derived(\n    queryStore({\n      query: GetTagsDocument,\n      client,\n      variables: {\n        limit: 100\n      }\n    })\n  );\n\n  let totalMods: number = $derived($mods?.data?.getMods?.count || 0);\n\n  // svelte-ignore state_referenced_locally\n  let searchField = $state(search);\n  let searchDisabled = $derived(searchField.length < 3);\n  let searchButtonClass = $derived(searchDisabled ? 'preset-filled-surface-500' : 'preset-filled-primary-500');\n\n  let timer: number = $state();\n  run(() => {\n    clearTimeout(timer);\n    timer = setTimeout(() => {\n      if (searchField && !searchDisabled) {\n        if ((search === '' || search === null) && searchField !== '' && searchField !== null) {\n          orderBy = ModFields.Search;\n          page = 0;\n        }\n\n        search = searchField;\n      } else if (searchField === '' || searchField === null) {\n        if (orderBy === ModFields.Search || !orderBy) {\n          orderBy = ModFields.LastVersionDate;\n        }\n\n        search = null;\n      }\n    }, 250) as unknown as number;\n  });\n\n  run(() => {\n    if (browser) {\n      const url = new URL(window.location.origin + window.location.pathname);\n      url.searchParams.append('p', page.toString());\n      if (!searchDisabled && searchField !== '' && searchField !== null) {\n        url.searchParams.append('q', searchField);\n      }\n      goto(url.toString(), { keepFocus: true });\n    }\n  });\n\n  let showPagination = $derived(\n    ($mods && $mods.fetching) || ($mods && !$mods.fetching && totalMods > 0 && !$mods.error)\n  );\n\n  let gridClasses = $derived(\n    colCount == 4\n      ? '3xl:grid-cols-4 2xl:grid-cols-3 lg:grid-cols-2 grid-cols-1'\n      : '3xl:grid-cols-3 2xl:grid-cols-2 grid-cols-1'\n  );\n\n  export const { t } = getTranslate();\n\n  let orderFields = $derived([\n    [$t('sort-order.name'), 'name'],\n    [$t('sort-order.views'), 'views'],\n    [$t('sort-order.downloads'), 'downloads'],\n    [$t('sort-order.hotness'), 'hotness'],\n    [$t('sort-order.popularity'), 'popularity'],\n    [$t('sort-order.created_at'), 'created_at'],\n    [$t('sort-order.last_version_date'), 'last_version_date'],\n    ...(search !== '' && search !== null ? [[$t('sort-order.search'), 'search']] : [])\n  ]);\n\n  const toggleTag = (tagId: string) => {\n    if (selectedTags.indexOf(tagId) >= 0) {\n      const i = selectedTags.indexOf(tagId);\n      selectedTags = [...selectedTags.slice(0, i), ...selectedTags.slice(i + 1)];\n    } else {\n      selectedTags = [...selectedTags, tagId];\n    }\n  };\n\n  const sortedTags = (tags: Tag[]): Tag[] => tags.toSorted((a, b) => a.name.localeCompare(b.name));\n\n  let tagsOpen = $state(false);\n</script>\n\n<div class=\"mb-5 ml-auto flex flex-col gap-4\">\n  {#if showSearch}\n    <div class=\"flex grow flex-col items-center justify-center gap-4 sm:px-4\">\n      <div class=\"flex grow flex-row flex-wrap items-center justify-center gap-3 sm:px-4\">\n        <div>\n          <button\n            type=\"button\"\n            class=\"text-md btn preset-filled-surface-500 p-2 btn-sm pr-4 pl-4\"\n            class:preset-tonal-primary={tagsOpen}\n            title={$t('filter.expand-button-tooltip')}\n            onclick={() => (tagsOpen = !tagsOpen)}>\n            <span>{$t('filter.expand-button-text')}</span>\n          </button>\n        </div>\n        <div>\n          <select bind:value={orderBy} class=\"select\">\n            {#each orderFields as orderField (orderField[1])}\n              <option value={orderField[1]}>{orderField[0]}</option>\n            {/each}\n          </select>\n        </div>\n        <div>\n          <select bind:value={order} class=\"select\">\n            <option value=\"asc\">{$t('ascending')}</option>\n            <option value=\"desc\">{$t('descending')}</option>\n          </select>\n        </div>\n\n        <div class=\"input-group-divider input-group w-fit grid-cols-[1fr_auto] rounded-container\">\n          <input\n            bind:value={searchField}\n            class=\"border-0 bg-transparent p-1.5 ring-0\"\n            name=\"search\"\n            placeholder={$t('search.placeholder-text')} />\n          <button\n            class=\"material-icons {searchButtonClass}\"\n            disabled={searchDisabled}\n            title={searchDisabled ? $t('search.disabled') : ''}>arrow_forward</button>\n        </div>\n      </div>\n      {#if tagsOpen}\n        <div class=\"flex flex-grow flex-row flex-wrap items-center justify-center gap-1 pb-10\">\n          {#if $allTags.error}\n            <p>Oh no... {$allTags.error.message}</p>\n          {:else if !$allTags.fetching}\n            {#each sortedTags($allTags.data.getTags) as tag (tag.id)}\n              <TagDisplay {tag} selected={selectedTags.indexOf(tag.id) >= 0} onclick={() => toggleTag(tag.id)} />\n            {/each}\n          {/if}\n        </div>\n      {/if}\n    </div>\n  {/if}\n\n  <div\n    class=\"flex grow flex-row flex-wrap\"\n    class:justify-between={newMod && $user !== null}\n    class:justify-end={!newMod || $user == null}>\n    {#if newMod && $user !== null}\n      <a class=\"btn self-end border border-primary-500 preset-tonal-primary\" href=\"{base}/new-mod\">{$t('mods.new')}</a>\n    {/if}\n    {#if showPagination}\n      <div class=\"self-end\">\n        <Pager bind:page bind:perPage total={totalMods} />\n      </div>\n    {/if}\n  </div>\n</div>\n\n{#if $mods.fetching}\n  <div class=\"grid {gridClasses} gap-4\">\n    {#each Array(perPage) as _, i (i)}\n      <FicsitCard fake />\n    {/each}\n  </div>\n{:else if $mods.error && $mods.error.message.includes(\"'Search' failed on the 'min' tag\")}\n  {$t('search.failed.query-too-short')}\n{:else if $mods.error}\n  <p>Oh no... {$mods.error.message}</p>\n{:else if totalMods == 0}\n  {$t('search.results.empty')}\n{:else}\n  <div class=\"grid {gridClasses} gap-4\">\n    {#each $mods.data.getMods.mods as mod (mod.id)}\n      <ModCard {mod} />\n    {/each}\n  </div>\n{/if}\n\n{#if showPagination}\n  <div class=\"mt-5 ml-auto flex justify-end\">\n    <div>\n      <Pager bind:page bind:perPage total={totalMods} />\n    </div>\n  </div>\n{/if}\n\n<style lang=\"postcss\">\n  * :global(.search-paper) {\n    display: flex;\n    align-items: center;\n    flex-grow: 1;\n    max-width: 600px;\n    height: 48px;\n  }\n\n  * :global(.search-paper > *) {\n    display: inline-block;\n    margin: 0 12px;\n  }\n</style>\n","<script lang=\"ts\">\n  import ModGrid from '$lib/components/mods/ModGrid.svelte';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n</script>\n\n<svelte:head>\n  <MetaDescriptors description=\"Mods available from the Satisfactory Mod Repository\" title=\"Mods\" />\n</svelte:head>\n\n<ModGrid showSearch={true} newMod={true} colCount={4} />\n"],"names":["colCount","newMod","showSearch","client","getContextClient","search","$.tag","$.state","$.proxy","storePage","order","Order","orderBy","ModFields","perPage","page","selectedTags","mods","queryStore","GetModsDocument","$.get","allTags","$.derived","GetTagsDocument","totalMods","$mods","searchField","searchDisabled","searchButtonClass","timer","run","$.strict_equals","$.set","url","goto","showPagination","gridClasses","$.equals","t","getTranslate","orderFields","$t","toggleTag","tagId","i","sortedTags","tags","a","b","tagsOpen","button","$.validate_each_keys","orderField","$.each","select","$.set_text","text_1","option_value","option","$allTags","tag","node_4","$0","$$render","consequent_1","consequent","alternate","consequent_2","$.bind_select_value","$$value","select_1","$.bind_value","input","consequent_3","base","$user","consequent_4","consequent_5","$.index","$$anchor","_","$.template_effect","text_6","text_8","mod","div_11","consequent_9","alternate_1","consequent_8","alternate_2","consequent_7","alternate_3","consequent_6","alternate_4","consequent_10","_page"],"mappings":"6hFAAA,2NAsBQ,IAAAA,qBAAW,CAAC,EAAEC,mBAAS,EAAK,EAAEC,uBAAa,EAAK,EAEhD,MAAAC,GAASC,GAAgB,EAE3B,IAAAC,EAAMC,EAAAC,EAAAC,EAAsBC,GAAU,IAAI,aAAa,IAAI,GAAG,GAAM,EAAE,CAAA,EAAA,QAAA,EAEtEC,GAAYJ,EAAAC,EAAAC,EAAUG,GAAM,IAAI,CAAA,EAAA,OAAA,EAChCC,EAAkBN,EAAAC,EAAAC,EAAUK,GAAU,eAAe,CAAA,EAAA,SAAA,EAErDC,MAAiB,EAAE,EAAA,SAAA,EACnBC,QAAc,SAAqBN,GAAU,IAAI,aAAa,IAAI,GAAG,GAAM,IAAK,EAAE,GAAK,CAAC,CAAA,EAAA,MAAA,EAExFO,EAAsBV,EAAAC,EAAAC,EAAA,CAAA,CAAA,CAAA,EAAA,cAAA,EAEtBS,GAAIX,QACNY,GAAU,CACR,MAAOC,GACP,OAAAhB,GACA,UAAS,CAAI,OAAMiB,EAAEL,CAAI,EAAAK,EAAGN,CAAO,EAAE,QAAOA,CAAO,EAAE,SAAAT,CAAM,EAAE,QAAAK,EAAK,EAAE,UAAAE,CAAO,EAAE,OAAMQ,EAAEJ,CAAY,EAAC,KAAI,cAItGK,GAAOf,EAAAgB,EAAA,IACTJ,GAAU,CACR,MAAOK,GACP,OAAApB,GACA,UAAS,CACP,MAAO,GAAA,CAAA,CAAA,CAAA,EAAA,SAAA,EAKTqB,GAAiBlB,EAAAgB,EAAA,IAAYG,EAAK,GAAE,MAAM,SAAS,OAAS,CAAC,EAAA,WAAA,EAG7DC,UAAqBrB,CAAM,CAAA,CAAA,EAAA,aAAA,EAC3BsB,EAAcrB,EAAAgB,EAAA,IAAAF,EAAYM,CAAW,EAAC,OAAS,CAAC,EAAA,gBAAA,EAChDE,GAAiBtB,UAAYqB,CAAc,EAAG,4BAA8B,2BAA2B,uBAEvGE,GAAavB,EAAAC,EAAA,MAAA,EAAA,OAAA,EACjBuB,GAAG,IAAO,CACR,eAAaD,EAAK,CAAA,IAClBA,GAAQ,WAAiB,IAAA,GACnBH,CAAW,GAAA,CAAAN,EAAKO,CAAc,IAC3BI,EAAAX,EAAAf,CAAM,EAAK,EAAE,GAAA0B,EAAAX,EAAIf,CAAM,EAAK,IAAI,IAAA0B,EAAAX,EAAKM,CAAW,EAAK,GAAE,EAAA,GAAAK,EAAAX,EAAIM,CAAW,EAAK,KAAI,EAAA,MAClFd,EAAUC,GAAU,OAAM,EAAA,EAC1BmB,EAAAjB,EAAO,CAAC,GAGViB,EAAA3B,IAASqB,CAAW,EAAA,EAAA,IACrBK,EAAAX,EAAUM,CAAW,EAAK,EAAE,OAAIA,CAAW,EAAK,IAAI,MAC/CK,EAAAX,EAAAR,CAAO,EAAKC,GAAU,MAAM,GAAA,CAAAO,EAAKR,CAAO,MAC1CA,EAAUC,GAAU,gBAAe,EAAA,EAGrCmB,EAAA3B,EAAS,IAAI,EAEjB,EAAG,QACL,CAAC,EAEDyB,GAAG,IAAO,CACK,CACL,MAAAG,EAAG,IAAO,IAAI,OAAO,SAAS,OAAS,OAAO,SAAS,QAAQ,EACrEA,EAAI,aAAa,OAAO,IAAGb,EAAEL,CAAI,EAAC,UAAQ,KACrCY,CAAc,GAAAI,EAAAX,EAAIM,CAAW,EAAK,YAAMA,CAAW,EAAK,KAAI,EAAA,GAC/DO,EAAI,aAAa,OAAO,MAAKP,CAAW,CAAA,EAE1CQ,GAAKD,EAAI,SAAQ,EAAA,CAAM,UAAW,EAAI,CAAA,CACxC,CACF,CAAC,EAEG,IAAAE,WACDV,EAAK,GAAIA,EAAK,EAAC,UAAcA,KAAK,CAAKA,EAAK,EAAC,YAAYD,EAAS,EAAG,GAAC,CAAKC,EAAK,EAAC,KAAK,EAAA,gBAAA,EAGrFW,GAAW9B,EACbgB,EAAA,IAAAe,GAAArC,GAAQ,EAAI,CAAA,EACR,6DACA,6CAA4C,iBAGnC,KAAA,CAAA,EAAAsC,EAAC,EAAKC,GAAY,MAE7BC,GAAWlC,UACZmC,EAAE,EAAC,iBAAiB,EAAG,MAAM,GAC7BA,EAAE,EAAC,kBAAkB,EAAG,OAAO,GAC/BA,EAAE,EAAC,sBAAsB,EAAG,WAAW,GACvCA,EAAE,EAAC,oBAAoB,EAAG,SAAS,GACnCA,EAAE,EAAC,uBAAuB,EAAG,YAAY,GACzCA,EAAE,EAAC,uBAAuB,EAAG,YAAY,GACzCA,EAAE,EAAC,8BAA8B,EAAG,mBAAmB,SACpDpC,CAAM,EAAK,GAAE,EAAA,GAAA0B,EAAAX,EAAIf,CAAM,EAAK,KAAI,EAAA,EAAA,CAAA,CAAKoC,EAAE,EAAC,mBAAmB,EAAG,QAAQ,CAAA,EAAA,CAAA,yBAGtEC,GAAaC,GAAkB,CAC/B,GAAAvB,EAAAJ,CAAY,EAAC,QAAQ2B,CAAK,GAAK,EAAG,CAC9B,MAAAC,EAACxB,EAAGJ,CAAY,EAAC,QAAQ2B,CAAK,IACpC3B,GAAmB,GAAAI,EAAAJ,CAAY,EAAC,MAAM,EAAG4B,CAAC,EAAM,GAAAxB,EAAAJ,CAAY,EAAC,MAAM4B,EAAI,CAAC,MAC1E,QACE5B,EAAY,CAAA,GAAAI,EAAOJ,CAAY,EAAE2B,CAAK,EAAA,EAAA,CAE1C,EAEME,GAAcC,GAAuBA,EAAK,UAAUC,EAAGC,IAAMD,EAAE,KAAK,cAAcC,EAAE,IAAI,CAAA,EAE1F,IAAAC,OAAkB,EAAK,EAAA,UAAA,kHAaDC,EAAA,QAAA,IAAAlB,EAAAiB,MAAYA,EAAQ,CAAA,0DAM7BE,GAAA,IAAA/B,EAAAoB,EAAW,EAAIY,GAAYA,EAAW,CAAC,CAAA,IAAvC,IAAAC,GAAAC,EAAA,GAAA,IAAAlC,EAAAoB,EAAW,EAAIY,GAAYA,EAAW,CAAC,KAAxBA,IAAU,4CACCG,EAAAC,GAAApC,EAAAgC,CAAU,EAAC,CAAC,CAAA,EAA5BK,KAAAA,EAAArC,EAAAgC,CAAU,EAAC,CAAC,KAAZM,EAAA,OAAAA,EAAA,QAAAtC,EAAAgC,CAAU,EAAC,CAAC,IAAA,mUA0BhBO,EAAQ,EAAC,MAAM,SAAO,EAAA,EAAA,CAAA,4EAE5Bd,GAAWc,IAAS,KAAK,OAAO,EAAKC,IAAKA,GAAI,EAAE,IAAhD,IAAAP,GAAAQ,GAAA,EAAA,IAAAhB,GAAWc,EAAQ,EAAC,KAAK,OAAO,EAAKC,IAAKA,GAAI,OAATA,KAAG,EACjB,IAAAE,GAAAxC,EAAA,IAAAF,EAAAJ,CAAY,EAAC,QAAOI,EAACwC,EAAG,EAAC,EAAE,GAAK,CAAC,gFAAiBlB,GAAStB,EAACwC,EAAG,EAAC,EAAE,oGAFvFD,EAAQ,EAAC,UAAQI,GAAAC,EAAA,4CAFvBL,EAAQ,EAAC,MAAKI,EAAAE,EAAA,EAAAF,EAAAG,EAAA,EAAA,iDAFlBjB,EAAQ,GAAAc,EAAAI,EAAA,gKAhCqBlB,EAAQ,CAAA,CAAA,2FA2BbrB,EAAiB,GAAA,EAAA,GAAA,gBAAA,gBAC9BD,CAAc,qBA3BjB,IAAAc,EAAE,EAAC,8BAA8B,EAEjC,IAAAA,EAAE,EAAC,2BAA2B,EAYhB,IAAAA,EAAE,EAAC,WAAW,EACb,IAAAA,EAAE,EAAC,YAAY,EASxB,IAAAA,EAAE,EAAC,yBAAyB,EAIlC,IAAArB,EAAAO,CAAc,EAAGc,EAAE,EAAC,iBAAiB,EAAI,KAtB9B2B,GAAAd,EAAA,IAAAlC,EAAAR,CAAO,OAAPA,EAAOyD,CAAA,CAAA,EAOPD,GAAAE,EAAA,IAAAlD,EAAAV,EAAK,OAALA,GAAK2D,CAAA,CAAA,EAQXE,GAAAC,EAAA,IAAApD,EAAAM,CAAW,OAAXA,EAAW2C,CAAA,CAAA,yBA7B5BnE,GAAU,GAAA6D,EAAAU,EAAA,gHA0DmEC,IAAI,EAAA,UAAA,UAAY,CAAA,IAAAjC,EAAE,EAAC,UAAU,CAAA,0BADxGxC,GAAM,GAAA8B,EAAI4C,GAAK,EAAK,KAAI,EAAA,GAAAZ,EAAAa,EAAA,gGAKYpD,EAAS,mLAF7CW,EAAc,GAAA4B,EAAAc,EAAA,sFAUZ,MAAKzD,EAACN,CAAO,CAAA,EAAAgE,GAAA,CAAAC,EAAKC,IAAC,sHADV5C,EAAW,GAAA,EAAA,SAAA,gBAAA,CAAA,yDAM5B6C,EAAAnB,GAAAP,EAAA2B,EAAApB,CAAA,EAAA,CAAA,IAAArB,EAAE,EAAC,+BAA+B,CAAA,CAAA,0FAEtBhB,EAAK,EAAC,MAAM,SAAO,EAAA,EAAA,CAAA,yDAE/BwD,EAAAnB,GAAAP,EAAA4B,EAAArB,CAAA,EAAA,CAAA,IAAArB,EAAE,EAAC,sBAAsB,CAAA,CAAA,kCAGjBhB,EAAK,EAAC,KAAK,QAAQ,KAAQ2D,GAAKA,EAAI,EAAE,IAAtC,IAAA/B,GAAAgC,EAAA,EAAA,IAAA5D,EAAK,EAAC,KAAK,QAAQ,KAAQ2D,GAAKA,EAAI,MAATA,KAAG,mIADrBhD,EAAW,GAAA,EAAA,SAAA,gBAAA,CAAA,wBAHrBC,GAAAjB,EAAAI,EAAS,EAAI,CAAC,EAAAuC,EAAAuB,EAAA,EAAAvB,EAAAwB,EAAA,EAAA,2CAFd9D,EAAK,EAAC,MAAKsC,EAAAyB,CAAA,EAAAzB,EAAA0B,EAAA,EAAA,2CAFXhE,EAAK,EAAC,OAASA,EAAK,EAAC,MAAM,QAAQ,SAAS,kCAAkC,EAAAsC,EAAA2B,CAAA,EAAA3B,EAAA4B,EAAA,EAAA,4CANnFlE,EAAK,EAAC,SAAQsC,EAAA6B,EAAA,EAAA7B,EAAA8B,GAAA,EAAA,uGAuBwBrE,EAAS,wLAH/CW,EAAc,GAAA4B,EAAA+B,EAAA,4GAjCQ7F,GAAM,GAAA8B,EAAI4C,GAAK,EAAK,KAAI,EAAA,iBAC3B1E,GAAM,GAAAoC,GAAIsC,GAAK,EAAI,IAAI,0CA3D/C,qEChIA,qOASqB,GAAI,OAAU,GAAI,SAAY,EAAC,EAAA,YAAAoB,GAAA,GAAA,EAAA,CAAA,aAAA,UAAA,OANpD"}
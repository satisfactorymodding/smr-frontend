import{I as Ne,a as Pe,p as qe,Y as Ae,J as K,N as W,au as X,aw as Fe,z as $,f as ze,g as v,k as m,h as c,m as d,q as o,r as Me,t as Qe,n as Z,L as w,C as Le,F as l,y as g,G as Ue,D as E,S as k,a0 as ee,a1 as ae,ay as C,a4 as N,a9 as Ee,u as a,U as Ge,a6 as G,ab as Se,ac as je,an as te,_ as se,M as re,az as P,a3 as S,ad as He}from"../chunks/Zigv8uwj.js";import{g as Je,h as Oe,i as Re,j as Ve}from"../chunks/C2xQDKU4.js";import{t as T}from"../chunks/B-qlgqy4.js";t[l]="src/routes/admin/tag-manager/+page.svelte";var Ye=v(g('<h1 class="svelte-1pqzhs5">Loading tags...</h1>'),t[l],[[133,4]]),Be=v(g('<h1 class="svelte-1pqzhs5"> </h1>'),t[l],[[135,4]]),Ke=v(g('<div><div>Tag name</div> <input type="text" class="input p-2" placeholder="Name"/> <div>Tag description</div> <input type="text" class="input p-2" placeholder="Description"/></div> <span>Human-Readable name and description of the tag that is shown in UI</span> <button class="btn border border-error-500 preset-tonal-error"><span>Delete</span></button>',1),t[l],[[142,12,[[143,14],[144,14],[150,14],[151,14]]],[158,12],[160,12,[[161,14]]]]),We=v(g("<!> <!>",1),t[l],[]),Xe=v(g('<!> <section class="p-4"><button class="btn border border-primary-500 preset-tonal-primary"><span>Add new tag</span> <span class="material-icons">add</span></button></section>',1),t[l],[[168,4,[[169,6,[[170,8],[171,8]]]]]]),Ze=v(g('<h1 class="svelte-1pqzhs5">Mod Tag Manager</h1> <div class="card preset-filled-surface-100-900"><!></div>',1),t[l],[[129,0],[131,0]]);function t(ne,oe){Pe(new.target),qe(oe,!0,t);const q=()=>(Ue(A,"tagsQuery"),Le(A,"$tagsQuery",ie)),[ie,ce]=Qe(),b=Ae();let r=K(W(X([])),"tags"),de=-1;const y="New Tag",A=Fe({query:Je,client:b,variables:{limit:100}});A.subscribe(e=>{e.data?.getTags&&$(r,e.data?.getTags||[],!0)});let x=K(W(X(["0"])),"value");function le(){if(a(r).find(e=>P(e.name,y)))$(x,[a(r)[a(r).length-1].id],!0);else{const e={id:de--,name:y,description:"Description"};a(r).push(e),$(r,a(r),!0),setTimeout(()=>{$(x,[e.id],!0)},0)}}async function j(e){if(P(e.name,y))return;let s=!1;if(e.id<0){try{const i=(await S(b.mutation(Oe,{tagName:e.name,description:e.description}).toPromise()))();i.data&&(e.id=i.data.createTag.id,s=!0)}catch(i){console.log(...He("log",i))}if(!s){T.error({description:`Failed to create Tag '${e.name}'!`,duration:2e3});return}}else{try{s=P((await S(b.mutation(Re,{tagID:e.id,tagName:e.name,description:e.description}).toPromise()))().data.updateTag,null,!1)}catch{}if(!s){T.error({description:`Failed to update Tag '${e.name}'!`,duration:2e3});return}}T.success({description:`Tag '${e.name}' saved!`,duration:2e3})}async function pe(e){if(P(e.name,y,!1)){let s=!1;try{s=(await S(b.mutation(Ve,{tagID:e.id}).toPromise()))().data.deleteTag}catch{s=!1}if(!s){T.error({description:`Failed to remove Tag '${e.name}'!`,duration:2e3});return}}else a(r).splice(a(r).indexOf(e),1);T.success({description:`Tag '${e.name}' removed!`,duration:2e3})}function ue(e,s){e.stopPropagation(),pe(s)}var me={...ze()},H=Ze(),J=m(c(H),2),ve=w(J);{var ge=e=>{var s=Ye();o(e,s)},_e=e=>{var s=E(),i=c(s);{var he=p=>{var u=Be(),D=w(u);k(u),ee(()=>ae(D,`Failed to load tags: ${q().error.message??""}`)),o(p,u)},$e=p=>{var u=Xe(),D=c(u);d(()=>C(D,{get value(){return a(x)},onValueChange:F=>$(x,F.value,!0),children:N(t,(F,ea)=>{var R=E(),be=c(R);Ee(()=>a(r),_=>_.id),d(()=>Ge(be,17,()=>a(r),_=>_.id,(_,n,aa)=>{var V=E(),ye=c(V);d(()=>G(ye,()=>C.Item,(xe,De)=>{De(xe,{get value(){return a(n).id},children:N(t,(Ie,ta)=>{var Y=We(),B=c(Y);d(()=>G(B,()=>C.ItemTrigger,(z,M)=>{M(z,{children:N(t,(Q,ke)=>{Se();var f=je();ee(()=>ae(f,a(n).name)),o(Q,f)}),$$slots:{default:!0}})}),"component",t,140,10,{componentTag:"Accordion.ItemTrigger"});var we=m(B,2);d(()=>G(we,()=>C.ItemContent,(z,M)=>{M(z,{children:N(t,(Q,ke)=>{var f=Ke(),L=c(f),I=m(w(L),2);te(I),I.__change=()=>j(a(n)),se("bind:value={tag.name}",[],()=>a(n),()=>"name",147,16);var U=m(I,4);te(U),U.__change=()=>j(a(n)),se("bind:value={tag.description}",[],()=>a(n),()=>"description",154,16),k(L);var Ce=m(L,4);Ce.__click=h=>ue(h,a(n)),re(I,()=>a(n).name,h=>a(n).name=h),re(U,()=>a(n).description,h=>a(n).description=h),o(Q,f)}),$$slots:{default:!0}})}),"component",t,141,10,{componentTag:"Accordion.ItemContent"}),o(Ie,Y)}),$$slots:{default:!0}})}),"component",t,139,8,{componentTag:"Accordion.Item"}),o(_,V)}),"each",t,138,6),o(F,R)}),$$slots:{default:!0}}),"component",t,137,4,{componentTag:"Accordion"});var O=m(D,2),Te=w(O);Te.__click=le,k(O),o(p,u)};d(()=>Z(i,p=>{q().error?p(he):p($e,!1)},!0),"if",t,134,2)}o(e,s)};d(()=>Z(ve,e=>{q().fetching?e(ge):e(_e,!1)}),"if",t,132,2)}k(J),o(ne,H);var fe=Me(me);return ce(),fe}Ne(["change","click"]);export{t as component};
//# sourceMappingURL=6.CLMgUwwO.js.map

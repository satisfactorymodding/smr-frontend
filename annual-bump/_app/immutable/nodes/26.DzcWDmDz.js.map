{"version":3,"file":"26.DzcWDmDz.js","sources":["../../../../../../src/routes/settings/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { getContextClient } from '@urql/svelte';\n  import { UpdateUserDocument } from '$lib/generated';\n  import { goto } from '$app/navigation';\n  import { createForm } from 'felte';\n  import { validator } from '@felte/validator-zod';\n  import { reporter, ValidationMessage } from '@felte/reporter-svelte';\n  import { trimNonSchema } from '$lib/utils/forms';\n  import { user } from '$lib/stores/user';\n  import * as zod from 'zod';\n  import type { Form } from '@felte/core';\n  import { base } from '$app/paths';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n  import type { Writable } from 'svelte/store';\n  import { toaster } from '$lib/utils/toaster-svelte';\n\n  const client = getContextClient();\n\n  const userSchema = zod.object({\n    avatar: zod.optional(zod.any().refine((logo) => 'name' in logo && 'size' in logo && 'type' in logo)),\n    username: zod.string().min(3).max(32)\n  });\n\n  let form: Form<{ [key: string]: string }>['form'] = $state();\n  let data: Writable<{ username: string }> = $state();\n\n  $effect(() => {\n    if ($user && !$data) {\n      const createdForm = createForm<{ username: string }>({\n        initialValues: {\n          username: $user.username\n        },\n        extend: [validator({ schema: userSchema }), reporter],\n        onSubmit: (submitted: { username: string; avatar: unknown }) => {\n          console.log('submitted', submitted);\n          client\n            .mutation(UpdateUserDocument, {\n              user: trimNonSchema(submitted, userSchema),\n              userId: $user.id\n            })\n            .toPromise()\n            .then((value) => {\n              if (value.error) {\n                console.error(value.error.message);\n                toaster.error({\n                  description: 'Error editing user: ' + value.error.message\n                });\n              } else {\n                toaster.success({\n                  description: `User updated`,\n                  duration: 5000\n                });\n                goto(base + '/user/' + value.data.updateUser.id);\n              }\n            });\n        }\n      });\n\n      form = createdForm.form;\n      data = createdForm.data;\n    }\n  });\n</script>\n\n<svelte:head>\n  <MetaDescriptors description=\"Change your user settings\" title=\"Settings\" />\n</svelte:head>\n\n<h1 class=\"my-4 text-4xl font-bold\">Settings</h1>\n\n<div class=\"card preset-filled-surface-100-900 p-4\">\n  <section>\n    {#if $user === null}\n      <p>Please log in</p>\n    {:else}\n      <form use:form>\n        <div class=\"grid grid-flow-row gap-6\">\n          <div class=\"grid grid-flow-row gap-2\">\n            <label for=\"avatar\">Avatar:</label>\n            <input\n              id=\"avatar\"\n              class=\"base-input\"\n              name=\"avatar\"\n              type=\"file\"\n              accept=\"image/png,image/jpeg,image/gif\"\n              placeholder=\"Avatar\" />\n            <ValidationMessage for=\"avatar\">\n              {#snippet children({ messages: message })}\n                <span class=\"validation-message\">{message || ''}</span>\n              {/snippet}\n            </ValidationMessage>\n          </div>\n\n          <div class=\"grid grid-flow-row gap-2\">\n            <label class=\"label\">\n              <span>Username</span>\n              <input type=\"text\" bind:value={$data.username} required class=\"input p-2\" />\n            </label>\n            <ValidationMessage for=\"username\">\n              {#snippet children({ messages: message })}\n                <span class=\"validation-message\">{message || ''}</span>\n              {/snippet}\n            </ValidationMessage>\n          </div>\n\n          <div>\n            <button class=\"btn border border-primary-500 preset-tonal-primary\" type=\"submit\">Save</button>\n          </div>\n        </div>\n      </form>\n    {/if}\n  </section>\n</div>\n"],"names":["client","getContextClient","userSchema","zod.object","zod.optional","zod.any","logo","zod.string","form","$.tag","$.state","data","$.user_effect","$user","$data","createdForm","createForm","validator","reporter","submitted","$.log_if_contains_state","UpdateUserDocument","trimNonSchema","value","toaster","goto","base","$$stores","message","$.template_effect","$.set_text","text","text_1","$.bind_value","input","$$value","$.store_mutate","$.get","$.untrack","$.strict_equals","$$render","consequent","alternate"],"mappings":"wqDAAA,wHAgBQA,EAASC,GAAgB,EAEzBC,EAAaC,GAAU,CAC3B,OAAQC,GAAaC,KAAU,OAAQC,GAAS,SAAUA,GAAQ,SAAUA,GAAQ,SAAUA,CAAI,CAAA,EAClG,SAAUC,GAAU,EAAG,IAAI,CAAC,EAAE,IAAI,EAAE,QAGlCC,EAA6CC,EAAAC,EAAA,MAAA,EAAA,MAAA,EAC7CC,EAAoCF,EAAAC,EAAA,MAAA,EAAA,MAAA,EAExCE,GAAO,IAAO,IACRC,EAAK,GAAA,CAAKC,IAAO,CACb,MAAAC,EAAcC,GAAU,CAC5B,cAAa,CACX,SAAUH,EAAK,EAAC,QAAA,EAElB,QAASI,GAAS,CAAG,OAAQf,CAAU,GAAKgB,EAAQ,EACpD,SAAWC,GAAqD,CAC9D,QAAQ,IAAG,GAAAC,EAAA,MAAC,YAAaD,CAAS,CAAA,EAClCnB,EACG,SAASqB,GAAkB,CAC1B,KAAMC,GAAcH,EAAWjB,CAAU,EACzC,OAAQW,EAAK,EAAC,EAEf,CAAA,EAAA,UAAS,EACT,KAAMU,GAAU,CACXA,EAAM,OACR,QAAQ,MAAK,GAAAH,EAAA,QAACG,EAAM,MAAM,OAAO,CAAA,EACjCC,EAAQ,MAAK,CACX,YAAa,uBAAyBD,EAAM,MAAM,QAAA,IAGpDC,EAAQ,QAAO,CACb,YAAW,eACX,SAAU,IAAA,EAEZC,GAAKC,GAAO,SAAWH,EAAM,KAAK,WAAW,EAAE,EAEnD,CAAC,CACL,MAGFf,EAAOO,EAAY,KAAI,EAAA,OACvBJ,EAAOI,EAAY,KAAI,EAAA,EAAA,QAAAY,CAAA,CACzB,CACF,CAAC,kTA0B0C,IAAAC,YAAV,uCACeC,EAAA,IAAAC,EAAAC,EAAAH,EAAO,GAAI,EAAE,CAAA,uOAWlB,IAAAA,YAAV,uCACeC,EAAA,IAAAC,EAAAE,EAAAJ,EAAO,GAAI,EAAE,CAAA,wKAJlBK,GAAAC,EAAA,IAAApB,EAAK,EAAC,SAAQqB,GAAAC,GAAAC,EAAA1B,CAAA,EAAA2B,EAAdxB,CAAK,EAAC,aAANA,CAAK,CAAA,CAAA,yBAxBzCyB,GAAA1B,IAAU,IAAI,EAAA2B,EAAAC,CAAA,EAAAD,EAAAE,EAAA,EAAA,4DAVvB"}
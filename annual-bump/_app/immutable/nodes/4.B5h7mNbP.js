import{I as Fe,a as ke,p as Ce,Y as Pe,J as qe,N as Ne,au as K,av as Me,aw as Qe,ax as Ee,f as Ge,g as f,k as _,h as d,m,q as o,r as Le,t as Se,n as R,L as D,C as ze,F as u,y as h,G as Ue,z as V,D as E,S as F,a0 as X,a1 as Z,ay as k,a4 as C,a9 as je,u as t,U as Je,a6 as G,ab as Oe,ac as We,an as ee,_ as L,j as Ye,M as te,az as P,a3 as S,ad as Be}from"../chunks/C90Be9iR.js";import{G as He,C as Ke,b as Re,A as Ve,D as Xe}from"../chunks/C2xQDKU4.js";import{t as y}from"../chunks/CTLp1XiY.js";a[u]="src/routes/admin/announcements/+page.svelte";var Ze=f(h('<h1 class="svelte-1ree51b">Loading announcements...</h1>'),a[u],[[147,4]]),et=f(h('<h1 class="svelte-1ree51b"> </h1>'),a[u],[[149,4]]),tt=f(h('<div><div>Message</div> <input type="text" class="input p-2" placeholder="This is the text of the announcement"/> <div>Importance (Fix, Info, Warning, Alert)</div> <input type="text" class="input p-2" placeholder="Importance level"/></div> <button class="btn border border-error-500 preset-tonal-error"><span>Delete</span></button>',1),a[u],[[162,12,[[163,14],[164,14],[171,14],[172,14]]],[180,12,[[183,14]]]]),at=f(h("<!> <!>",1),a[u],[]),st=f(h('<!> <section class="p-4"><button class="btn border border-primary-500 preset-tonal-primary"><span>Add new announcement</span> <span class="material-icons">add</span></button></section>',1),a[u],[[190,4,[[191,6,[[192,8],[193,8]]]]]]),rt=f(h('<h1 class="svelte-1ree51b">Announcements</h1> <div class="card preset-filled-surface-100-900"><!></div>',1),a[u],[[143,0],[145,0]]);function a(ae,se){ke(new.target),Ce(se,!0,a);const x=()=>(Ue(z,"annQuery"),ze(z,"$annQuery",re)),[re,ne]=Se(),I=Pe();let n=qe(Ne(K([])),"announcements");const $=Me(K({}),"nameFields");let oe=-1;const T="New Announcement",z=Qe({query:He,client:I});Ee(()=>{V(n,x().data?.getAnnouncements||[],!0)});function ie(){if(t(n).find(e=>P(e.message,T)))$[t(n)[t(n).length-1].id].focus();else{const e={id:oe--,message:T,importance:Ve.Info};t(n).push(e),V(n,t(n),!0),setTimeout(()=>{const s=$[e.id];s.focus(),s.getElement().querySelectorAll("input")[0].select()},0)}}async function U(e){if(P(e.message,T))return;let s=!1;if(e.id<0){try{const c=(await S(I.mutation(Ke,{announcement:{importance:e.importance,message:e.message}}).toPromise()))();c.data&&(e.id=c.data.createAnnouncement.id,s=!0)}catch(c){console.log(...Be("log",c))}if(!s){y.error({description:`Failed to create Announcement '${e.message}'!`,duration:2e3});return}}else{try{e.message.length>0&&(s=P((await S(I.mutation(Re,{id:e.id,announcement:{importance:e.importance,message:e.message}}).toPromise()))().data.updateAnnouncement,null,!1))}catch{}if(!s){y.error({description:`Failed to update Announcement '${e.message}'!`,duration:2e3});return}}y.success({description:`Announcement '${e.message}' saved!`,duration:2e3})}async function ce(e){if(P(e.message,T,!1)){let s=!1;try{s=(await S(I.mutation(Xe,{id:e.id}).toPromise()))().data.deleteAnnouncement}catch{s=!1}if(!s){y.error({description:`Failed to remove Announcement '${e.message}'!`,duration:2e3});return}}else t(n).splice(t(n).indexOf(e),1);y.success({description:`Tag '${e.message}' removed!`,duration:2e3})}function le(e,s){e.stopPropagation(),ce(s)}var de={...Ge()},j=rt(),J=_(d(j),2),me=D(J);{var ue=e=>{var s=Ze();o(e,s)},pe=e=>{var s=E(),c=d(s);{var ve=p=>{var g=et(),w=D(g);F(g),X(()=>Z(w,`Failed to load announcements: ${x().error.message??""}`)),o(p,g)},_e=p=>{var g=st(),w=d(g);m(()=>k(w,{children:C(a,(he,nt)=>{var W=E(),$e=d(W);je(()=>t(n),A=>A.id),m(()=>Je($e,17,()=>t(n),A=>A.id,(A,r,ot)=>{var Y=E(),Ae=d(Y);m(()=>G(Ae,()=>k.Item,(be,ye)=>{ye(be,{get value(){return t(r).id},children:C(a,(xe,it)=>{var B=at(),H=d(B);m(()=>G(H,()=>k.ItemTrigger,(q,N)=>{N(q,{children:C(a,(M,Te)=>{Oe();var b=We();X(v=>Z(b,`(${t(r).importance??""}) ${v??""}`),[()=>(()=>{const l=t(r).message.substring(0,144);return t(r).message.length>144?l+"...":l})()]),o(M,b)}),$$slots:{default:!0}})}),"component",a,154,10,{componentTag:"Accordion.ItemTrigger"});var Ie=_(H,2);m(()=>G(Ie,()=>k.ItemContent,(q,N)=>{N(q,{children:C(a,(M,Te)=>{var b=tt(),v=d(b),l=_(D(v),2);ee(l),l.__change=()=>U(t(r)),L("bind:value={announcement.message}",[],()=>t(r),()=>"message",167,16),L("bind:this={nameFields[announcement.id]}",[],()=>$,()=>t(r).id,169,16),Ye(l,(i,De)=>$[De.id]=i,i=>$?.[i.id],()=>[t(r)]);var Q=_(l,4);ee(Q),Q.__change=()=>U(t(r)),L("bind:value={announcement.importance}",[],()=>t(r),()=>"importance",175,16),F(v);var we=_(v,2);we.__click=i=>le(i,t(r)),te(l,()=>t(r).message,i=>t(r).message=i),te(Q,()=>t(r).importance,i=>t(r).importance=i),o(M,b)}),$$slots:{default:!0}})}),"component",a,161,10,{componentTag:"Accordion.ItemContent"}),o(xe,B)}),$$slots:{default:!0}})}),"component",a,153,8,{componentTag:"Accordion.Item"}),o(A,Y)}),"each",a,152,6),o(he,W)}),$$slots:{default:!0}}),"component",a,151,4,{componentTag:"Accordion"});var O=_(w,2),fe=D(O);fe.__click=ie,F(O),o(p,g)};m(()=>R(c,p=>{x().error?p(ve):p(_e,!1)},!0),"if",a,148,2)}o(e,s)};m(()=>R(me,e=>{x().fetching?e(ue):e(pe,!1)}),"if",a,146,2)}F(J),o(ae,j);var ge=Le(de);return ne(),ge}Fe(["change","click"]);export{a as component};
//# sourceMappingURL=4.B5h7mNbP.js.map

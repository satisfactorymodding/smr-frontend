import{I as Ne,a as qe,p as Pe,X as Ae,J as B,N as K,aq as W,as as Fe,z as $,f as ze,g as v,k as m,h as c,m as d,q as o,r as Me,t as Qe,n as Y,L as w,C as Le,F as l,y as g,G as Ee,D as G,R as k,_ as ee,a0 as ae,au as C,a5 as N,a9 as Ge,u as a,T as Re,a6 as R,ab as Ue,ac as je,ag as te,Z as se,M as re,av as q,a2 as U,ad as He}from"../chunks/C6V5fW-3.js";import{g as Je,h as Oe,i as Se,j as Ve}from"../chunks/Bj1PSOzY.js";import{t as T}from"../chunks/BLzR2Xnx.js";t[l]="src/routes/admin/tag-manager/+page.svelte";var Xe=v(g('<h1 class="svelte-1pqzhs5">Loading tags...</h1>'),t[l],[[133,4]]),Ze=v(g('<h1 class="svelte-1pqzhs5"> </h1>'),t[l],[[135,4]]),Be=v(g('<div><div>Tag name</div> <input type="text" class="input p-2" placeholder="Name"/> <div>Tag description</div> <input type="text" class="input p-2" placeholder="Description"/></div> <span>Human-Readable name and description of the tag that is shown in UI</span> <button class="btn border border-error-500 preset-tonal-error"><span>Delete</span></button>',1),t[l],[[142,12,[[143,14],[144,14],[150,14],[151,14]]],[158,12],[160,12,[[161,14]]]]),Ke=v(g("<!> <!>",1),t[l],[]),We=v(g('<!> <section class="p-4"><button class="btn border border-primary-500 preset-tonal-primary"><span>Add new tag</span> <span class="material-icons">add</span></button></section>',1),t[l],[[168,4,[[169,6,[[170,8],[171,8]]]]]]),Ye=v(g('<h1 class="svelte-1pqzhs5">Mod Tag Manager</h1> <div class="card preset-filled-surface-100-900"><!></div>',1),t[l],[[129,0],[131,0]]);function t(ne,oe){qe(new.target),Pe(oe,!0,t);const P=()=>(Ee(A,"tagsQuery"),Le(A,"$tagsQuery",ie)),[ie,ce]=Qe(),b=Ae();let r=B(K(W([])),"tags"),de=-1;const y="New Tag",A=Fe({query:Je,client:b,variables:{limit:100}});A.subscribe(e=>{e.data?.getTags&&$(r,e.data?.getTags||[],!0)});let x=B(K(W(["0"])),"value");function le(){if(a(r).find(e=>q(e.name,y)))$(x,[a(r)[a(r).length-1].id],!0);else{const e={id:de--,name:y,description:"Description"};a(r).push(e),$(r,a(r),!0),setTimeout(()=>{$(x,[e.id],!0)},0)}}async function j(e){if(q(e.name,y))return;let s=!1;if(e.id<0){try{const i=(await U(b.mutation(Oe,{tagName:e.name,description:e.description}).toPromise()))();i.data&&(e.id=i.data.createTag.id,s=!0)}catch(i){console.log(...He("log",i))}if(!s){T.error({description:`Failed to create Tag '${e.name}'!`,duration:2e3});return}}else{try{s=q((await U(b.mutation(Se,{tagID:e.id,tagName:e.name,description:e.description}).toPromise()))().data.updateTag,null,!1)}catch{}if(!s){T.error({description:`Failed to update Tag '${e.name}'!`,duration:2e3});return}}T.success({description:`Tag '${e.name}' saved!`,duration:2e3})}async function pe(e){if(q(e.name,y,!1)){let s=!1;try{s=(await U(b.mutation(Ve,{tagID:e.id}).toPromise()))().data.deleteTag}catch{s=!1}if(!s){T.error({description:`Failed to remove Tag '${e.name}'!`,duration:2e3});return}}else a(r).splice(a(r).indexOf(e),1);T.success({description:`Tag '${e.name}' removed!`,duration:2e3})}function ue(e,s){e.stopPropagation(),pe(s)}var me={...ze()},H=Ye(),J=m(c(H),2),ve=w(J);{var ge=e=>{var s=Xe();o(e,s)},_e=e=>{var s=G(),i=c(s);{var he=p=>{var u=Ze(),D=w(u);k(u),ee(()=>ae(D,`Failed to load tags: ${P().error.message??""}`)),o(p,u)},$e=p=>{var u=We(),D=c(u);d(()=>C(D,{get value(){return a(x)},onValueChange:F=>$(x,F.value,!0),children:N(t,(F,ea)=>{var S=G(),be=c(S);Ge(()=>a(r),_=>_.id),d(()=>Re(be,17,()=>a(r),_=>_.id,(_,n,aa)=>{var V=G(),ye=c(V);d(()=>R(ye,()=>C.Item,(xe,De)=>{De(xe,{get value(){return a(n).id},children:N(t,(Ie,ta)=>{var X=Ke(),Z=c(X);d(()=>R(Z,()=>C.ItemTrigger,(z,M)=>{M(z,{children:N(t,(Q,ke)=>{Ue();var f=je();ee(()=>ae(f,a(n).name)),o(Q,f)}),$$slots:{default:!0}})}),"component",t,140,10,{componentTag:"Accordion.ItemTrigger"});var we=m(Z,2);d(()=>R(we,()=>C.ItemContent,(z,M)=>{M(z,{children:N(t,(Q,ke)=>{var f=Be(),L=c(f),I=m(w(L),2);te(I),I.__change=()=>j(a(n)),se("bind:value={tag.name}",()=>a(n),()=>"name",147,16);var E=m(I,4);te(E),E.__change=()=>j(a(n)),se("bind:value={tag.description}",()=>a(n),()=>"description",154,16),k(L);var Ce=m(L,4);Ce.__click=h=>ue(h,a(n)),re(I,()=>a(n).name,h=>a(n).name=h),re(E,()=>a(n).description,h=>a(n).description=h),o(Q,f)}),$$slots:{default:!0}})}),"component",t,141,10,{componentTag:"Accordion.ItemContent"}),o(Ie,X)}),$$slots:{default:!0}})}),"component",t,139,8,{componentTag:"Accordion.Item"}),o(_,V)}),"each",t,138,6),o(F,S)}),$$slots:{default:!0}}),"component",t,137,4,{componentTag:"Accordion"});var O=m(D,2),Te=w(O);Te.__click=le,k(O),o(p,u)};d(()=>Y(i,p=>{P().error?p(he):p($e,!1)},!0),"if",t,134,2)}o(e,s)};d(()=>Y(ve,e=>{P().fetching?e(ge):e(_e,!1)}),"if",t,132,2)}k(J),o(ne,H);var fe=Me(me);return ce(),fe}Ne(["change","click"]);export{t as component};
//# sourceMappingURL=6.Bl5Po7Uk.js.map

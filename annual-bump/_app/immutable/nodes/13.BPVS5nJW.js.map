{"version":3,"file":"13.BPVS5nJW.js","sources":["../../../../../../src/routes/guide/[guideId]/edit/+page.ts","../../../../../../src/routes/guide/[guideId]/edit/+page.svelte"],"sourcesContent":["import type { PageLoad } from './$types';\n\nexport const load: PageLoad = async ({ params }) => ({\n  ...params\n});\n","<script lang=\"ts\">\n  import { getContextClient, queryStore } from '@urql/svelte';\n  import { EditGuideDocument, GetGuideDocument } from '$lib/generated';\n  import { goto } from '$app/navigation';\n  import GuideForm from '$lib/components/guides/GuideForm.svelte';\n  import type { GuideData } from '$lib/models/guides';\n  import { base } from '$app/paths';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n  import type { PageData } from './$types';\n  import { toaster } from '$lib/utils/toaster-svelte';\n  import BasicModal from '$lib/components/general/BasicModal.svelte';\n\n  interface Props {\n    data: PageData;\n  }\n\n  let { data }: Props = $props();\n\n  let { guideId } = $derived(data);\n\n  const client = getContextClient();\n\n  let guide = $derived(\n    queryStore({\n      query: GetGuideDocument,\n      client,\n      variables: { guide: guideId }\n    })\n  );\n\n  const onSubmit = (guideData: GuideData) => {\n    client\n      .mutation(EditGuideDocument, {\n        guideId: guideId,\n        guide: guideData\n      })\n      .toPromise()\n      .then((value) => {\n        if (value.error) {\n          console.error(value.error.message);\n          toaster.error({\n            description: 'Error editing guide: ' + value.error.message\n          });\n        } else {\n          toaster.success({\n            description: `Guide updated`,\n            duration: 5000\n          });\n          goto(base + '/guide/' + value.data.updateGuide.id);\n        }\n      });\n  };\n\n  const goBackFn = () => {\n    goto(base + '/guide/' + guideId);\n  };\n\n  let backModalOpen = $state(false);\n</script>\n\n<svelte:head>\n  {#if !$guide.fetching && !$guide.error && $guide.data.getGuide}\n    <MetaDescriptors\n      description=\"Editing guide '{$guide.data.getGuide.short_description}'\"\n      title=\"Edit guide '{$guide.data.getGuide.name}'\" />\n  {/if}\n</svelte:head>\n\n<div class=\"flex h-auto flex-wrap items-center justify-between\">\n  <h1 class=\"my-4 text-4xl font-bold\">Edit Guide</h1>\n  <div>\n    <BasicModal\n      bind:open={backModalOpen}\n      title=\"Go Back?\"\n      body=\"Going back will discard any unsaved changes. Are you sure you wish to continue?\"\n      buttonTextCancel=\"Keep Editing\"\n      buttonTextConfirm=\"Go Back\"\n      confirm={goBackFn} />\n    <button class=\"btn border border-primary-500 preset-tonal-primary\" onclick={() => (backModalOpen = true)}>\n      <span class=\"material-icons pr-2\">arrow_back</span>\n      Back to Guide</button>\n  </div>\n</div>\n\n<div class=\"card preset-filled-surface-100-900 p-4\">\n  <section>\n    {#if $guide.fetching}\n      <p>Loading...</p>\n    {:else if $guide.error}\n      <p>Oh no... {$guide.error.message}</p>\n    {:else}\n      <GuideForm {onSubmit} initialValues={$guide.data.getGuide} submitText=\"Save\" submitIcon=\"save\" />\n    {/if}\n  </section>\n</div>\n"],"names":["load","params","guideId","client","getContextClient","guide","$.tag","queryStore","GetGuideDocument","$.get","onSubmit","guideData","EditGuideDocument","value","$.log_if_contains_state","toaster","goto","base","goBackFn","backModalOpen","$guide","$$render","consequent","$$value","button","$.set","consequent_2","alternate","consequent_1","alternate_1"],"mappings":"4eAEO,MAAMA,GAAiB,MAAO,CAAE,OAAAC,MAAc,CACnD,GAAGA,CACL,krBCJA,uFAkBQ,IAAAC,iBAAA,OAAO,EAAA,SAAA,EAEP,MAAAC,EAASC,EAAgB,MAE3BC,EAAKC,QACPC,GAAU,CACR,MAAOC,GACP,OAAAL,EACA,UAAS,CAAI,MAAKM,EAAEP,CAAO,CAAA,oBAIzBQ,EAAYC,GAAyB,CACzCR,EACG,SAASS,GAAiB,CACzB,UAASV,CAAO,EAChB,MAAOS,IAER,UAAS,EACT,KAAME,GAAU,CACXA,EAAM,OACR,QAAQ,MAAK,GAAAC,GAAA,QAACD,EAAM,MAAM,OAAO,CAAA,EACjCE,EAAQ,MAAK,CACX,YAAa,wBAA0BF,EAAM,MAAM,QAAA,IAGrDE,EAAQ,QAAO,CACb,YAAW,gBACX,SAAU,IAAA,EAEZC,EAAKC,EAAO,UAAYJ,EAAM,KAAK,YAAY,EAAE,EAErD,CAAC,CACL,EAEMK,EAAQ,IAAS,CACrBF,EAAKC,EAAO,YAAYf,CAAO,CAAA,CACjC,EAEI,IAAAiB,OAAuB,EAAK,EAAA,eAAA,0FAMC,MAAA,kBAAAC,IAAO,KAAK,SAAS,mBAAiB,EAAA,iBAC/C,MAAA,eAAAA,IAAO,KAAK,SAAS,MAAI,EAAA,4EAH3CA,EAAM,EAAC,UAAQ,CAAKA,EAAM,EAAC,OAASA,EAAM,EAAC,KAAK,UAAQC,EAAAC,CAAA,gPAgBjDJ,sBALEC,CAAa,iBAAbA,EAAaI,EAAA,EAAA,kEAMyDC,EAAA,QAAA,IAAAC,EAAAN,EAAgB,EAAI,sJAWxFC,EAAM,EAAC,MAAM,SAAO,EAAA,EAAA,CAAA,kEAEIA,EAAM,EAAC,KAAK,8GAHzCA,EAAM,EAAC,MAAKC,EAAAK,CAAA,EAAAL,EAAAM,EAAA,EAAA,0CAFjBP,EAAM,EAAC,SAAQC,EAAAO,CAAA,EAAAP,EAAAQ,EAAA,EAAA,0DA5BxB"}
{"version":3,"file":"20.LearVIrr.js","sources":["../../../../../../src/routes/mod/[modId]/version/[versionId]/edit/+page.ts","../../../../../../src/routes/mod/[modId]/version/[versionId]/edit/+page.svelte"],"sourcesContent":["import type { PageLoad } from './$types';\n\nexport const load: PageLoad = async ({ params }) => ({\n  ...params\n});\n","<script lang=\"ts\">\n  import { queryStore, getContextClient } from '@urql/svelte';\n  import { GetModVersionDocument, UpdateVersionDocument } from '$lib/generated';\n  import { goto } from '$app/navigation';\n  import VersionForm from '$lib/components/versions/VersionForm.svelte';\n  import type { VersionData } from '$lib/models/versions';\n  import { base } from '$app/paths';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n  import type { PageData } from './$types';\n  import { toaster } from '$lib/utils/toaster-svelte';\n  import BasicModal from '$lib/components/general/BasicModal.svelte';\n\n  interface Props {\n    data: PageData;\n  }\n\n  let { data }: Props = $props();\n\n  let { modId, versionId } = $derived(data);\n\n  const client = getContextClient();\n\n  let version = $derived(\n    queryStore({\n      query: GetModVersionDocument,\n      client,\n      variables: { version: versionId }\n    })\n  );\n\n  const onSubmit = async (versionData: VersionData) =>\n    client\n      .mutation(UpdateVersionDocument, {\n        versionId: versionId,\n        version: versionData\n      })\n      .toPromise()\n      .then((value) => {\n        if (value.error) {\n          console.error(value.error.message);\n          toaster.error({\n            description: 'Error editing version: ' + value.error.message\n          });\n        } else {\n          toaster.success({\n            description: `Version updated`,\n            duration: 5000\n          });\n          return goto(base + '/mod/' + modId + '/version/' + versionId);\n        }\n      });\n\n  let initialValues = $derived(\n    $version.data\n      ? {\n          ...$version.data.getVersion,\n          logo: undefined\n        }\n      : undefined\n  );\n\n  const goBackFn = () => {\n    goto(base + '/mod/' + modId + '/version/' + versionId);\n  };\n\n  let backModalOpen = $state(false);\n</script>\n\n<svelte:head>\n  {#if !$version.fetching && !$version.error && $version.data.getVersion}\n    <MetaDescriptors\n      description=\"Editing mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\"\n      title=\"Edit mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\" />\n  {/if}\n</svelte:head>\n\n<div class=\"flex h-auto flex-wrap items-center justify-between\">\n  <h1 class=\"my-4 text-4xl font-bold\">Edit Version</h1>\n  <div>\n    <BasicModal\n      bind:open={backModalOpen}\n      title=\"Go Back?\"\n      body=\"Going back will discard any unsaved changes. Are you sure you wish to continue?\"\n      buttonTextCancel=\"Keep Editing\"\n      buttonTextConfirm=\"Go Back\"\n      confirm={goBackFn} />\n    <button class=\"btn border border-primary-500 preset-tonal-primary\" onclick={() => (backModalOpen = true)}>\n      <span class=\"material-icons pr-2\">arrow_back</span>\n      Back to Versions</button>\n  </div>\n</div>\n\n<div class=\"card preset-filled-surface-100-900 p-4\">\n  <section>\n    {#if $version.fetching}\n      <p>Loading...</p>\n    {:else if $version.error}\n      <p>Oh no... {$version.error.message}</p>\n    {:else}\n      <VersionForm\n        {onSubmit}\n        {initialValues}\n        modReference={$version.data.getVersion.mod.mod_reference}\n        editing={true}\n        submitText=\"Save\"\n        submitIcon=\"save\" />\n    {/if}\n  </section>\n</div>\n"],"names":["load","params","modId","versionId","client","getContextClient","version","$.tag","queryStore","GetModVersionDocument","$.get","onSubmit","versionData","UpdateVersionDocument","value","$.log_if_contains_state","toaster","goto","base","initialValues","$.derived","$version","goBackFn","backModalOpen","$$render","consequent","$$value","button","$.set","consequent_2","alternate","consequent_1","alternate_1"],"mappings":"mfAEO,MAAMA,GAAiB,MAAO,CAAE,OAAAC,MAAc,CACnD,GAAGA,CACL,usBCJA,4FAkBQ,IAAAC,iBAAA,KAAK,EAAA,OAAA,EAAEC,iBAAA,SAAS,EAAA,WAAA,EAEhB,MAAAC,EAASC,GAAgB,MAE3BC,EAAOC,QACTC,GAAU,CACR,MAAOC,GACP,OAAAL,EACA,UAAS,CAAI,QAAOM,EAAEP,CAAS,CAAA,sBAI7BQ,EAAQ,MAAUC,GACtBR,EACG,SAASS,IACR,UAASH,EAAEP,CAAS,EACpB,QAASS,CAAA,CAAA,EAEV,YACA,KAAME,GAAU,IACXA,EAAM,MACR,QAAQ,MAAK,GAAAC,GAAA,QAACD,EAAM,MAAM,OAAO,CAAA,EACjCE,EAAQ,MAAK,CACX,YAAa,0BAA4BF,EAAM,MAAM,QAAA,MAGvD,QAAAE,EAAQ,QAAO,CACb,YAAW,kBACX,SAAU,IAAA,EAELC,EAAKC,EAAO,UAAUhB,CAAK,EAAG,YAAWQ,EAAGP,CAAS,CAAA,CAEhE,CAAC,MAEDgB,EAAaZ,EACfa,EAAA,IAAAC,IAAS,KAEA,CAAA,GAAAA,EAAQ,EAAC,KAAK,WACjB,KAAM,MAAA,EAER,MAAA,mBAGA,MAAAC,EAAQ,IAAS,CACrBL,EAAKC,EAAO,UAAUhB,CAAK,EAAG,YAAWQ,EAAGP,CAAS,CAAA,CACvD,EAEI,IAAAoB,OAAuB,EAAK,EAAA,eAAA,0FAMM,MAAA,uBAAAF,EAAQ,EAAC,KAAK,WAAW,IAAI,MAAI,EAAA,IAAGA,EAAQ,EAAC,KAAK,WAAW,SAAO,EAAA,gBAC7E,MAAA,oBAAAA,EAAQ,EAAC,KAAK,WAAW,IAAI,MAAI,EAAA,IAAGA,EAAQ,EAAC,KAAK,WAAW,SAAO,EAAA,2EAH3FA,EAAQ,EAAC,UAAQ,CAAKA,EAAQ,EAAC,OAASA,EAAQ,EAAC,KAAK,YAAUG,EAAAC,CAAA,gPAgBzDH,sBALEC,CAAa,iBAAbA,EAAaG,EAAA,EAAA,kEAMyDC,EAAA,QAAA,IAAAC,EAAAL,EAAgB,EAAI,sJAWxFF,EAAQ,EAAC,MAAM,SAAO,EAAA,EAAA,CAAA,2FAKnB,OAAAA,EAAQ,EAAC,KAAK,WAAW,IAAI,uBAClC,0GAPHA,EAAQ,EAAC,MAAKG,EAAAK,CAAA,EAAAL,EAAAM,EAAA,EAAA,0CAFnBT,EAAQ,EAAC,SAAQG,EAAAO,CAAA,EAAAP,EAAAQ,EAAA,EAAA,0DA5B1B"}
{"version":3,"file":"5.BsSw0jYC.js","sources":["../../../../../../src/routes/admin/satisfactory-versions/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { getContextClient, queryStore } from '@urql/svelte';\n  import {\n    CreateSatisfactoryVersionDocument,\n    DeleteSatisfactoryVersionDocument,\n    GetSatisfactoryVersionsDocument,\n    UpdateSatisfactoryVersionDocument,\n    type GetSatisfactoryVersionsQuery\n  } from '$lib/generated';\n  import { Accordion } from '@skeletonlabs/skeleton-svelte';\n  import { toaster } from '$lib/utils/toaster-svelte';\n\n  type SatisfactoryVersion = GetSatisfactoryVersionsQuery['getSatisfactoryVersions'][number];\n\n  const client = getContextClient();\n\n  const panels = {};\n  const versionFields = $state({});\n\n  const satisfactoryVersionsQuery = queryStore({\n    query: GetSatisfactoryVersionsDocument,\n    client\n  });\n\n  let satisfactoryVersions = $derived($satisfactoryVersionsQuery.data?.getSatisfactoryVersions || []);\n\n  function newSatisfactoryVersion() {\n    if (!satisfactoryVersions.find((satisfactoryVersion) => satisfactoryVersion.id < 0)) {\n      const satisfactoryVersion = { id: -1, version: 0, engine_version: '4.26' } as SatisfactoryVersion;\n      satisfactoryVersions.push(satisfactoryVersion);\n      satisfactoryVersions = satisfactoryVersions;\n      setTimeout(() => {\n        panels[satisfactoryVersion.id].setOpen(true);\n        const field = versionFields[satisfactoryVersion.id];\n        field.focus();\n        const input = field.getElement().querySelectorAll('input')[0] as HTMLInputElement;\n        input.select();\n      }, 0);\n    } else {\n      panels[satisfactoryVersions[satisfactoryVersions.length - 1].id].setOpen(true);\n      versionFields[satisfactoryVersions[satisfactoryVersions.length - 1].id].focus();\n    }\n  }\n\n  async function satisfactoryVersionChange(satisfactoryVersion: SatisfactoryVersion) {\n    if (satisfactoryVersion.version === 0) {\n      return;\n    }\n\n    console.log(satisfactoryVersion);\n\n    let success = false;\n    if (satisfactoryVersion.id < 0) {\n      // Create new satisfactory version & update satisfactoryVersion.id with new DB id or re-fetch all satisfactory versions\n      try {\n        const result = await client\n          .mutation(CreateSatisfactoryVersionDocument, {\n            satisfactoryVersion: {\n              version: satisfactoryVersion.version,\n              engine_version: satisfactoryVersion.engine_version\n            }\n          })\n          .toPromise();\n        if (result.data) {\n          satisfactoryVersion.id = result.data.createSatisfactoryVersion.id;\n          success = true;\n        }\n      } catch (err) {\n        console.log(err);\n      }\n      if (!success) {\n        toaster.error({\n          description: `Failed to create Satisfactory version '${satisfactoryVersion.version}'!`,\n          duration: 2000\n        });\n        return;\n      }\n    } else {\n      // Update existing satisfactory version\n      try {\n        success =\n          (\n            await client\n              .mutation(UpdateSatisfactoryVersionDocument, {\n                id: satisfactoryVersion.id,\n                satisfactoryVersion: {\n                  version: satisfactoryVersion.version,\n                  engine_version: satisfactoryVersion.engine_version\n                }\n              })\n              .toPromise()\n          ).data.updateSatisfactoryVersion != null;\n      } catch {\n        // nothing\n      }\n      if (!success) {\n        toaster.error({\n          description: `Failed to update Satisfactory version '${satisfactoryVersion.version}'!`,\n          duration: 2000\n        });\n        return;\n      }\n    }\n\n    toaster.success({\n      description: `Satisfactory version '${satisfactoryVersion.version}' saved!`,\n      duration: 2000\n    });\n  }\n\n  async function deleteSatisfactoryVersion(satisfactoryVersion: SatisfactoryVersion) {\n    if (!(satisfactoryVersion.id < 0)) {\n      // Remove satisfactory version\n      let success = false;\n      try {\n        const result = await client\n          .mutation(DeleteSatisfactoryVersionDocument, { satisfactoryVersionID: satisfactoryVersion.id })\n          .toPromise();\n        success = result.data.deleteSatisfactoryVersion;\n        if (success) {\n          satisfactoryVersions = satisfactoryVersions.filter((version) => version.id !== satisfactoryVersion.id);\n        }\n      } catch {\n        success = false;\n      }\n      if (!success) {\n        toaster.error({\n          description: `Failed to remove Satisfactory version '${satisfactoryVersion.version}'!`,\n          duration: 2000\n        });\n        return;\n      }\n    }\n\n    toaster.success({\n      description: `Satisfactory version '${satisfactoryVersion.version}' removed!`,\n      duration: 2000\n    });\n  }\n\n  function onDeleteClick(e: Event, satisfactoryVersion: SatisfactoryVersion) {\n    e.stopPropagation();\n    deleteSatisfactoryVersion(satisfactoryVersion);\n  }\n</script>\n\n<h1>Satisfactory Versions</h1>\n\n<div class=\"card preset-filled-surface-100-900\">\n  {#if $satisfactoryVersionsQuery.fetching}\n    <h1>Loading satisfactory versions...</h1>\n  {:else if $satisfactoryVersionsQuery.error}\n    <h1>Failed to load satisfactory versions: {$satisfactoryVersionsQuery.error.message}</h1>\n  {:else}\n    <Accordion>\n      {#each satisfactoryVersions as satisfactoryVersion (satisfactoryVersion.id)}\n        <Accordion.Item value={satisfactoryVersion.id}>\n          <Accordion.ItemTrigger>\n            {satisfactoryVersion.version}\n          </Accordion.ItemTrigger>\n          <Accordion.ItemContent>\n            <div>\n              <div>Game CL#</div>\n              <input\n                type=\"text\"\n                class=\"input p-2\"\n                bind:value={satisfactoryVersion.version}\n                placeholder=\"Version\"\n                bind:this={versionFields[satisfactoryVersion.id]}\n                onchange={() => satisfactoryVersionChange(satisfactoryVersion)} />\n              <div>Engine Version</div>\n              <input\n                type=\"text\"\n                class=\"input p-2\"\n                bind:value={satisfactoryVersion.engine_version}\n                placeholder=\"Engine version\"\n                onchange={() => satisfactoryVersionChange(satisfactoryVersion)} />\n            </div>\n\n            <button\n              class=\"btn border border-error-500 preset-tonal-error\"\n              onclick={(e) => onDeleteClick(e, satisfactoryVersion)}>\n              <span>Delete</span>\n            </button>\n          </Accordion.ItemContent>\n        </Accordion.Item>\n      {/each}\n    </Accordion>\n\n    <section class=\"p-4\">\n      <button class=\"btn border border-primary-500 preset-tonal-primary\" onclick={newSatisfactoryVersion}>\n        <span>Add new Satisfactory version</span>\n        <span class=\"material-icons\">add</span>\n      </button>\n    </section>\n  {/if}\n</div>\n\n<style lang=\"postcss\">\n  @reference \"../../../app.css\";\n\n  h1 {\n    @apply my-4 text-4xl font-bold;\n  }\n</style>\n"],"names":["client","getContextClient","panels","versionFields","$.tag_proxy","$.proxy","satisfactoryVersionsQuery","queryStore","GetSatisfactoryVersionsDocument","satisfactoryVersions","$.tag","$.derived","$satisfactoryVersionsQuery","newSatisfactoryVersion","satisfactoryVersion","$.get","$.set","field","satisfactoryVersionChange","$.strict_equals","$.log_if_contains_state","success","result","$.track_reactivity_loss","CreateSatisfactoryVersionDocument","err","toaster","$.equals","UpdateSatisfactoryVersionDocument","deleteSatisfactoryVersion","DeleteSatisfactoryVersionDocument","version","onDeleteClick","$.validate_each_keys","$.each","node_3","$$index","$.template_effect","$.set_text","text_1","input_1","$.bind_this","$$value","input_2","button","e","$.bind_value","$$render","consequent_1","alternate","consequent","alternate_1"],"mappings":"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"}
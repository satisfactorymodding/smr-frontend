{"version":3,"file":"8.CEk-oCg4.js","sources":["../../../../../../src/routes/admin/unapproved-versions/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { ApproveVersionDocument, DenyVersionDocument, GetUnapprovedVersionsDocument } from '$lib/generated';\n  import { getContextClient, queryStore } from '@urql/svelte';\n  import { API_REST } from '$lib/core';\n  import { base } from '$app/paths';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n  import { prettyDate } from '$lib/utils/formatting';\n  import Pager from '$lib/components/general/Pager.svelte';\n\n  const client = getContextClient();\n\n  let perPage = $state(20);\n  let page = $state(1);\n\n  let versions = $derived(\n    queryStore({\n      query: GetUnapprovedVersionsDocument,\n      client,\n      variables: {\n        filter: {\n          offset: (page - 1) * perPage,\n          limit: perPage\n        }\n      }\n    })\n  );\n\n  let totalVersions = $derived($versions?.data?.getUnapprovedVersions?.count);\n\n  const approveVersion = (versionId: string) => {\n    client\n      .mutation(ApproveVersionDocument, { versionId })\n      .toPromise()\n      .then(() => {\n        versions.pause();\n        versions.resume();\n      });\n  };\n\n  const denyVersion = (versionId: string) => {\n    client\n      .mutation(DenyVersionDocument, { versionId })\n      .toPromise()\n      .then(() => {\n        versions.pause();\n        versions.resume();\n      });\n  };\n</script>\n\n<svelte:head>\n  <MetaDescriptors description=\"Unapproved mod versions\" title=\"Admin: Unapproved Versions\" />\n</svelte:head>\n\n<h1>Unapproved Versions</h1>\n\n{#if totalVersions}\n  <div class=\"mb-5 ml-auto flex justify-end\">\n    <div>\n      <Pager bind:page bind:perPage total={totalVersions} />\n    </div>\n  </div>\n{/if}\n\n<div class=\"card preset-filled-surface-100-900\">\n  {#if $versions.fetching}\n    <section class=\"p-4\">Loading...</section>\n  {:else if $versions.error}\n    <section class=\"p-4\">Oh no... {$versions.error.message}</section>\n  {:else}\n    <table class=\"table max-w-full\">\n      <thead>\n        <tr>\n          <th>Mod</th>\n          <th>Version</th>\n          <th>Release Date</th>\n          <th><!-- Buttons --></th>\n        </tr>\n      </thead>\n      <tbody>\n        {#each $versions.data.getUnapprovedVersions.versions as version (version.id)}\n          <tr>\n            <td>{version.mod.name}</td>\n            <td>{version.version}</td>\n            <td>{prettyDate(version.created_at)}</td>\n            <td class=\"!p-2.5\">\n              <div class=\"grid grid-flow-col gap-4\">\n                <button\n                  class=\"btn border border-primary-500 preset-tonal-primary\"\n                  onclick={() => approveVersion(version.id)}>Approve</button>\n                <button\n                  class=\"btn border border-primary-500 preset-tonal-primary\"\n                  onclick={() => denyVersion(version.id)}>Deny</button>\n                <a\n                  class=\"btn border border-primary-500 preset-tonal-primary\"\n                  href={API_REST + '/mod/' + version.mod_id + '/versions/' + version.id + '/download'}>\n                  Download\n                </a>\n                <a\n                  class=\"btn border border-primary-500 preset-tonal-primary\"\n                  href={base + '/mod/' + version.mod_id + '/version/' + version.id}>\n                  View\n                </a>\n              </div>\n            </td>\n          </tr>\n        {/each}\n      </tbody>\n    </table>\n  {/if}\n</div>\n\n{#if totalVersions}\n  <div class=\"mt-5 ml-auto flex justify-end\">\n    <Pager bind:page bind:perPage total={totalVersions} />\n  </div>\n{/if}\n\n<style lang=\"postcss\">\n  @reference \"../../../app.css\";\n\n  h1 {\n    @apply my-4 text-4xl font-bold;\n  }\n</style>\n"],"names":["client","getContextClient","perPage","page","versions","$.tag","queryStore","GetUnapprovedVersionsDocument","$.get","totalVersions","$versions","approveVersion","versionId","ApproveVersionDocument","denyVersion","DenyVersionDocument","$$render","consequent","version","$.each","tbody","$.set_text","text_2","$.set_attribute","a","API_REST","base","prettyDate","consequent_2","alternate","consequent_1","alternate_1","consequent_3"],"mappings":"2xDAAA,+FASQA,EAASC,GAAgB,EAE3B,IAAAC,MAAiB,EAAE,EAAA,SAAA,EACnBC,MAAc,CAAC,EAAA,MAAA,EAEfC,EAAQC,QACVC,GAAU,CACR,MAAOC,GACP,OAAAP,EACA,UAAS,CACP,OAAM,CACJ,QAAMQ,EAAGL,CAAI,EAAG,KAAKD,CAAO,EAC5B,MAAKM,EAAEN,CAAA,mBAMXO,UAAyBC,KAAW,MAAM,uBAAuB,KAAK,EAAA,eAAA,QAEpEC,EAAkBC,GAAsB,CAC5CZ,EACG,SAASa,GAAsB,CAAI,UAAAD,CAAS,CAAA,EAC5C,UAAS,EACT,KAAI,IAAO,CACVJ,EAAAJ,CAAQ,EAAC,MAAK,EACdI,EAAAJ,CAAQ,EAAC,OAAM,CACjB,CAAC,CACL,EAEMU,EAAeF,GAAsB,CACzCZ,EACG,SAASe,GAAmB,CAAI,UAAAH,CAAS,CAAA,EACzC,UAAS,EACT,KAAI,IAAO,CACVJ,EAAAJ,CAAQ,EAAC,MAAK,EACdI,EAAAJ,CAAQ,EAAC,OAAM,CACjB,CAAC,CACL,oQAYyCK,CAAa,sLAHnDA,CAAa,GAAAO,EAAAC,EAAA,sJAYiBP,EAAS,EAAC,MAAM,SAAO,EAAA,EAAA,CAAA,4CAY3CA,EAAS,EAAC,KAAK,sBAAsB,SAAYQ,GAASA,EAAQ,EAAE,IAApE,IAAAC,GAAAC,EAAA,EAAA,IAAAV,EAAS,EAAC,KAAK,sBAAsB,SAAYQ,GAASA,EAAQ,MAAjBA,IAAO,gIAStCP,EAAcH,EAACU,CAAO,EAAC,EAAE,6BAGzBJ,EAAWN,EAACU,CAAO,EAAC,EAAE,sDAVtCA,CAAO,EAAC,IAAI,IAAI,EAChBG,EAAAC,GAAAd,EAAAU,CAAO,EAAC,OAAO,WAYRK,EAAAC,EAAA,OAAAC,GAAW,QAAOjB,EAAGU,CAAO,EAAC,OAAS,aAAYV,EAAGU,CAAO,EAAC,GAAK,WAAW,cAK7EQ,GAAO,QAAOlB,EAAGU,CAAO,EAAC,OAAS,YAAWV,EAAGU,CAAO,EAAC,EAAE,QAhBjES,GAAUnB,EAACU,CAAO,EAAC,UAAU,CAAA,2DAjBlCR,EAAS,EAAC,MAAKM,EAAAY,CAAA,EAAAZ,EAAAa,EAAA,EAAA,2CAFpBnB,EAAS,EAAC,SAAQM,EAAAc,EAAA,EAAAd,EAAAe,GAAA,EAAA,kGAiDgBtB,CAAa,mLAFjDA,CAAa,GAAAO,EAAAgB,EAAA,oDAhElB"}
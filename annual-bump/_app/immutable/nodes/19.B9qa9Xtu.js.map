{"version":3,"file":"19.B9qa9Xtu.js","sources":["../../../../../../src/routes/mod/[modId]/version/[versionId]/+page.ts","../../../../../../src/lib/components/versions/VersionDescription.svelte","../../../../../../src/lib/components/versions/VersionInfo.svelte","../../../../../../src/lib/components/versions/VirustotalResults.svelte","../../../../../../src/routes/mod/[modId]/version/[versionId]/+page.svelte"],"sourcesContent":["import type { PageLoad } from './$types';\nimport { queryStore } from '@urql/svelte';\nimport { GetModVersionDocument } from '$lib/generated';\nimport { loadWaitForNoFetch } from '$lib/utils/gql';\n\nexport const load: PageLoad = async ({ params, parent }) => ({\n  ...params,\n  ...(await loadWaitForNoFetch({\n    version: queryStore({\n      query: GetModVersionDocument,\n      client: (await parent()).client,\n      variables: { version: params.versionId }\n    })\n  }))\n});\n","<script lang=\"ts\">\n  import { AnnouncementImportance } from '$lib/generated';\n  import { markdown } from '$lib/utils/markdown';\n  import AnnouncementRow from '../announcements/AnnouncementRow.svelte';\n\n  interface Props {\n    changelog: string;\n    approved: boolean;\n  }\n\n  let { changelog, approved }: Props = $props();\n</script>\n\n<div>\n  {#if !approved}\n    <div class=\"p-4\">\n      <AnnouncementRow\n        importance={AnnouncementImportance.Warning}\n        message=\"This version has not yet been approved by the virus scanner and is hidden until this process is complete. If this message isn't gone in the next few minutes, ask for manual approval on the Discord.\" />\n    </div>\n  {/if}\n  <div class=\"h-fit card preset-filled-surface-100-900 p-4\">\n    <section>\n      <div class=\"markdown-content break-words\">\n        {#await markdown(changelog) then changelogRendered}\n          <!-- eslint-disable -->\n          <p>{@html changelogRendered}</p>\n        {/await}\n      </div>\n    </section>\n  </div>\n</div>\n","<script lang=\"ts\">\n  import type { Version } from '$lib/generated';\n  import { prettyBytes, prettyDate, prettyNumber } from '$lib/utils/formatting';\n  import { getTranslate } from '@tolgee/svelte';\n\n  interface Props {\n    version: Pick<Version, 'created_at' | 'game_version' | 'size' | 'downloads' | 'hash'>;\n  }\n\n  let { version }: Props = $props();\n\n  export const { t } = getTranslate();\n</script>\n\n<div class=\"card preset-filled-surface-100-900 p-4\">\n  <section>\n    <div class=\"text-lg break-words\">\n      <h3 class=\"my-4 text-2xl font-bold\">Info</h3>\n      <span><strong>{$t('entry.created-at')}:</strong> {prettyDate(version.created_at)}</span><br />\n      <span><strong>{$t('downloads')}:</strong> {prettyNumber(version.downloads)}</span><br />\n      <span><strong>{$t('game-versions')}:</strong> {version.game_version}</span><br />\n      <span><strong>{$t('size')}:</strong> {prettyBytes(version.size)}</span><br />\n      <span><strong>{$t('hash')}:</strong> {version.hash}</span>\n    </div>\n  </section>\n</div>\n","<script lang=\"ts\">\n  import type { VirustotalResult } from '$lib/generated';\n  import { getTranslate } from '@tolgee/svelte';\n\n  interface Props {\n    results: Array<VirustotalResult>;\n  }\n\n  let { results }: Props = $props();\n  export const { t } = getTranslate();\n</script>\n\n<div class=\"grid grid-flow-row\">\n  <h3 class=\"my-4 text-2xl font-bold\">{$t('virustotal.table.title')}</h3>\n  <table aria-label={$t('virustotal.table.title')} class=\"max-w-auto table !overflow-visible\">\n    <tbody>\n      <tr class=\"rounded border !border-surface-500\">\n        <td style=\"width: 25%;\"\n          ><div title={$t('virustotal.table.file_name')}>\n            {$t('virustotal.table.file_name')}\n          </div></td>\n        <td style=\"width: 25%;\"\n          ><div class=\"text-center\" title={$t('virustotal.table.results')}>{$t('virustotal.table.results')}</div></td>\n        <td style=\"width: 25%;\"\n          ><div class=\"text-center\" title={$t('virustotal.table.safe')}>{$t('virustotal.table.safe')}</div></td>\n      </tr>\n      {#each results as result (result.file_name)}\n        <tr class=\"rounded border !border-surface-500\">\n          <td>\n            <div>{result.file_name}</div>\n          </td>\n          <td>\n            <div class=\"text-center\">\n              <a\n                title={$t('version.virustotal.result')}\n                href={`https://www.virustotal.com/gui/file/${result.hash}`}\n                target=\"_blank\"\n                class=\"text-white\">\n                <span class=\"material-icons text-center\" style=\"width: 20px\" title={$t('version.virustotal.result')}>\n                  policy\n                </span>\n              </a>\n            </div>\n          </td>\n          <td\n            ><div class=\"text-center\">\n              <span\n                class=\"material-icons text-center\"\n                style=\"width: 20px\"\n                title={result.safe ? $t('version.virustotal.safe') : $t('version.virustotal.not_safe')}>\n                {result.safe ? 'checkmark' : 'cancel'}\n              </span>\n            </div>\n          </td>\n        </tr>\n      {/each}\n    </tbody>\n  </table>\n</div>\n","<script lang=\"ts\">\n  import { DeleteVersionDocument } from '$lib/generated';\n  import VersionDescription from '$lib/components/versions/VersionDescription.svelte';\n  import VersionInfo from '$lib/components/versions/VersionInfo.svelte';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n  import { API_REST } from '$lib/core';\n  import { goto } from '$app/navigation';\n  import { user } from '$lib/stores/user';\n  import { base } from '$app/paths';\n  import { installMod } from '$lib/stores/launcher';\n  import { prettyTarget } from '$lib/utils/formatting';\n  import VersionTargetSupportGrid from '$lib/components/versions/VersionTargetSupportGrid.svelte';\n  import VersionDependenciesGrid from '$lib/components/versions/VersionDependenciesGrid.svelte';\n  import { getContextClient } from '@urql/svelte';\n  import type { PageData } from './$types';\n  import Page404 from '$lib/components/general/Page404.svelte';\n  import { getTranslate } from '@tolgee/svelte';\n  import VirustotalResults from '$lib/components/versions/VirustotalResults.svelte';\n  import { toaster } from '$lib/utils/toaster-svelte';\n  import BasicModal from '$lib/components/general/BasicModal.svelte';\n  import { Popover, Portal } from '@skeletonlabs/skeleton-svelte';\n\n  const { t } = getTranslate();\n\n  interface Props {\n    data: PageData;\n  }\n\n  let { data }: Props = $props();\n\n  const { modId, versionId, version } = data;\n\n  const client = getContextClient();\n\n  let canUserEdit = $derived(\n    $user?.roles?.deleteContent ||\n      $version?.data?.getVersion.mod?.authors?.findIndex((author) => author.user_id == $user?.id) >= 0\n  );\n\n  const deleteVersionFn = () => {\n    client\n      .mutation(DeleteVersionDocument, { versionId })\n      .toPromise()\n      .then((value) => {\n        if (value.error) {\n          console.error(value.error.message);\n          toaster.error({\n            description: 'Error deleting version: ' + value.error.message\n          });\n        } else {\n          toaster.success({\n            description: `Version deleted`,\n            duration: 5000\n          });\n          goto(base + '/mod/' + modId);\n        }\n      });\n  };\n\n  let deleteModalOpen = $state(false);\n</script>\n\n<svelte:head>\n  {#if !$version.fetching && !$version.error && $version.data.getVersion}\n    <MetaDescriptors\n      description=\"Information for mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\"\n      title=\"Mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\" />\n  {/if}\n</svelte:head>\n\n{#if $version.fetching}\n  <p>Loading...</p>\n{:else if $version.error}\n  <p>Oh no... {$version.error.message}</p>\n{:else if $version.data.getVersion}\n  <div class=\"xlx:grid-flow-row grid gap-6\">\n    <div class=\"flex h-auto flex-wrap items-center justify-between\">\n      <h1 class=\"text-4xl font-bold\">\n        {$version.data.getVersion.mod.name}\n        Version {$version.data.getVersion.version}\n      </h1>\n\n      <div class=\"grid grid-flow-col gap-4\">\n        {#if canUserEdit}\n          <button\n            class=\"btn border border-primary-500 preset-tonal-primary\"\n            onclick={() => goto(base + '/mod/' + modId + '/version/' + versionId + '/edit')}>\n            <span class=\"material-icons pr-2\">edit_document</span>\n            Edit\n          </button>\n\n          <BasicModal\n            bind:open={deleteModalOpen}\n            title=\"Delete version?\"\n            body=\"Are you sure you wish to delete this version?\"\n            buttonTextCancel=\"Cancel\"\n            buttonTextConfirm=\"Delete\"\n            confirm={deleteVersionFn} />\n          <button class=\"btn border border-primary-500 preset-tonal-primary\" onclick={() => (deleteModalOpen = true)}>\n            <span class=\"material-icons pr-2\">delete</span>\n            Delete</button>\n        {/if}\n        {#if $version.data.getVersion.targets.length != 0}\n          <Popover>\n            <Popover.Trigger\n              class=\"btn border border-primary-500 preset-tonal-primary\"\n              title=\"Download a specific release target of this mod\">\n              {$t('download')}\n              <span class=\"material-icons\" style=\"margin: 0;\">arrow_drop_down</span>\n            </Popover.Trigger>\n            <Portal>\n              <Popover.Positioner>\n                <Popover.Content class=\"z-10 w-72 card preset-filled-surface-100-900 shadow-xl\">\n                  <nav class=\"list-nav\">\n                    <ul>\n                      {#each $version.data.getVersion.targets as target (target.targetName)}\n                        <li>\n                          <a\n                            class=\"w-full\"\n                            href={API_REST +\n                              '/mod/' +\n                              modId +\n                              '/versions/' +\n                              versionId +\n                              '/' +\n                              target.targetName +\n                              '/download'}>\n                            <span>Download {prettyTarget(target.targetName)}</span>\n                          </a>\n                        </li>\n                      {/each}\n                    </ul>\n                  </nav>\n                </Popover.Content>\n              </Popover.Positioner>\n            </Portal>\n          </Popover>\n        {:else}\n          <a\n            class=\"btn border border-primary-500 preset-tonal-primary\"\n            href={base + '/mod/' + modId + '/version/' + versionId}>View</a>\n          <a\n            class=\"btn border border-primary-500 preset-tonal-primary\"\n            href={API_REST + '/mod/' + modId + '/versions/' + versionId + '/download'}>Download</a>\n        {/if}\n        <button\n          class=\"btn border border-primary-500 preset-tonal-primary\"\n          title=\"Install via Satisfactory Mod Manager\"\n          onclick={() => installMod($version.data.getVersion.mod.mod_reference)}>\n          <span class=\"material-icons\">download</span>\n          <span>Install</span>\n        </button>\n        <a\n          class=\"btn border border-primary-500 preset-tonal-primary\"\n          href={base + '/mod/' + modId}\n          title=\"View the description page for this mod\">\n          <span class=\"material-icons\">extension</span>\n          <span>{$t('version.back')}</span>\n        </a>\n      </div>\n    </div>\n    <div class=\"grid-auto-max grid auto-cols-fr gap-4\">\n      <VersionDescription changelog={$version.data.getVersion.changelog} approved={$version.data.getVersion.approved} />\n      <div class=\"grid auto-rows-min grid-cols-1 gap-8\">\n        <VersionInfo version={$version.data.getVersion} />\n        <VersionTargetSupportGrid targets={$version.data.getVersion.targets} />\n        <VersionDependenciesGrid dependencies={$version.data.getVersion.dependencies} />\n        {#if $version.data.getVersion.virustotal_results.length != 0}\n          <VirustotalResults results={$version.data.getVersion.virustotal_results} />\n        {/if}\n      </div>\n    </div>\n  </div>\n{:else}\n  <Page404 />\n{/if}\n"],"names":["load","params","parent","loadWaitForNoFetch","queryStore","GetModVersionDocument","AnnouncementImportance","$.await","node_2","markdown","changelogRendered","t","getTranslate","$t","prettyDate","prettyNumber","prettyBytes","result","$.each","node","$$props","$.set_text","text_4","$.get","$.set_attribute","a","text_5","modId","versionId","version","client","getContextClient","canUserEdit","$.tag","$.derived","$user","$version","author","$.equals","deleteVersionFn","DeleteVersionDocument","value","$.log_if_contains_state","toaster","goto","base","deleteModalOpen","$$render","consequent","$$value","button_1","$.set","consequent_3","$.template_effect","$0","text_2","target","ul","API_REST","prettyTarget","a_1","consequent_4","alternate","installMod","consequent_5","text_1","consequent_6","alternate_1","consequent_2","alternate_2","consequent_1","alternate_3"],"mappings":"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"}
import{aw as le,I as ke,a as $e,p as Se,X as Ve,Y as Fe,w as H,A as Pe,J as Ce,f as Me,g as L,K as Ee,h as T,m as v,z as re,k as f,a0 as K,q as y,r as Te,t as ze,N as Ue,D as se,n as z,C as U,L as r,u as qe,a4 as Be,S as s,a1 as q,aj as Ie,F as I,y as J,G as B,ae as ne,af as ie,ad as Qe,ac as ce}from"../chunks/Zigv8uwj.js";import{V as je}from"../chunks/BUxr_pyg.js";import{y as Ge,F as Ne,z as Ae,B as Oe,t as De}from"../chunks/C2xQDKU4.js";import{M as He}from"../chunks/DkMqSqQ8.js";import{E as Ke}from"../chunks/iDs_Bf8q.js";import{t as de}from"../chunks/B-qlgqy4.js";import{B as Le}from"../chunks/Bps8zskF.js";import{Q as Je}from"../chunks/BN6MyBkq.js";const Re=async({params:w})=>({...w}),ct=Object.freeze(Object.defineProperty({__proto__:null,load:Re},Symbol.toStringTag,{value:"Module"})),Xe=async(w,_,o,C,b)=>{const d=Math.ceil(w.size/1e7),x=new Array(d).fill(0).map((t,n)=>n).reverse(),M=(t,n,u)=>b.mutation(Oe,{modId:_,versionId:u,part:n,file:t}).toPromise(),V=10;let g=0,h=0;const l=t=>{if(g>=V||!x.length)return;const n=x.pop(),u=n*1e7,k=w.slice(u,u+1e7);return g+=1,Promise.all([M(k,n+1,t).then(()=>(g-=1,C.set({total:d,uploaded:d-x.length-g}),l(t))).catch(p=>{if(console.error("Upload failed:",p),g-=1,x.push(n),h+=1,h<5)return l(t);throw new Error("Failed uploading after 5 attempts")}),l(t)])};return b.mutation(Ge,{modId:_}).toPromise().then(async t=>(C.set({total:d,uploaded:0}),await l(t.data.createVersion),t.data.createVersion)).then(t=>(console.log("Finalizing",{versionID:t}),b.mutation(Ne,{modId:_,versionId:t,version:o}).toPromise().then(()=>new Promise((n,u)=>{let k=0,p=le({query:Ae,client:b,variables:{modId:_,versionId:t},requestPolicy:"network-only"});const F=setInterval(()=>{if(k==60)return clearInterval(F),u(new Error("Timed out waiting for mod processing"));p.pause(),p.resume(),k++},1e4),P=p.subscribe(m=>{if(!m.fetching){if(m.error){clearInterval(F),u(new Error(m.error.message)),setTimeout(P);return}m.data?.checkVersionUploadState?.version?.id&&(P(),clearInterval(F),n(m.data.checkVersionUploadState))}})})))).catch(t=>{throw console.error(t),t})};a[I]="src/routes/mod/[modId]/new-version/+page.svelte";var Ye=L(J('<div class="relative pt-4"><div class="mb-2 flex items-center justify-between"><div><span class="inline-block rounded-full bg-yellow-600 px-2 py-1 text-xs font-semibold text-white uppercase"> </span></div> <div class="text-right"><span class="inline-block text-xs font-semibold text-white"> </span></div></div> <div class="mb-4 flex h-2 overflow-hidden rounded bg-neutral-600 text-xs"><div class="flex flex-col justify-center bg-yellow-600 text-center whitespace-nowrap text-white shadow-none"></div></div></div>'),a[I],[[130,8,[[131,10,[[132,12,[[133,14]]],[138,12,[[139,14]]]]],[142,10,[[143,12]]]]]]),We=L(J('<!> <!> <div class="p-4"><span>Edit Compatibility Info</span></div> <div class="card preset-filled-surface-100-900 p-4"><!></div>',1),a[I],[[151,6,[[152,8]]],[154,6]]),Ze=L(J('<div class="flex h-auto flex-wrap items-center justify-between"><h1 class="my-4 text-4xl font-bold">New Version for <!></h1> <div><!> <button class="btn border border-primary-500 preset-tonal-primary" title="View the description page for this mod"><span class="material-icons pr-2">arrow_back</span> </button></div></div> <div class="card preset-filled-surface-100-900 p-4"><section><!></section></div>',1),a[I],[[97,0,[[98,2],[106,2,[[114,4,[[118,6]]]]]]],[124,0,[[125,2]]]]);function a(w,_){$e(new.target),Se(_,!0,a);const o=()=>(B(n,"mod"),U(n,"$mod",d)),C=()=>(B(M,"t"),U(M,"$t",d)),b=()=>(B(h,"uploadStatus"),U(h,"$uploadStatus",d)),Q=()=>(B(l,"uploadPercent"),U(l,"$uploadPercent",d)),[d,x]=ze(),{t:M}=Ve(),{modId:V}=_.data,g=Fe(),h=H(""),l=H(0),t=H();t.subscribe(e=>{e&&(Pe(e.uploaded,e.total)?(h.set("Processing..."),l.set(100)):(h.set(`Uploading: ${e.uploaded}/${e.total}`),l.set(e.uploaded/e.total*100)))});const n=le({query:De,client:g,variables:{mod:V}}),u=async e=>Xe(e.file,o().data.mod.id,{changelog:e.changelog,stability:e.stability},t,g).then(i=>{de.success({description:"Version created",duration:5e3}),ne(ie+"/mod/"+V+"/version/"+i.version.id)}).catch(i=>{console.error(...Qe("error",i)),de.error({description:"Error creating version: "+i.message}),h.set("")}),k=()=>{ne(ie+"/mod/"+V)};let p=Ce(Ue(!1),"backModalOpen");var F={...Me()},P=Ze();Ee("12gnhmd",e=>{var i=se(),$=T(i);{var S=c=>{v(()=>He(c,{get description(){return`Creating a new version of mod ${o().data.mod.name??""}`},get title(){return`New version of mod ${o().data.mod.name??""}`}}),"component",a,91,4,{componentTag:"MetaDescriptors"})};v(()=>z($,c=>{!o().fetching&&!o().error&&o().data.mod&&c(S)}),"if",a,90,2)}y(e,i)});var m=T(P),j=r(m),ue=f(r(j));{var pe=e=>{var i=ce("...");y(e,i)},me=e=>{var i=se(),$=T(i);{var S=c=>{var E=ce();K(()=>q(E,o().data.mod.name)),y(c,E)};v(()=>z($,c=>{o().error||c(S)},!0),"if",a,102,4)}y(e,i)};v(()=>z(ue,e=>{o().fetching?e(pe):e(me,!1)}),"if",a,100,4)}s(j);var R=f(j,2),X=r(R);v(()=>Le(X,{title:"Go Back?",body:"Going back will discard any unsaved changes. Are you sure you wish to continue?",buttonTextCancel:"Keep Editing",buttonTextConfirm:"Go Back",confirm:k,get open(){return qe(p)},set open(e){re(p,e,!0)}}),"component",a,107,4,{componentTag:"BasicModal"});var G=f(X,2);G.__click=()=>re(p,!0);var ve=f(r(G));s(G),s(R),s(m);var Y=f(m,2),W=r(Y),fe=r(W);v(()=>Je(fe,{get query(){return n},children:Be(a,(e,i)=>{var $=We(),S=T($);v(()=>je(S,{onSubmit:u,get modReference(){return o().data.mod.mod_reference},submitIcon:"add_circle"}),"component",a,127,6,{componentTag:"VersionForm"});var c=f(S,2);{var E=N=>{var A=Ye(),O=r(A),D=r(O),ee=r(D),_e=r(ee,!0);s(ee),s(D);var te=f(D,2),ae=r(te),be=r(ae);s(ae),s(te),s(O);var oe=f(O,2),ye=r(oe);s(oe),s(A),K((we,xe)=>{q(_e,b()),q(be,`${we??""}%`),Ie(ye,`width: ${xe??""}%`)},[()=>Q().toFixed(0),()=>Q().toFixed(0)]),y(N,A)};v(()=>z(c,N=>{b()&&N(E)}),"if",a,129,6)}var Z=f(c,4),he=r(Z);v(()=>Ke(he,{get mod(){return o().data.mod},get modId(){return o().data.mod.id},$$events:{fail:()=>{alert("Failed to update compatibility information, check browser console for more info.")},submit:()=>{alert("Mod compatibility data updated. Don't forget to upload the version too!")}}}),"component",a,155,8,{componentTag:"EditCompatibilityForm"}),s(Z),y(e,$)}),$$slots:{default:!0}}),"component",a,126,4,{componentTag:"QueryStateHandler"}),s(W),s(Y),K(e=>q(ve,` ${e??""}`),[()=>C()("version.back")]),y(w,P);var ge=Te(F);return x(),ge}ke(["click"]);export{a as component,ct as universal};
//# sourceMappingURL=18.CJB_3pom.js.map

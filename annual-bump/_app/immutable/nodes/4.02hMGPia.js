import{I as ke,a as we,p as Ce,X as Pe,J as qe,N as Ne,aq as B,ar as Me,as as Qe,at as Ee,f as Ge,g as f,k as _,h as d,m,q as o,r as Le,t as Se,n as H,L as F,C as je,F as u,y as h,G as ze,z as K,D as E,R as k,_ as V,a0 as Y,au as w,a5 as C,a9 as Je,u as t,T as Oe,a6 as G,ab as Re,ac as Ue,ag as ee,Z as L,j as We,M as te,av as P,a2 as S,ad as Xe}from"../chunks/CVeMU510.js";import{G as Ze,C as Be,b as He,A as Ke,D as Ve}from"../chunks/Bj1PSOzY.js";import{t as y}from"../chunks/Dd496ME7.js";a[u]="src/routes/admin/announcements/+page.svelte";var Ye=f(h('<h1 class="svelte-1ree51b">Loading announcements...</h1>'),a[u],[[147,4]]),et=f(h('<h1 class="svelte-1ree51b"> </h1>'),a[u],[[149,4]]),tt=f(h('<div><div>Message</div> <input type="text" class="input p-2" placeholder="This is the text of the announcement"/> <div>Importance (Fix, Info, Warning, Alert)</div> <input type="text" class="input p-2" placeholder="Importance level"/></div> <button class="btn border border-error-500 preset-tonal-error"><span>Delete</span></button>',1),a[u],[[162,12,[[163,14],[164,14],[171,14],[172,14]]],[180,12,[[183,14]]]]),at=f(h("<!> <!>",1),a[u],[]),st=f(h('<!> <section class="p-4"><button class="btn border border-primary-500 preset-tonal-primary"><span>Add new announcement</span> <span class="material-icons">add</span></button></section>',1),a[u],[[190,4,[[191,6,[[192,8],[193,8]]]]]]),rt=f(h('<h1 class="svelte-1ree51b">Announcements</h1> <div class="card preset-filled-surface-100-900"><!></div>',1),a[u],[[143,0],[145,0]]);function a(ae,se){we(new.target),Ce(se,!0,a);const x=()=>(ze(j,"annQuery"),je(j,"$annQuery",re)),[re,ne]=Se(),I=Pe();let n=qe(Ne(B([])),"announcements");const $=Me(B({}),"nameFields");let oe=-1;const T="New Announcement",j=Qe({query:Ze,client:I});Ee(()=>{K(n,x().data?.getAnnouncements||[],!0)});function ie(){if(t(n).find(e=>P(e.message,T)))$[t(n)[t(n).length-1].id].focus();else{const e={id:oe--,message:T,importance:Ke.Info};t(n).push(e),K(n,t(n),!0),setTimeout(()=>{const s=$[e.id];s.focus(),s.getElement().querySelectorAll("input")[0].select()},0)}}async function z(e){if(P(e.message,T))return;let s=!1;if(e.id<0){try{const c=(await S(I.mutation(Be,{announcement:{importance:e.importance,message:e.message}}).toPromise()))();c.data&&(e.id=c.data.createAnnouncement.id,s=!0)}catch(c){console.log(...Xe("log",c))}if(!s){y.error({description:`Failed to create Announcement '${e.message}'!`,duration:2e3});return}}else{try{e.message.length>0&&(s=P((await S(I.mutation(He,{id:e.id,announcement:{importance:e.importance,message:e.message}}).toPromise()))().data.updateAnnouncement,null,!1))}catch{}if(!s){y.error({description:`Failed to update Announcement '${e.message}'!`,duration:2e3});return}}y.success({description:`Announcement '${e.message}' saved!`,duration:2e3})}async function ce(e){if(P(e.message,T,!1)){let s=!1;try{s=(await S(I.mutation(Ve,{id:e.id}).toPromise()))().data.deleteAnnouncement}catch{s=!1}if(!s){y.error({description:`Failed to remove Announcement '${e.message}'!`,duration:2e3});return}}else t(n).splice(t(n).indexOf(e),1);y.success({description:`Tag '${e.message}' removed!`,duration:2e3})}function le(e,s){e.stopPropagation(),ce(s)}var de={...Ge()},J=rt(),O=_(d(J),2),me=F(O);{var ue=e=>{var s=Ye();o(e,s)},pe=e=>{var s=E(),c=d(s);{var ve=p=>{var g=et(),D=F(g);k(g),V(()=>Y(D,`Failed to load announcements: ${x().error.message??""}`)),o(p,g)},_e=p=>{var g=st(),D=d(g);m(()=>w(D,{children:C(a,(he,nt)=>{var U=E(),$e=d(U);Je(()=>t(n),A=>A.id),m(()=>Oe($e,17,()=>t(n),A=>A.id,(A,r,ot)=>{var W=E(),Ae=d(W);m(()=>G(Ae,()=>w.Item,(be,ye)=>{ye(be,{get value(){return t(r).id},children:C(a,(xe,it)=>{var X=at(),Z=d(X);m(()=>G(Z,()=>w.ItemTrigger,(q,N)=>{N(q,{children:C(a,(M,Te)=>{Re();var b=Ue();V(v=>Y(b,`(${t(r).importance??""}) ${v??""}`),[()=>(()=>{const l=t(r).message.substring(0,144);return t(r).message.length>144?l+"...":l})()]),o(M,b)}),$$slots:{default:!0}})}),"component",a,154,10,{componentTag:"Accordion.ItemTrigger"});var Ie=_(Z,2);m(()=>G(Ie,()=>w.ItemContent,(q,N)=>{N(q,{children:C(a,(M,Te)=>{var b=tt(),v=d(b),l=_(F(v),2);ee(l),l.__change=()=>z(t(r)),L("bind:value={announcement.message}",()=>t(r),()=>"message",167,16),L("bind:this={nameFields[announcement.id]}",()=>$,()=>t(r).id,169,16),We(l,(i,Fe)=>$[Fe.id]=i,i=>$?.[i.id],()=>[t(r)]);var Q=_(l,4);ee(Q),Q.__change=()=>z(t(r)),L("bind:value={announcement.importance}",()=>t(r),()=>"importance",175,16),k(v);var De=_(v,2);De.__click=i=>le(i,t(r)),te(l,()=>t(r).message,i=>t(r).message=i),te(Q,()=>t(r).importance,i=>t(r).importance=i),o(M,b)}),$$slots:{default:!0}})}),"component",a,161,10,{componentTag:"Accordion.ItemContent"}),o(xe,X)}),$$slots:{default:!0}})}),"component",a,153,8,{componentTag:"Accordion.Item"}),o(A,W)}),"each",a,152,6),o(he,U)}),$$slots:{default:!0}}),"component",a,151,4,{componentTag:"Accordion"});var R=_(D,2),fe=F(R);fe.__click=ie,k(R),o(p,g)};m(()=>H(c,p=>{x().error?p(ve):p(_e,!1)},!0),"if",a,148,2)}o(e,s)};m(()=>H(me,e=>{x().fetching?e(ue):e(pe,!1)}),"if",a,146,2)}k(O),o(ae,J);var ge=Le(de);return ne(),ge}ke(["change","click"]);export{a as component};
//# sourceMappingURL=4.02hMGPia.js.map

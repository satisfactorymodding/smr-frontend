{"version":3,"file":"17.DfzKgOZC.js","sources":["../../../../../../src/routes/mod/[modId]/edit/+page.ts","../../../../../../src/routes/mod/[modId]/edit/+page.svelte"],"sourcesContent":["import { GetModDocument } from '$lib/generated';\nimport { loadWaitForNoFetch } from '$lib/utils/gql';\nimport { queryStore } from '@urql/svelte';\nimport type { PageLoad } from './$types';\n\nexport const load: PageLoad = async ({ params, parent }) => ({\n  ...params,\n  ...(await loadWaitForNoFetch({\n    mod: queryStore({\n      query: GetModDocument,\n      client: (await parent()).client,\n      variables: { mod: params.modId },\n      requestPolicy: 'network-only'\n    })\n  }))\n});\n","<script lang=\"ts\">\n  import { getContextClient } from '@urql/svelte';\n  import { EditModDocument } from '$lib/generated';\n  import { goto } from '$app/navigation';\n  import ModForm from '$lib/components/mods/ModForm.svelte';\n  import type { ModData } from '$lib/models/mods';\n  import { base } from '$app/paths';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n  import type { PageData } from './$types';\n  import { get } from 'svelte/store';\n  import { toaster } from '$lib/utils/toaster-svelte';\n\n  interface Props {\n    data: PageData;\n  }\n\n  let { data }: Props = $props();\n\n  const client = getContextClient();\n\n  let { modId, mod } = $derived(data);\n\n  const onSubmit = (modData: ModData) => {\n    client\n      .mutation(EditModDocument, {\n        modId: get(mod).data.mod.id,\n        mod: modData\n      })\n      .toPromise()\n      .then((value) => {\n        if (value.error) {\n          console.error(value.error.message);\n          toaster.error({\n            description: 'Error editing mod: ' + value.error.message\n          });\n        } else {\n          toaster.success({\n            description: `Mod updated`,\n            duration: 5000\n          });\n          goto(base + '/mod/' + modId);\n        }\n      });\n  };\n\n  let initialValues = $derived(\n    $mod.data\n      ? {\n          ...$mod.data.mod,\n          logo: undefined\n        }\n      : undefined\n  );\n</script>\n\n<svelte:head>\n  {#if !$mod.fetching && !$mod.error && $mod.data.mod}\n    <MetaDescriptors\n      description=\"Editing mod {$mod.data.mod.name}\"\n      title=\"Edit mod {$mod.data.mod.name}\"\n      image={$mod.data.mod.logo} />\n  {/if}\n</svelte:head>\n\n<h1 class=\"my-4 text-4xl font-bold\">Edit Mod</h1>\n\n<div class=\"card preset-filled-surface-100-900 p-4\">\n  <section>\n    {#if $mod.fetching}\n      <p>Loading...</p>\n    {:else if $mod.error}\n      <p>Oh no... {$mod.error.message}</p>\n    {:else}\n      <ModForm {onSubmit} {initialValues} editing={true} submitText=\"Save\" />\n    {/if}\n  </section>\n</div>\n"],"names":["load","params","parent","loadWaitForNoFetch","queryStore","GetModDocument","client","getContextClient","modId","mod","onSubmit","modData","EditModDocument","get","$.get","value","$.log_if_contains_state","toaster","goto","base","initialValues","$.tag","$.derived","$mod","$$render","consequent","consequent_2","alternate","consequent_1","alternate_1"],"mappings":"mdAKO,MAAMA,GAAiB,MAAO,CAAE,OAAAC,EAAQ,OAAAC,MAAc,CAC3D,GAAGD,EACH,GAAI,MAAME,EAAmB,CAC3B,IAAKC,EAAW,CACd,MAAOC,EACP,QAAS,MAAMH,EAAA,GAAU,OACzB,UAAW,CAAE,IAAKD,EAAO,KAAA,EACzB,cAAe,cAAA,CAChB,CAAA,CACF,CACH,uaCfA,iFAkBQK,EAASC,EAAgB,EAEzB,IAAAC,iBAAA,KAAK,EAAA,OAAA,EAAEC,iBAAA,GAAG,EAAA,KAAA,QAEVC,EAAYC,GAAqB,CACrCL,EACG,SAASM,EAAe,CACvB,MAAOC,GAAGC,EAACL,CAAG,CAAA,EAAE,KAAK,IAAI,GACzB,IAAKE,CAAA,CAAA,EAEN,YACA,KAAMI,GAAU,CACXA,EAAM,OACR,QAAQ,MAAK,GAAAC,GAAA,QAACD,EAAM,MAAM,OAAO,CAAA,EACjCE,EAAQ,MAAK,CACX,YAAa,sBAAwBF,EAAM,MAAM,QAAA,IAGnDE,EAAQ,QAAO,CACb,YAAW,cACX,SAAU,IAAA,EAEZC,GAAKC,GAAO,UAAUX,CAAK,CAAA,EAE/B,CAAC,CACL,EAEI,IAAAY,EAAaC,EAAAC,EAAA,IACfC,EAAI,EAAC,KAAA,CAAA,GAEIA,EAAI,EAAC,KAAK,IACb,KAAM,MAAA,EAER,MAAA,EAAA,eAAA,wFAOwB,MAAA,eAAAA,EAAI,EAAC,KAAK,IAAI,MAAI,EAAA,gBAC3B,MAAA,YAAAA,EAAI,EAAC,KAAK,IAAI,MAAI,EAAA,gBAC5B,OAAAA,EAAI,EAAC,KAAK,IAAI,6EAJnBA,EAAI,EAAC,UAAQ,CAAKA,EAAI,EAAC,OAASA,EAAI,EAAC,KAAK,KAAGC,EAAAC,CAAA,uKAelCF,EAAI,EAAC,MAAM,SAAO,EAAA,EAAA,CAAA,gFAEc,mFAHrCA,EAAI,EAAC,MAAKC,EAAAE,CAAA,EAAAF,EAAAG,EAAA,EAAA,0CAFfJ,EAAI,EAAC,SAAQC,EAAAI,CAAA,EAAAJ,EAAAK,EAAA,EAAA,yDAftB"}
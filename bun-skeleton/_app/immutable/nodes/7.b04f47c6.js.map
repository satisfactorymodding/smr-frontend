{"version":3,"file":"7.b04f47c6.js","sources":["../../../../../../src/routes/admin/tag-manager/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { getContextClient, queryStore } from '@urql/svelte';\n  import { CreateTagDocument, DeleteTagDocument, GetTagsDocument, UpdateTagDocument } from '$lib/generated';\n  import type { Tag } from '$lib/generated';\n  import { Accordion, AccordionItem, getToastStore } from '@skeletonlabs/skeleton';\n\n  const client = getContextClient();\n\n  let tags: Tag[] = [];\n  const panels = {};\n  const nameFields = {};\n  let tagNegativeID = -1;\n\n  const tagsQuery = queryStore({\n    query: GetTagsDocument,\n    client,\n    variables: {}\n  });\n\n  $: tags = $tagsQuery.data?.getTags || [];\n\n  const toastStore = getToastStore();\n\n  function newTag() {\n    if (!tags.find((tag) => tag.name == 'New Tag')) {\n      const tag = { id: tagNegativeID--, name: 'New Tag' } as Tag;\n      tags.push(tag);\n      tags = tags;\n      setTimeout(() => {\n        panels[tag.id].setOpen(true);\n        const field = nameFields[tag.id];\n        field.focus();\n        const input = field.getElement().querySelectorAll('input')[0] as HTMLInputElement;\n        input.select();\n      }, 0);\n    } else {\n      panels[tags[tags.length - 1].id].setOpen(true);\n      nameFields[tags[tags.length - 1].id].focus();\n    }\n  }\n\n  async function tagChange(tag: Tag) {\n    // ignore \"New Tag\"\n    if (tag.name == 'New Tag') {\n      return;\n    }\n\n    let success = false;\n    if (tag.id < 0) {\n      // Create new tag & update tag.id with new DB id or re-fetch all tags\n      try {\n        const result = await client.mutation(CreateTagDocument, { tagName: tag.name }).toPromise();\n        if (result.data) {\n          tag.id = result.data.createTag.id;\n          success = true;\n        }\n      } catch (err) {\n        console.log(err);\n      }\n      if (!success) {\n        toastStore.trigger({\n          message: `Failed to create Tag '${tag.name}'!`,\n          background: 'variant-filled-error',\n          timeout: 2000\n        });\n        return;\n      }\n    } else {\n      // Update existing tag\n      try {\n        success =\n          (await client.mutation(UpdateTagDocument, { tagID: tag.id, tagName: tag.name }).toPromise()).data.updateTag !=\n          null;\n      } catch {\n        // nothing\n      }\n      if (!success) {\n        toastStore.trigger({\n          message: `Failed to update Tag '${tag.name}'!`,\n          background: 'variant-filled-error',\n          timeout: 2000\n        });\n        return;\n      }\n    }\n\n    toastStore.trigger({\n      message: `Tag '${tag.name}' saved!`,\n      background: 'variant-filled-success',\n      timeout: 2000\n    });\n  }\n\n  async function deleteTag(tag: Tag) {\n    if (tag.name != 'New Tag') {\n      // Remove tag\n      let success = false;\n      try {\n        const result = await client.mutation(DeleteTagDocument, { tagID: tag.id }).toPromise();\n        success = result.data.deleteTag;\n      } catch {\n        success = false;\n      }\n      if (!success) {\n        toastStore.trigger({\n          message: `Failed to remove Tag '${tag.name}'!`,\n          background: 'variant-filled-error',\n          timeout: 2000\n        });\n        return;\n      }\n    }\n\n    toastStore.trigger({\n      message: `Tag '${tag.name}' removed!`,\n      background: 'variant-filled-success',\n      timeout: 2000\n    });\n  }\n\n  function onDeleteClick(e: Event, tag: Tag) {\n    e.stopPropagation();\n    deleteTag(tag);\n  }\n</script>\n\n<div class=\"card\">\n  {#if $tagsQuery.fetching}\n    <h1>Loading tags...</h1>\n  {:else if $tagsQuery.error}\n    <h1>Failed to load tags: {$tagsQuery.error.message}</h1>\n  {:else}\n    <Accordion>\n      {#each tags as tag}\n        <AccordionItem>\n          <svelte:fragment slot=\"summary\">{tag.name}</svelte:fragment>\n          <svelte:fragment slot=\"content\">\n            <input\n              type=\"text\"\n              class=\"input p-2\"\n              bind:value={tag.name}\n              placeholder=\"Tag-Name\"\n              bind:this={nameFields[tag.id]}\n              on:change={() => tagChange(tag)} />\n            <span slot=\"helper\">Human-Readable name of the tag that is shown in UI</span>\n\n            <button class=\"btn variant-ghost-error\" on:click={(e) => onDeleteClick(e, tag)}>\n              <span>Delete</span>\n            </button>\n          </svelte:fragment>\n        </AccordionItem>\n      {/each}\n    </Accordion>\n\n    <section class=\"p-4\">\n      <button class=\"btn variant-ghost-primary\" on:click={newTag}>\n        <span>Add new tag</span>\n        <span class=\"material-icons\">add</span>\n      </button>\n    </section>\n  {/if}\n</div>\n"],"names":["insert_hydration_dev","target","section","anchor","append_hydration_dev","button","span0","span1","ctx","error","message","h1","set_data_dev","t1","t1_value","t_value","name","dirty","t","input","set_input_value","value","length","i","each_blocks","fetching","div","client","getContextClient","tags","panels","nameFields","tagNegativeID","tagsQuery","queryStore","query","GetTagsDocument","variables","toastStore","getToastStore","newTag","find","tag","id","setOpen","focus","push","setTimeout","field","getElement","querySelectorAll","select","async","tagChange","success","result","mutation","CreateTagDocument","tagName","toPromise","data","createTag","err","console","log","trigger","background","timeout","UpdateTagDocument","tagID","updateTag","deleteTag","DeleteTagDocument","onDeleteClick","e","stopPropagation","this","$$value","change_handler","click_handler","$tagsQuery","getTags"],"mappings":"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"}
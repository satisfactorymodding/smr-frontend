import{S as Ie,i as Ne,d as T,s as De,v as we,_ as te,af as ne,Z as Pe,a8 as Te,a4 as se,ag as me,ah as ge,a7 as Be,e as A,b as B,g as C,J as q,k as E,h as U,j as v,K as N,m as b,n as k,t as V,q as de,r as F,y as Ee,T as oe,p as pe,G as he,I as ve,L as $e,M as I,O,Q as xe,a0 as j,a1 as Q,a3 as Z,u as H,f as ae,W as Re,N as W,R as qe}from"../chunks/vendor.ByKZ30D2.js";import{G as ce,C as ie,A as le,b as re,D as ue}from"../chunks/graphql.JkthYSgF.js";const{console:Fe}=Be,S="src/routes/admin/announcements/+page.svelte";function fe(s,e,l){const o=s.slice();return o[18]=e[l],o[19]=e,o[20]=l,o}function ye(s){let e,l,o,t,n,u="Add new announcement",a,i,f="add",r,m,$;e=new me({props:{$$slots:{default:[Se]},$$scope:{ctx:s}},$$inline:!0});const g={c:function(){he(e.$$.fragment),l=B(),o=A("section"),t=A("button"),n=A("span"),n.textContent=u,a=B(),i=A("span"),i.textContent=f,this.h()},l:function(p){ve(e.$$.fragment,p),l=E(p),o=C(p,"SECTION",{class:!0});var x=U(o);t=C(x,"BUTTON",{class:!0});var D=U(t);n=C(D,"SPAN",{"data-svelte-h":!0}),q(n)!=="svelte-dgqv0e"&&(n.textContent=u),a=E(D),i=C(D,"SPAN",{class:!0,"data-svelte-h":!0}),q(i)!=="svelte-99y27o"&&(i.textContent=f),D.forEach(v),x.forEach(v),this.h()},h:function(){b(n,S,190,8,6191),N(i,"class","material-icons"),b(i,S,191,8,6233),N(t,"class","variant-ghost-primary btn"),b(t,S,189,6,6113),N(o,"class","p-4"),b(o,S,188,4,6085)},m:function(p,x){$e(e,p,x),k(p,l,x),k(p,o,x),I(o,t),I(t,n),I(t,a),I(t,i),r=!0,m||($=O(t,"click",s[4],!1,!1,!1,!1),m=!0)},p:function(p,x){const D={};x&2097158&&(D.$$scope={dirty:x,ctx:p}),e.$set(D)},i:function(p){r||(F(e.$$.fragment,p),r=!0)},o:function(p){V(e.$$.fragment,p),r=!1},d:function(p){p&&(v(l),v(o)),xe(e,p),m=!1,$()}};return T("SvelteRegisterBlock",{block:g,id:ye.name,type:"else",source:"(137:2) {:else}",ctx:s}),g}function ke(s){let e,l,o=s[0].error.message+"",t;const n={c:function(){e=A("h1"),l=j("Failed to load announcements: "),t=j(o),this.h()},l:function(a){e=C(a,"H1",{class:!0});var i=U(e);l=Q(i,"Failed to load announcements: "),t=Q(i,o),i.forEach(v),this.h()},h:function(){N(e,"class","svelte-1egakhm"),b(e,S,150,4,4598)},m:function(a,i){k(a,e,i),I(e,l),I(e,t)},p:function(a,i){i&1&&o!==(o=a[0].error.message+"")&&Z(t,o)},i:H,o:H,d:function(a){a&&v(e)}};return T("SvelteRegisterBlock",{block:n,id:ke.name,type:"if",source:"(135:28) ",ctx:s}),n}function Ae(s){let e,l="Loading announcements...";const o={c:function(){e=A("h1"),e.textContent=l,this.h()},l:function(n){e=C(n,"H1",{class:!0,"data-svelte-h":!0}),q(e)!=="svelte-emqmfi"&&(e.textContent=l),this.h()},h:function(){N(e,"class","svelte-1egakhm"),b(e,S,148,4,4531)},m:function(n,u){k(n,e,u)},p:H,i:H,o:H,d:function(n){n&&v(e)}};return T("SvelteRegisterBlock",{block:o,id:Ae.name,type:"if",source:"(133:2) {#if $annQuery.fetching}",ctx:s}),o}function Ce(s){let e,l=s[18].importance+"",o,t,n=a()+"",u;function a(){return s[13](s[18])}const i={c:function(){e=j("("),o=j(l),t=j(") "),u=j(n)},l:function(r){e=Q(r,"("),o=Q(r,l),t=Q(r,") "),u=Q(r,n)},m:function(r,m){k(r,e,m),k(r,o,m),k(r,t,m),k(r,u,m)},p:function(r,m){s=r,m&2&&l!==(l=s[18].importance+"")&&Z(o,l),m&2&&n!==(n=a()+"")&&Z(u,n)},d:function(r){r&&(v(e),v(o),v(t),v(u))}};return T("SvelteRegisterBlock",{block:i,id:Ce.name,type:"slot",source:'(141:10) <svelte:fragment slot=\\"summary\\"             >',ctx:s}),i}function be(s){let e,l,o="Message",t,n,u=s[18],a,i,f="Importance (Fix, Info, Warning, Alert)",r,m,$,g,d,p="Delete",x,D,M;function z(){s[7].call(n,s[19],s[20])}const G=()=>s[8](n,u),L=()=>s[8](null,u);function J(){return s[9](s[18])}function K(){s[10].call(m,s[19],s[20])}function c(){return s[11](s[18])}function h(...R){return s[12](s[18],...R)}const P={c:function(){e=A("div"),l=A("div"),l.textContent=o,t=B(),n=A("input"),a=B(),i=A("div"),i.textContent=f,r=B(),m=A("input"),$=B(),g=A("button"),d=A("span"),d.textContent=p,x=B(),this.h()},l:function(w){e=C(w,"DIV",{});var y=U(e);l=C(y,"DIV",{"data-svelte-h":!0}),q(l)!=="svelte-xcpyc9"&&(l.textContent=o),t=E(y),n=C(y,"INPUT",{type:!0,class:!0,placeholder:!0}),a=E(y),i=C(y,"DIV",{"data-svelte-h":!0}),q(i)!=="svelte-y6iqce"&&(i.textContent=f),r=E(y),m=C(y,"INPUT",{type:!0,class:!0,placeholder:!0}),y.forEach(v),$=E(w),g=C(w,"BUTTON",{class:!0});var ee=U(g);d=C(ee,"SPAN",{"data-svelte-h":!0}),q(d)!=="svelte-gz26bx"&&(d.textContent=p),ee.forEach(v),x=E(w),this.h()},h:function(){b(l,S,163,14,5155),N(n,"type","text"),N(n,"class","input p-2"),N(n,"placeholder","This is the text of the announcement"),b(n,S,164,14,5188),b(i,S,171,14,5514),N(m,"type","text"),N(m,"class","input p-2"),N(m,"placeholder","Importance level"),b(m,S,172,14,5578),b(e,S,162,12,5135),b(d,S,181,14,5953),N(g,"class","variant-ghost-error btn"),b(g,S,180,12,5849)},m:function(w,y){k(w,e,y),I(e,l),I(e,t),I(e,n),W(n,s[18].message),G(),I(e,a),I(e,i),I(e,r),I(e,m),W(m,s[18].importance),k(w,$,y),k(w,g,y),I(g,d),k(w,x,y),D||(M=[O(n,"input",z),O(n,"change",J,!1,!1,!1,!1),O(m,"input",K),O(m,"change",c,!1,!1,!1,!1),O(g,"click",h,!1,!1,!1,!1)],D=!0)},p:function(w,y){s=w,y&2&&n.value!==s[18].message&&W(n,s[18].message),u!==s[18]&&(L(),u=s[18],G()),y&2&&m.value!==s[18].importance&&W(m,s[18].importance)},d:function(w){w&&(v(e),v($),v(g),v(x)),L(),D=!1,qe(M)}};return T("SvelteRegisterBlock",{block:P,id:be.name,type:"slot",source:'(147:10) <svelte:fragment slot=\\"content\\">',ctx:s}),P}function X(s){let e,l;e=new ge({props:{$$slots:{content:[be],summary:[Ce]},$$scope:{ctx:s}},$$inline:!0});const o={c:function(){he(e.$$.fragment)},l:function(n){ve(e.$$.fragment,n)},m:function(n,u){$e(e,n,u),l=!0},p:function(n,u){const a={};u&2097158&&(a.$$scope={dirty:u,ctx:n}),e.$set(a)},i:function(n){l||(F(e.$$.fragment,n),l=!0)},o:function(n){V(e.$$.fragment,n),l=!1},d:function(n){xe(e,n)}};return T("SvelteRegisterBlock",{block:o,id:X.name,type:"each",source:"(139:6) {#each announcements as announcement}",ctx:s}),o}function Se(s){let e,l,o=oe(s[1]),t=[];for(let a=0;a<o.length;a+=1)t[a]=X(fe(s,o,a));const n=a=>V(t[a],1,1,()=>{t[a]=null}),u={c:function(){for(let i=0;i<t.length;i+=1)t[i].c();e=ae()},l:function(i){for(let f=0;f<t.length;f+=1)t[f].l(i);e=ae()},m:function(i,f){for(let r=0;r<t.length;r+=1)t[r]&&t[r].m(i,f);k(i,e,f),l=!0},p:function(i,f){if(f&102){o=oe(i[1]);let r;for(r=0;r<o.length;r+=1){const m=fe(i,o,r);t[r]?(t[r].p(m,f),F(t[r],1)):(t[r]=X(m),t[r].c(),F(t[r],1),t[r].m(e.parentNode,e))}for(pe(),r=o.length;r<t.length;r+=1)n(r);de()}},i:function(i){if(!l){for(let f=0;f<o.length;f+=1)F(t[f]);l=!0}},o:function(i){t=t.filter(Boolean);for(let f=0;f<t.length;f+=1)V(t[f]);l=!1},d:function(i){i&&v(e),Re(t,i)}};return T("SvelteRegisterBlock",{block:u,id:Se.name,type:"slot",source:"(138:4) <Accordion>",ctx:s}),u}function Y(s){let e,l="Announcements",o,t,n,u,a;const i=[Ae,ke,ye],f=[];function r($,g){return $[0].fetching?0:$[0].error?1:2}n=r(s),u=f[n]=i[n](s);const m={c:function(){e=A("h1"),e.textContent=l,o=B(),t=A("div"),u.c(),this.h()},l:function(g){e=C(g,"H1",{class:!0,"data-svelte-h":!0}),q(e)!=="svelte-1q88ok2"&&(e.textContent=l),o=E(g),t=C(g,"DIV",{class:!0});var d=U(t);u.l(d),d.forEach(v),this.h()},h:function(){N(e,"class","svelte-1egakhm"),b(e,S,144,0,4457),N(t,"class","card"),b(t,S,146,0,4481)},m:function(g,d){k(g,e,d),k(g,o,d),k(g,t,d),f[n].m(t,null),a=!0},p:function(g,[d]){let p=n;n=r(g),n===p?f[n].p(g,d):(pe(),V(f[p],1,1,()=>{f[p]=null}),de(),u=f[n],u?u.p(g,d):(u=f[n]=i[n](g),u.c()),F(u,1),u.m(t,null))},i:function(g){a||(F(u),a=!0)},o:function(g){V(u),a=!1},d:function(g){g&&(v(e),v(o),v(t)),f[n].d()}};return T("SvelteRegisterBlock",{block:m,id:Y.name,type:"component",source:"",ctx:s}),m}const _="New Announcement";function Oe(s,e,l){let o,{$$slots:t={},$$scope:n}=e;we("Page",t,[]);const u=te();let a=[];const i={};let f=-1;const r=ne({query:ce,client:u});Pe(r,"annQuery"),Te(s,r,c=>l(0,o=c));const m=se();function $(){if(a.find(c=>c.message==_))i[a[a.length-1].id].focus();else{const c={id:f--,message:_,importance:le.Info};a.push(c),l(1,a),l(0,o),setTimeout(()=>{const h=i[c.id];h.focus(),h.getElement().querySelectorAll("input")[0].select()},0)}}async function g(c){if(c.message==_)return;let h=!1;if(c.id<0){try{const P=await u.mutation(ie,{announcement:{importance:c.importance,message:c.message}}).toPromise();P.data&&(c.id=P.data.createAnnouncement.id,h=!0)}catch(P){console.log(P)}if(!h){m.trigger({message:`Failed to create Announcement '${c.message}'!`,background:"variant-filled-error",timeout:2e3});return}}else{try{c.message.length>0&&(h=(await u.mutation(re,{id:c.id,announcement:{importance:c.importance,message:c.message}}).toPromise()).data.updateAnnouncement!=null)}catch{}if(!h){m.trigger({message:`Failed to update Announcement '${c.message}'!`,background:"variant-filled-error",timeout:2e3});return}}m.trigger({message:`Announcement '${c.message}' saved!`,background:"variant-filled-success",timeout:2e3})}async function d(c){if(c.message!=_){let h=!1;try{h=(await u.mutation(ue,{id:c.id}).toPromise()).data.deleteAnnouncement}catch{h=!1}if(!h){m.trigger({message:`Failed to remove Announcement '${c.message}'!`,background:"variant-filled-error",timeout:2e3});return}}else a.splice(a.indexOf(c),1);m.trigger({message:`Tag '${c.message}' removed!`,background:"variant-filled-success",timeout:2e3})}function p(c,h){c.stopPropagation(),d(h)}const x=[];Object.keys(e).forEach(c=>{!~x.indexOf(c)&&c.slice(0,2)!=="$$"&&c!=="slot"&&Fe.warn(`<Page> was created with unknown prop '${c}'`)});function D(c,h){c[h].message=this.value,l(1,a),l(0,o)}function M(c,h){Ee[c?"unshift":"push"](()=>{i[h.id]=c,l(2,i)})}const z=c=>g(c);function G(c,h){c[h].importance=this.value,l(1,a),l(0,o)}const L=c=>g(c),J=(c,h)=>p(h,c),K=c=>{const P=c.message.substring(0,144);return c.message.length>144?P+"...":P};return s.$capture_state=()=>({getContextClient:te,queryStore:ne,GetAnnouncementsDocument:ce,CreateAnnouncementDocument:ie,AnnouncementImportance:le,UpdateAnnouncementDocument:re,DeleteAnnouncementDocument:ue,Accordion:me,AccordionItem:ge,getToastStore:se,client:u,announcements:a,nameFields:i,announcementNegativeID:f,defaultNewAnnouncementMessage:_,annQuery:r,toastStore:m,newAnnouncement:$,announcementChange:g,deleteAnnouncement:d,onDeleteClick:p,$annQuery:o}),s.$inject_state=c=>{"announcements"in c&&l(1,a=c.announcements),"announcementNegativeID"in c&&(f=c.announcementNegativeID)},e&&"$$inject"in e&&s.$inject_state(e.$$inject),s.$$.update=()=>{s.$$.dirty&1&&l(1,a=o.data?.getAnnouncements||[])},[o,a,i,r,$,g,p,D,M,z,G,L,J,K]}class Ue extends Ie{constructor(e){super(e),Ne(this,e,Oe,Y,De,{}),T("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:Y.name})}}export{Ue as component};
//# sourceMappingURL=4.BUmMEdn4.js.map

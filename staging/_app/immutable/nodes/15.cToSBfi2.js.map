{"version":3,"file":"15.cToSBfi2.js","sources":["../../../../../../src/routes/mod/[modId]/edit/+page.ts","../../../../../../src/routes/mod/[modId]/edit/+page.svelte"],"sourcesContent":["import { GetModDocument } from '$lib/generated';\nimport { loadWaitForNoFetch } from '$lib/utils/gql';\nimport { queryStore } from '@urql/svelte';\nimport type { PageLoad } from './$types';\n\nexport const load: PageLoad = async ({ params, parent }) => ({\n  ...params,\n  ...(await loadWaitForNoFetch({\n    mod: queryStore({\n      query: GetModDocument,\n      client: (await parent()).client,\n      variables: { mod: params.modId },\n      requestPolicy: 'network-only'\n    })\n  }))\n});\n","<script lang=\"ts\">\n  import { getContextClient } from '@urql/svelte';\n  import { EditModDocument } from '$lib/generated';\n  import { goto } from '$app/navigation';\n  import ModForm from '$lib/components/mods/ModForm.svelte';\n  import type { ModData } from '$lib/models/mods';\n  import { base } from '$app/paths';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n  import type { PageData } from './$types';\n  import { getToastStore } from '@skeletonlabs/skeleton';\n  import { get } from 'svelte/store';\n\n  export let data: PageData;\n\n  const client = getContextClient();\n  const toastStore = getToastStore();\n\n  $: ({ modId, mod } = data);\n\n  const onSubmit = (modData: ModData) => {\n    client\n      .mutation(EditModDocument, {\n        modId: get(mod).data.mod.id,\n        mod: modData\n      })\n      .toPromise()\n      .then((value) => {\n        if (value.error) {\n          console.error(value.error.message);\n          toastStore.trigger({\n            message: 'Error editing mod: ' + value.error.message,\n            background: 'variant-filled-error',\n            autohide: false\n          });\n        } else {\n          toastStore.trigger({\n            message: `Mod updated`,\n            background: 'variant-filled-success',\n            timeout: 5000\n          });\n          goto(base + '/mod/' + modId);\n        }\n      });\n  };\n\n  $: initialValues = $mod.data\n    ? {\n        ...$mod.data.mod,\n        logo: undefined\n      }\n    : undefined;\n</script>\n\n<svelte:head>\n  {#if !$mod.fetching && !$mod.error && $mod.data.mod}\n    <MetaDescriptors\n      description=\"Editing mod {$mod.data.mod.name}\"\n      title=\"Edit mod {$mod.data.mod.name}\"\n      image={$mod.data.mod.logo} />\n  {/if}\n</svelte:head>\n\n<h1 class=\"my-4 text-4xl font-bold\">Edit Mod</h1>\n\n<div class=\"card p-4\">\n  <section>\n    {#if $mod.fetching}\n      <p>Loading...</p>\n    {:else if $mod.error}\n      <p>Oh no... {$mod.error.message}</p>\n    {:else}\n      <ModForm {onSubmit} {initialValues} editing={true} submitText=\"Save\" />\n    {/if}\n  </section>\n</div>\n"],"names":["load","async","params","parent","loadWaitForNoFetch","mod","queryStore","query","GetModDocument","client","variables","modId","requestPolicy","description","ctx","data","name","title","image","logo","dirty","metadescriptors_changes","error","message","insert_hydration_dev","target","p","anchor","set_data_dev","t1","t1_value","fetching","create_if_block_2","h1","div","append_hydration_dev","section","$$props","getContextClient","toastStore","getToastStore","onSubmit","modData","mutation","EditModDocument","get","id","toPromise","then","value","console","trigger","background","autohide","timeout","goto","base","$$subscribe_mod","$$invalidate","initialValues","$mod","undefined"],"mappings":"yhBAKO,MAAMA,GAAiBC,OAASC,OAAQC,EAAAA,OAAAA,CAAAA,KAAc,CACxDD,GAAAA,EAAAA,GAAAA,MACOE,GAAmB,CAC3BC,IAAKC,GAAW,CACdC,MAAOC,GACPC,QAAeN,MAAAA,EAAAA,GAAUM,OACzBC,UAAW,CAAEL,IAAKH,EAAOS,OACzBC,cAAe,cAAA,CAAA,CAAA,CAAA,CAAA,4MC4CWC,YAAA,eAAAC,EAAK,CAAAC,EAAAA,KAAKV,IAAIW,KACvBC,MAAA,YAAAH,EAAK,CAAA,EAAAC,KAAKV,IAAIW,KACxBE,MAAAJ,EAAK,GAAAC,KAAKV,IAAIc,wJAFKC,EAAA,IAAAC,EAAAR,YAAA,eAAAC,EAAK,CAAAC,EAAAA,KAAKV,IAAIW,MACvBI,EAAA,IAAAC,EAAAJ,MAAA,YAAAH,EAAK,CAAAC,EAAAA,KAAKV,IAAIW,MACxBI,EAAA,IAAAC,EAAAH,MAAAJ,EAAK,GAAAC,KAAKV,IAAIc,wVAawB,obAFhCL,EAAI,GAACQ,MAAMC,QAAO,wCAA5B,2EAAA,2FAAHC,CAAAA,EAAmCC,EAAAC,EAAAC,CAAAA,6CAAtBb,EAAI,CAAA,EAACQ,MAAMC,QAAO,KAAAK,GAAAC,EAAAC,0WAF/BN,CAAAA,EAAgBC,EAAAC,EAAAC,CAAAA,qMAbdb,CAAAA,EAAI,GAACiB,UAAajB,CAAAA,EAAI,GAACQ,OAASR,EAAI,CAACC,EAAAA,KAAKV,KAAG2B,EAAAlB,CAAAA,yCAY5C,CAAA,OAAAA,GAAKiB,EAAAA,SAAQ,EAERjB,KAAKQ,MAAK,2nBANxBE,EAAgDC,EAAAQ,EAAAN,YAEhDH,EAUKC,EAAAS,EAAAP,GATHQ,EAQSD,EAAAE,2CAnBHtB,EAAI,CAACiB,EAAAA,UAAAA,CAAajB,EAAI,CAACQ,EAAAA,OAASR,EAAI,CAACC,EAAAA,KAAKV,imBA1CrCU,CAAcsB,EAAAA,EAEnB,MAAA5B,EAAS6B,EAAAA,EACTC,EAAaC,EAAAA,EAIbC,EAAYC,IAChBjC,EACGkC,SAASC,EAAe,CACvBjC,MAAOkC,EAAIxC,CAAKU,EAAAA,KAAKV,IAAIyC,GACzBzC,IAAKqC,CAENK,CAAAA,EAAAA,UAAAA,EACAC,KAAMC,GAAAA,CACDA,EAAM3B,OACR4B,QAAQ5B,MAAM2B,EAAM3B,MAAMC,SAC1BgB,EAAWY,QAAO,CAChB5B,QAAS,sBAAwB0B,EAAM3B,MAAMC,QAC7C6B,WAAY,uBACZC,SAAU,OAGZd,EAAWY,QAAO,CAChB5B,QAAO,cACP6B,WAAY,yBACZE,QAAS,GAEXC,CAAAA,EAAAA,EAAKC,EAAO,QAAU7C,CAAAA,swBAvBxB8C,EAAAC,EAAA,EAAA/C,CAAAA,MAAAA,EAAON,IAAQU,CAAAA,EAAAA,EAAIV,kBA4BtBqD,EAAA,EAAAC,EAAgBC,EAAK7C,KAEf,CAAA,GAAA6C,EAAK7C,KAAKV,IACbc,KAAM0C,MAERA,EAAAA,MAAAA"}
{"version":3,"file":"26.B0MUU_Gw.js","sources":["../../../../../../src/routes/settings/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { getContextClient } from '@urql/svelte';\n  import { UpdateUserDocument } from '$lib/generated';\n  import { goto } from '$app/navigation';\n  import { createForm } from 'felte';\n  import { validator } from '@felte/validator-zod';\n  import { reporter, ValidationMessage } from '@felte/reporter-svelte';\n  import { trimNonSchema } from '$lib/utils/forms';\n  import { user } from '$lib/stores/user';\n  import * as zod from 'zod';\n  import type { Form } from '@felte/core';\n  import { base } from '$app/paths';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n  import type { Writable } from 'svelte/store';\n  import { getToastStore } from '@skeletonlabs/skeleton';\n\n  const toastStore = getToastStore();\n\n  const client = getContextClient();\n\n  export const userSchema = zod.object({\n    avatar: zod.optional(zod.any().refine((logo) => 'name' in logo && 'size' in logo && 'type' in logo)),\n    username: zod.string().min(3).max(32)\n  });\n\n  let form: Form<{ [key: string]: string }>['form'];\n  let data: Writable<{ username: string }>;\n\n  $: {\n    if ($user && !data) {\n      const createdForm = createForm<{ username: string }>({\n        initialValues: {\n          username: $user.username\n        },\n        extend: [validator({ schema: userSchema }), reporter],\n        onSubmit: (submitted: { username: string; avatar: unknown }) => {\n          console.log('submitted', submitted);\n          client\n            .mutation(UpdateUserDocument, {\n              user: trimNonSchema(submitted, userSchema),\n              userId: $user.id\n            })\n            .toPromise()\n            .then((value) => {\n              if (value.error) {\n                console.error(value.error.message);\n                toastStore.trigger({\n                  message: 'Error editing user: ' + value.error.message,\n                  background: 'variant-filled-error',\n                  autohide: false\n                });\n              } else {\n                toastStore.trigger({\n                  message: `User updated`,\n                  background: 'variant-filled-success',\n                  timeout: 5000\n                });\n                goto(base + '/user/' + value.data.updateUser.id);\n              }\n            });\n        }\n      });\n\n      form = createdForm.form;\n      data = createdForm.data;\n    }\n  }\n</script>\n\n<svelte:head>\n  <MetaDescriptors description=\"Change your user settings\" title=\"Settings\" />\n</svelte:head>\n\n<h1 class=\"my-4 text-4xl font-bold\">Settings</h1>\n\n<div class=\"card p-4\">\n  <section>\n    {#if $user === null}\n      <p>Please log in</p>\n    {:else}\n      <form use:form>\n        <div class=\"grid grid-flow-row gap-6\">\n          <div class=\"grid grid-flow-row gap-2\">\n            <label for=\"avatar\">Avatar:</label>\n            <input\n              id=\"avatar\"\n              class=\"base-input\"\n              name=\"avatar\"\n              type=\"file\"\n              accept=\"image/png,image/jpeg,image/gif\"\n              placeholder=\"Avatar\" />\n            <ValidationMessage for=\"avatar\" let:messages={message}>\n              <span class=\"validation-message\">{message || ''}</span>\n            </ValidationMessage>\n          </div>\n\n          <div class=\"grid grid-flow-row gap-2\">\n            <label class=\"label\">\n              <span>Username</span>\n              <input type=\"text\" bind:value={$data.username} required class=\"input p-2\" />\n            </label>\n            <ValidationMessage for=\"username\" let:messages={message}>\n              <span class=\"validation-message\">{message || ''}</span>\n            </ValidationMessage>\n          </div>\n\n          <div>\n            <button class=\"variant-ghost-primary btn\" type=\"submit\">Save</button>\n          </div>\n        </div>\n      </form>\n    {/if}\n  </section>\n</div>\n"],"names":["message","insert_hydration_dev","target","form_1","anchor","append_hydration_dev","div3","div0","label0","input0","div1","label1","span","input1","set_input_value","ctx","username","div2","button","dirty","value","p","t_value","set_data_dev","t","h1","div","section","toastStore","getToastStore","client","getContextClient","userSchema","zod.object","avatar","zod.optional","zod.any","refine","logo","zod.string","min","max","form","data","$data","this","$user","createdForm","createForm","initialValues","extend","validator","schema","reporter","onSubmit","submitted","console","log","mutation","UpdateUserDocument","user","trimNonSchema","userId","id","toPromise","then","error","trigger","background","autohide","timeout","goto","base","updateUser"],"mappings":"g4BA2F0DA,CAAAA,KAAO,CAAA,EAAAA,eAAPA,CAAOA,IAAAA,EAAA,IAAA,CAAA,CAAA,gGAULA,CAAO,KAAA,CAAA,EAAAA,CAAAA,cAAPA,CAAAA,IAAOA,EAAA,IAAA,4sDArB7DC,EA8BMC,EAAAC,EAAAC,CAAAA,EA7BJC,EA4BKF,EAAAG,CAAAA,EA3BHD,EAYKC,EAAAC,CAXHF,EAAAA,EAAkCE,EAAAC,CAAAA,OAClCH,EAAAA,EAMwBE,EAAAE,CAAAA,4BAM1BJ,EAQKC,EAAAI,CAPHL,EAAAA,EAGOK,EAAAC,CAFLN,EAAAA,EAAoBM,EAAAC,CAAAA,OACpBP,EAAAA,EAA2EM,EAAAE,CAAAA,EAA5CC,GAAAD,EAAAE,KAAMC,kCAOzCX,EAAAA,EAEKC,EAAAW,CAAAA,EADHZ,EAAoEY,EAAAC,CAAAA,wIARnCC,EAAA,GAAAN,EAAAO,QAAAL,KAAMC,UAANF,GAAAD,EAAAE,GAAMC,EAAAA,QAAAA,ujBArB7Cf,EAAmBC,EAAAmB,EAAAjB,CAAAA,wKAcuBkB,GAAAP,GAAW,GAAA,IAAE,8NAA/Cd,EAAsDC,EAAAU,EAAAR,CAAAA,0BAApBe,EAAA,KAAAG,KAAAA,GAAAP,MAAW,IAAE,KAAAQ,GAAAC,EAAAF,uMAUbA,GAAAP,GAAW,GAAA,IAAE,+NAA/Cd,EAAsDC,EAAAU,EAAAR,CAAAA,yBAApB,CAAAe,EAAA,KAAAG,KAAAA,GAAAP,GAAW,GAAA,IAAE,KAAAQ,GAAAC,EAAAF,CAAAA,kWAzBpD,OAAAP,GAAU,IAAA,KAAI,2mBAJvBd,EAAgDC,EAAAuB,EAAArB,CAAAA,SAEhDH,EAAAA,EAsCKC,EAAAwB,EAAAtB,GArCHC,EAoCSqB,EAAAC,ykBAhGH,MAAAC,EAAaC,GAEb,EAAAC,EAASC,GAAAA,EAEFC,EAAaC,GAAU,CAClCC,OAAQC,GAAaC,GAAAA,EAAUC,OAAQC,GAAS,SAAUA,GAAQ,SAAUA,GAAQ,SAAUA,CAAAA,CAAAA,EAC9FtB,SAAUuB,GAAaC,EAAAA,IAAI,CAAGC,EAAAA,IAAI,UAGhCC,EACAC,+JAyEuCC,EAAM5B,SAAQ6B,KAAAzB,qcAtEnD0B,GAAUH,CAAAA,EAAI,CACV,MAAAI,EAAcC,GAAU,CAC5BC,cACE,CAAAjC,SAAU8B,EAAM9B,UAElBkC,QAASC,GAAS,CAAGC,OAAQpB,CAAAA,CAAAA,EAAeqB,IAC5CC,SAAWC,GAAAA,CACTC,QAAQC,IAAI,YAAaF,CAAAA,EACzBzB,EACG4B,SAASC,GAAkB,CAC1BC,KAAMC,GAAcN,EAAWvB,CAAAA,EAC/B8B,OAAQhB,EAAMiB,EAAAA,CAAAA,EAEfC,UACAC,EAAAA,KAAM7C,GACD,CAAAA,EAAM8C,OACRV,QAAQU,MAAM9C,EAAM8C,MAAMlE,SAC1B4B,EAAWuC,QAAO,CAChBnE,QAAS,uBAAyBoB,EAAM8C,MAAMlE,QAC9CoE,WAAY,uBACZC,SAAU,EAAA,CAAA,IAGZzC,EAAWuC,QAAO,CAChBnE,QAAO,eACPoE,WAAY,yBACZE,QAAS,GAEXC,CAAAA,EAAAA,GAAKC,GAAO,SAAWpD,EAAMuB,KAAK8B,WAAWV,cAMvDrB,EAAOK,EAAYL,IAAAA,QACnBC,EAAOI,EAAYJ,IAAAA,CAAAA"}
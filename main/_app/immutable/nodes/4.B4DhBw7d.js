import{S as nt,i as st,s as at,e as T,a as I,c as A,G as D,g as C,d as G,f as g,H as y,j as v,t as E,l as Y,m as H,_ as rt,aa as lt,a3 as it,a0 as ot,k as _,u as ct,ab as ut,C as Q,F as X,I as Z,J as k,L as q,N as tt,V as w,W as F,Y as j,q as P,R as z,b as J,T as ft,ac as mt,K as B,O as gt}from"../chunks/vendor.Cud4K2yl.js";import{G as dt,A as ht,C as pt,b as $t,D as vt}from"../chunks/graphql.DCCO4iQ1.js";function K(r,t,l){const s=r.slice();return s[18]=t[l],s[19]=t,s[20]=l,s}function xt(r){let t,l,s,e,a='<span>Add new announcement</span> <span class="material-icons">add</span>',n,f,i;return t=new ut({props:{$$slots:{default:[kt]},$$scope:{ctx:r}}}),{c(){Q(t.$$.fragment),l=I(),s=T("section"),e=T("button"),e.innerHTML=a,this.h()},l(o){X(t.$$.fragment,o),l=C(o),s=A(o,"SECTION",{class:!0});var d=G(s);e=A(d,"BUTTON",{class:!0,"data-svelte-h":!0}),D(e)!=="svelte-1e8qn6m"&&(e.innerHTML=a),d.forEach(g),this.h()},h(){y(e,"class","variant-ghost-primary btn"),y(s,"class","p-4")},m(o,d){Z(t,o,d),v(o,l,d),v(o,s,d),k(s,e),n=!0,f||(i=q(e,"click",r[4]),f=!0)},p(o,d){const u={};d&2097158&&(u.$$scope={dirty:d,ctx:o}),t.$set(u)},i(o){n||(H(t.$$.fragment,o),n=!0)},o(o){E(t.$$.fragment,o),n=!1},d(o){o&&(g(l),g(s)),tt(t,o),f=!1,i()}}}function yt(r){let t,l,s=r[0].error.message+"",e;return{c(){t=T("h1"),l=w("Failed to load announcements: "),e=w(s),this.h()},l(a){t=A(a,"H1",{class:!0});var n=G(t);l=F(n,"Failed to load announcements: "),e=F(n,s),n.forEach(g),this.h()},h(){y(t,"class","svelte-1egakhm")},m(a,n){v(a,t,n),k(t,l),k(t,e)},p(a,n){n&1&&s!==(s=a[0].error.message+"")&&j(e,s)},i:P,o:P,d(a){a&&g(t)}}}function Tt(r){let t,l="Loading announcements...";return{c(){t=T("h1"),t.textContent=l,this.h()},l(s){t=A(s,"H1",{class:!0,"data-svelte-h":!0}),D(t)!=="svelte-emqmfi"&&(t.textContent=l),this.h()},h(){y(t,"class","svelte-1egakhm")},m(s,e){v(s,t,e)},p:P,i:P,o:P,d(s){s&&g(t)}}}function At(r){let t,l=r[18].importance+"",s,e,a=f()+"",n;function f(){return r[13](r[18])}return{c(){t=w("("),s=w(l),e=w(") "),n=w(a)},l(i){t=F(i,"("),s=F(i,l),e=F(i,") "),n=F(i,a)},m(i,o){v(i,t,o),v(i,s,o),v(i,e,o),v(i,n,o)},p(i,o){r=i,o&2&&l!==(l=r[18].importance+"")&&j(s,l),o&2&&a!==(a=f()+"")&&j(n,a)},d(i){i&&(g(t),g(s),g(e),g(n))}}}function bt(r){let t,l,s="Message",e,a,n=r[18],f,i,o="Importance (Fix, Info, Warning, Alert)",d,u,h,p,M="<span>Delete</span>",N,L,V;function W(){r[7].call(a,r[19],r[20])}const O=()=>r[8](a,n),U=()=>r[8](null,n);function c(){return r[9](r[18])}function m(){r[10].call(u,r[19],r[20])}function b(){return r[11](r[18])}function et(...x){return r[12](r[18],...x)}return{c(){t=T("div"),l=T("div"),l.textContent=s,e=I(),a=T("input"),f=I(),i=T("div"),i.textContent=o,d=I(),u=T("input"),h=I(),p=T("button"),p.innerHTML=M,N=I(),this.h()},l(x){t=A(x,"DIV",{});var $=G(t);l=A($,"DIV",{"data-svelte-h":!0}),D(l)!=="svelte-xcpyc9"&&(l.textContent=s),e=C($),a=A($,"INPUT",{type:!0,class:!0,placeholder:!0}),f=C($),i=A($,"DIV",{"data-svelte-h":!0}),D(i)!=="svelte-y6iqce"&&(i.textContent=o),d=C($),u=A($,"INPUT",{type:!0,class:!0,placeholder:!0}),$.forEach(g),h=C(x),p=A(x,"BUTTON",{class:!0,"data-svelte-h":!0}),D(p)!=="svelte-1iflz2x"&&(p.innerHTML=M),N=C(x),this.h()},h(){y(a,"type","text"),y(a,"class","input p-2"),y(a,"placeholder","This is the text of the announcement"),y(u,"type","text"),y(u,"class","input p-2"),y(u,"placeholder","Importance level"),y(p,"class","variant-ghost-error btn")},m(x,$){v(x,t,$),k(t,l),k(t,e),k(t,a),B(a,r[18].message),O(),k(t,f),k(t,i),k(t,d),k(t,u),B(u,r[18].importance),v(x,h,$),v(x,p,$),v(x,N,$),L||(V=[q(a,"input",W),q(a,"change",c),q(u,"input",m),q(u,"change",b),q(p,"click",et)],L=!0)},p(x,$){r=x,$&2&&a.value!==r[18].message&&B(a,r[18].message),n!==r[18]&&(U(),n=r[18],O()),$&2&&u.value!==r[18].importance&&B(u,r[18].importance)},d(x){x&&(g(t),g(h),g(p),g(N)),U(),L=!1,gt(V)}}}function R(r){let t,l;return t=new mt({props:{$$slots:{content:[bt],summary:[At]},$$scope:{ctx:r}}}),{c(){Q(t.$$.fragment)},l(s){X(t.$$.fragment,s)},m(s,e){Z(t,s,e),l=!0},p(s,e){const a={};e&2097158&&(a.$$scope={dirty:e,ctx:s}),t.$set(a)},i(s){l||(H(t.$$.fragment,s),l=!0)},o(s){E(t.$$.fragment,s),l=!1},d(s){tt(t,s)}}}function kt(r){let t,l,s=z(r[1]),e=[];for(let n=0;n<s.length;n+=1)e[n]=R(K(r,s,n));const a=n=>E(e[n],1,1,()=>{e[n]=null});return{c(){for(let n=0;n<e.length;n+=1)e[n].c();t=J()},l(n){for(let f=0;f<e.length;f+=1)e[f].l(n);t=J()},m(n,f){for(let i=0;i<e.length;i+=1)e[i]&&e[i].m(n,f);v(n,t,f),l=!0},p(n,f){if(f&102){s=z(n[1]);let i;for(i=0;i<s.length;i+=1){const o=K(n,s,i);e[i]?(e[i].p(o,f),H(e[i],1)):(e[i]=R(o),e[i].c(),H(e[i],1),e[i].m(t.parentNode,t))}for(_(),i=s.length;i<e.length;i+=1)a(i);Y()}},i(n){if(!l){for(let f=0;f<s.length;f+=1)H(e[f]);l=!0}},o(n){e=e.filter(Boolean);for(let f=0;f<e.length;f+=1)E(e[f]);l=!1},d(n){n&&g(t),ft(e,n)}}}function It(r){let t,l="Announcements",s,e,a,n,f;const i=[Tt,yt,xt],o=[];function d(u,h){return u[0].fetching?0:u[0].error?1:2}return a=d(r),n=o[a]=i[a](r),{c(){t=T("h1"),t.textContent=l,s=I(),e=T("div"),n.c(),this.h()},l(u){t=A(u,"H1",{class:!0,"data-svelte-h":!0}),D(t)!=="svelte-1q88ok2"&&(t.textContent=l),s=C(u),e=A(u,"DIV",{class:!0});var h=G(e);n.l(h),h.forEach(g),this.h()},h(){y(t,"class","svelte-1egakhm"),y(e,"class","card")},m(u,h){v(u,t,h),v(u,s,h),v(u,e,h),o[a].m(e,null),f=!0},p(u,[h]){let p=a;a=d(u),a===p?o[a].p(u,h):(_(),E(o[p],1,1,()=>{o[p]=null}),Y(),n=o[a],n?n.p(u,h):(n=o[a]=i[a](u),n.c()),H(n,1),n.m(e,null))},i(u){f||(H(n),f=!0)},o(u){E(n),f=!1},d(u){u&&(g(t),g(s),g(e)),o[a].d()}}}const S="New Announcement";function Ct(r,t,l){let s;const e=rt();let a=[];const n={};let f=-1;const i=lt({query:dt,client:e});it(r,i,c=>l(0,s=c));const o=ot();function d(){if(a.find(c=>c.message==S))n[a[a.length-1].id].focus();else{const c={id:f--,message:S,importance:ht.Info};a.push(c),l(1,a),l(0,s),setTimeout(()=>{const m=n[c.id];m.focus(),m.getElement().querySelectorAll("input")[0].select()},0)}}async function u(c){if(c.message==S)return;let m=!1;if(c.id<0){try{const b=await e.mutation(pt,{announcement:{importance:c.importance,message:c.message}}).toPromise();b.data&&(c.id=b.data.createAnnouncement.id,m=!0)}catch(b){console.log(b)}if(!m){o.trigger({message:`Failed to create Announcement '${c.message}'!`,background:"variant-filled-error",timeout:2e3});return}}else{try{c.message.length>0&&(m=(await e.mutation($t,{id:c.id,announcement:{importance:c.importance,message:c.message}}).toPromise()).data.updateAnnouncement!=null)}catch{}if(!m){o.trigger({message:`Failed to update Announcement '${c.message}'!`,background:"variant-filled-error",timeout:2e3});return}}o.trigger({message:`Announcement '${c.message}' saved!`,background:"variant-filled-success",timeout:2e3})}async function h(c){if(c.message!=S){let m=!1;try{m=(await e.mutation(vt,{id:c.id}).toPromise()).data.deleteAnnouncement}catch{m=!1}if(!m){o.trigger({message:`Failed to remove Announcement '${c.message}'!`,background:"variant-filled-error",timeout:2e3});return}}else a.splice(a.indexOf(c),1);o.trigger({message:`Tag '${c.message}' removed!`,background:"variant-filled-success",timeout:2e3})}function p(c,m){c.stopPropagation(),h(m)}function M(c,m){c[m].message=this.value,l(1,a),l(0,s)}function N(c,m){ct[c?"unshift":"push"](()=>{n[m.id]=c,l(2,n)})}const L=c=>u(c);function V(c,m){c[m].importance=this.value,l(1,a),l(0,s)}const W=c=>u(c),O=(c,m)=>p(m,c),U=c=>{const b=c.message.substring(0,144);return c.message.length>144?b+"...":b};return r.$$.update=()=>{r.$$.dirty&1&&l(1,a=s.data?.getAnnouncements||[])},[s,a,n,i,d,u,p,M,N,L,V,W,O,U]}class qt extends nt{constructor(t){super(),st(this,t,Ct,It,at,{})}}export{qt as component};
//# sourceMappingURL=4.B4DhBw7d.js.map

{"version":3,"file":"20.acd54c62.js","sources":["../../../../../../src/routes/mod/[modId]/version/[versionId]/edit/+page.ts","../../../../../../src/routes/mod/[modId]/version/[versionId]/edit/+page.svelte"],"sourcesContent":["import type { PageLoad } from './$types';\n\nexport const load: PageLoad = async ({ params }) => ({\n  ...params\n});\n","<script lang=\"ts\">\n  import { queryStore, getContextClient } from '@urql/svelte';\n  import { GetModVersionDocument, UpdateVersionDocument } from '$lib/generated';\n  import Toast from '$lib/components/general/Toast.svelte';\n  import { goto } from '$app/navigation';\n  import VersionForm from '$lib/components/versions/VersionForm.svelte';\n  import type { VersionData } from '$lib/models/versions';\n  import { base } from '$app/paths';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n  import Card, { Content } from '@smui/card';\n  import type { PageData } from './$types';\n\n  export let data: PageData;\n\n  $: ({ modId, versionId } = data);\n\n  const client = getContextClient();\n\n  let errorMessage = '';\n  let errorToast = false;\n\n  $: version = queryStore({\n    query: GetModVersionDocument,\n    client,\n    variables: { version: versionId }\n  });\n\n  const onSubmit = async (versionData: VersionData) =>\n    client\n      .mutation(UpdateVersionDocument, {\n        versionId: versionId,\n        version: versionData\n      })\n      .toPromise()\n      .then((value) => {\n        if (value.error) {\n          console.error(value.error.message);\n          errorMessage = 'Error editing version: ' + value.error.message;\n          errorToast = true;\n        } else {\n          // TODO Toast or something\n          return goto(base + '/mod/' + modId + '/version/' + versionId);\n        }\n      });\n\n  $: if (!errorToast) {\n    errorMessage = '';\n  }\n\n  $: initialValues = $version.data\n    ? {\n        ...$version.data.getVersion,\n        logo: undefined\n      }\n    : undefined;\n</script>\n\n<svelte:head>\n  {#if !$version.fetching && !$version.error && $version.data.getVersion}\n    <MetaDescriptors\n      description=\"Editing mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\"\n      title=\"Edit mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\" />\n  {/if}\n</svelte:head>\n\n<h1 class=\"text-4xl my-4 font-bold\">Edit Version</h1>\n\n<Card>\n  <Content>\n    {#if $version.fetching}\n      <p>Loading...</p>\n    {:else if $version.error}\n      <p>Oh no... {$version.error.message}</p>\n    {:else}\n      <VersionForm\n        {onSubmit}\n        {initialValues}\n        modReference={$version.data.getVersion.mod.mod_reference}\n        editing={true}\n        submitText=\"Save\" />\n    {/if}\n  </Content>\n</Card>\n\n<Toast bind:running={errorToast}>\n  <span>{errorMessage}</span>\n</Toast>\n"],"names":["load","async","params","description","ctx","data","getVersion","mod","name","version","title","dirty","metadescriptors_changes","modReference","mod_reference","versionform_changes","error","message","insert_hydration","target","p","anchor","set_data","t1","t1_value","fetching","span","create_if_block_2","h1","$$props","client","getContextClient","errorMessage","errorToast","onSubmit","mutation","UpdateVersionDocument","versionId","versionData","toPromise","then","value","console","$$invalidate","goto","base","modId","$$subscribe_version","queryStore","query","GetModVersionDocument","variables","initialValues","$version","logo","undefined"],"mappings":"+gBAEO,MAAMA,GAAiBC,MAAAA,CAASC,aAAc,CAChDA,GAAAA,CAAAA,uJCyDmCC,YAAA,uBAAAC,EAAS,GAAAC,KAAKC,WAAWC,IAAIC,KAAI,IAAGJ,EAAS,CAAA,EAAAC,KAAKC,WAAWG,QACtEC,MAAA,oBAAAN,EAAS,GAAAC,KAAKC,WAAWC,IAAIC,KAAI,IAAGJ,EAAS,CAAA,EAAAC,KAAKC,WAAWG,OAAAA,CAAAA,CAAAA,0FADpDE,EAAA,IAAAC,EAAAT,YAAA,uBAAAC,EAAS,GAAAC,KAAKC,WAAWC,IAAIC,KAAI,IAAGJ,EAAS,CAAAC,EAAAA,KAAKC,WAAWG,SACtEE,EAAA,IAAAC,EAAAF,MAAA,oBAAAN,EAAS,CAAAC,EAAAA,KAAKC,WAAWC,IAAIC,KAAI,IAAGJ,EAAS,CAAA,EAAAC,KAAKC,WAAWG,mLAgBtEI,aAAAT,KAASC,KAAKC,WAAWC,IAAIO,sBAClC,4IADKH,EAAA,IAAAI,EAAAF,aAAAT,GAASC,EAAAA,KAAKC,WAAWC,IAAIO,kIALhCV,EAAQ,CAACY,EAAAA,MAAMC,QAAO,6BAAhC,yDAAA,0CAAHC,CAAAA,EAAuCC,EAAAC,EAAAC,qCAA1BjB,EAAQ,CAAA,EAACY,MAAMC,QAAO,KAAAK,EAAAC,EAAAC,0EAFhC,mDAAA,mCAAHN,EAAgBC,EAAAC,EAAAC,yGADb,OAAAjB,KAASqB,SAAQ,EAEZrB,KAASY,MAAK,ypBAcnBZ,EAAY,4CAAZA,EAAY,CAAA,CAAA,sBAAnBc,CAAAA,EAA0BC,EAAAO,EAAAL,CAAAA,0BAAnBjB,EAAY,8DA3BbA,EAAQ,CAACqB,EAAAA,UAAAA,CAAarB,EAAQ,CAACY,EAAAA,OAASZ,EAAQ,CAACC,EAAAA,KAAKC,YAAUqB,EAAAvB,CAAAA,wIA0BnDA,EAAU,wBAAVA,EAAU,6FAnBK,kMAAA,qMAApCc,EAAoDC,EAAAS,EAAAP,8DAP5CjB,EAAQ,CAAA,EAACqB,WAAarB,EAAQ,CAAA,EAACY,OAASZ,EAAQ,GAACC,KAAKC,kPA0BzCF,EAAU,6TAxElBC,CAAcwB,EAAAA,EAInB,MAAAC,EAASC,EAAAA,EAEX,IAAAC,EAAe,GACfC,EAAa,GAQX,MAAAC,WACJJ,EACGK,SAASC,GAAqB,CAClBC,YACX5B,QAAS6B,CAAAA,CAAAA,EAEVC,YACAC,KAAMC,GAAAA,CACD,GAAAA,EAAMzB,MACR0B,QAAQ1B,MAAMyB,EAAMzB,MAAMC,OAAAA,EAC1B0B,EAAA,EAAAX,EAAe,0BAA4BS,EAAMzB,MAAMC,OACvD0B,EAAAA,EAAA,EAAAV,EAAa,EAAA,cAGNW,EAAKC,GAAO,QAAUC,EAAQ,YAAcT,CAAAA,kBA2CxCJ,EAAUQ,uFAtEvBE,EAAA,EAAA,CAAAG,QAAOT,UAAchC,CAAAA,EAAAA,EAAIgC,mBAO9BU,EAAAJ,EAAA,EAAElC,EAAUuC,EAAU,CACrBC,MAAOC,GACPpB,OAAAA,EACAqB,UAAS,CAAI1C,QAAS4B,sBAqBhBJ,GACNU,EAAA,EAAAX,EAAe,mBAGdW,EAAA,EAAAS,EAAgBC,EAAShD,SAEnBgD,EAAShD,KAAKC,WACjBgD,KAAMC,MAAAA,EAERA"}
import{aa as mt,S as ht,i as pt,s as vt,b as st,a as T,e as E,V as q,D as gt,f as u,g as _,c as V,d as D,W as z,G as tt,H as C,J as y,j as N,L as bt,m as A,t as G,l as nt,Y as L,Z as wt,_ as $t,a3 as W,a0 as xt,ae as yt,C as Y,F as Z,I as Q,N as X,k as it,q as H,r as It,w as K,a1 as lt,a2 as ct,h as dt}from"../chunks/vendor.CjqjvYE3.js";import{V as Et}from"../chunks/VersionForm.oBD2e3Rg.js";import{y as Vt,F as kt,z as Dt,B as Pt,t as Ct}from"../chunks/graphql.DCCO4iQ1.js";import{M as Nt}from"../chunks/MetaDescriptors.43r9wqSh.js";import{E as Ft}from"../chunks/EditCompatibilityForm.pW7rBH7W.js";const St=async({params:s})=>({...s}),Rt=Object.freeze(Object.defineProperty({__proto__:null,load:St},Symbol.toStringTag,{value:"Module"})),Tt=async(s,t,a,e,r)=>{const g=Math.ceil(s.size/1e7),p=new Array(g).fill(0).map((i,m)=>m).reverse(),l=(i,m,v)=>r.mutation(Pt,{modId:t,versionId:v,part:m,file:i}).toPromise(),x=10;let c=0,o=0;const f=i=>{if(c>=x||!p.length)return;const m=p.pop(),v=m*1e7,w=s.slice(v,v+1e7);return c+=1,Promise.all([l(w,m+1,i).then(()=>(c-=1,e.set({total:g,uploaded:g-p.length-c}),f(i))).catch(b=>{if(console.error("Upload failed:",b),c-=1,p.push(m),o+=1,o<5)return f(i);throw new Error("Failed uploading after 5 attempts")}),f(i)])};return r.mutation(Vt,{modId:t}).toPromise().then(async i=>(e.set({total:g,uploaded:0}),await f(i.data.createVersion),i.data.createVersion)).then(i=>(console.log("Finalizing",{versionID:i}),r.mutation(kt,{modId:t,versionId:i,version:a}).toPromise().then(()=>new Promise((m,v)=>{let w=0,b=mt({query:Dt,client:r,variables:{modId:t,versionId:i},requestPolicy:"network-only"});const I=setInterval(()=>{if(w==60)return clearInterval(I),v(new Error("Timed out waiting for mod processing"));b.pause(),b.resume(),w++},1e4),F=b.subscribe(P=>{if(!P.fetching){if(P.error){clearInterval(I),v(new Error(P.error.message)),setTimeout(F);return}P.data?.checkVersionUploadState?.version?.id&&(F(),clearInterval(I),m(P.data.checkVersionUploadState))}})})))).catch(i=>{throw console.error(i),i})};function ft(s){let t,a;return t=new Nt({props:{description:"Creating a new version of mod "+s[1].data.mod.name,title:"New version of mod "+s[1].data.mod.name}}),{c(){Y(t.$$.fragment)},l(e){Z(t.$$.fragment,e)},m(e,r){Q(t,e,r),a=!0},p(e,r){const h={};r&2&&(h.description="Creating a new version of mod "+e[1].data.mod.name),r&2&&(h.title="New version of mod "+e[1].data.mod.name),t.$set(h)},i(e){a||(A(t.$$.fragment,e),a=!0)},o(e){G(t.$$.fragment,e),a=!1},d(e){X(t,e)}}}function _t(s){let t=s[1].data.mod.name+"",a;return{c(){a=q(t)},l(e){a=z(e,t)},m(e,r){N(e,a,r)},p(e,r){r&2&&t!==(t=e[1].data.mod.name+"")&&L(a,t)},d(e){e&&u(a)}}}function qt(s){let t;return{c(){t=q("...")},l(a){t=z(a,"...")},m(a,e){N(a,t,e)},p:H,d(a){a&&u(t)}}}function zt(s){let t,a,e,r,h="<span>Edit Compatibility Info</span>",g,p,l,x;t=new Et({props:{onSubmit:s[8],modReference:s[1].data.mod.mod_reference,submitIcon:"add_circle"}});let c=s[3]&&ut(s);return l=new Ft({props:{mod:s[1].data.mod,modId:s[1].data.mod.id}}),l.$on("fail",s[13]),l.$on("submit",s[14]),{c(){Y(t.$$.fragment),a=T(),c&&c.c(),e=T(),r=E("div"),r.innerHTML=h,g=T(),p=E("div"),Y(l.$$.fragment),this.h()},l(o){Z(t.$$.fragment,o),a=_(o),c&&c.l(o),e=_(o),r=V(o,"DIV",{class:!0,"data-svelte-h":!0}),tt(r)!=="svelte-uk6ytd"&&(r.innerHTML=h),g=_(o),p=V(o,"DIV",{class:!0});var f=D(p);Z(l.$$.fragment,f),f.forEach(u),this.h()},h(){C(r,"class","p-4"),C(p,"class","card p-4")},m(o,f){Q(t,o,f),N(o,a,f),c&&c.m(o,f),N(o,e,f),N(o,r,f),N(o,g,f),N(o,p,f),Q(l,p,null),x=!0},p(o,f){const i={};f&2&&(i.modReference=o[1].data.mod.mod_reference),t.$set(i),o[3]?c?c.p(o,f):(c=ut(o),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null);const m={};f&2&&(m.mod=o[1].data.mod),f&2&&(m.modId=o[1].data.mod.id),l.$set(m)},i(o){x||(A(t.$$.fragment,o),A(l.$$.fragment,o),x=!0)},o(o){G(t.$$.fragment,o),G(l.$$.fragment,o),x=!1},d(o){o&&(u(a),u(e),u(r),u(g),u(p)),X(t,o),c&&c.d(o),X(l)}}}function Mt(s){let t,a,e=s[1].error.message+"",r;return{c(){t=E("p"),a=q("Oh no... "),r=q(e)},l(h){t=V(h,"P",{});var g=D(t);a=z(g,"Oh no... "),r=z(g,e),g.forEach(u)},m(h,g){N(h,t,g),y(t,a),y(t,r)},p(h,g){g&2&&e!==(e=h[1].error.message+"")&&L(r,e)},i:H,o:H,d(h){h&&u(t)}}}function Ot(s){let t,a="Loading...";return{c(){t=E("p"),t.textContent=a},l(e){t=V(e,"P",{"data-svelte-h":!0}),tt(t)!=="svelte-qdsr2u"&&(t.textContent=a)},m(e,r){N(e,t,r)},p:H,i:H,o:H,d(e){e&&u(t)}}}function ut(s){let t,a,e,r,h,g,p,l,x=s[4].toFixed(0)+"",c,o,f,i,m;return{c(){t=E("div"),a=E("div"),e=E("div"),r=E("span"),h=q(s[3]),g=T(),p=E("div"),l=E("span"),c=q(x),o=q("%"),f=T(),i=E("div"),m=E("div"),this.h()},l(v){t=V(v,"DIV",{class:!0});var w=D(t);a=V(w,"DIV",{class:!0});var b=D(a);e=V(b,"DIV",{});var I=D(e);r=V(I,"SPAN",{class:!0});var F=D(r);h=z(F,s[3]),F.forEach(u),I.forEach(u),g=_(b),p=V(b,"DIV",{class:!0});var P=D(p);l=V(P,"SPAN",{class:!0});var S=D(l);c=z(S,x),o=z(S,"%"),S.forEach(u),P.forEach(u),b.forEach(u),f=_(w),i=V(w,"DIV",{class:!0});var $=D(i);m=V($,"DIV",{style:!0,class:!0}),D(m).forEach(u),$.forEach(u),w.forEach(u),this.h()},h(){C(r,"class","inline-block rounded-full bg-yellow-600 px-2 py-1 text-xs font-semibold uppercase text-white"),C(l,"class","inline-block text-xs font-semibold text-white"),C(p,"class","text-right"),C(a,"class","mb-2 flex items-center justify-between"),dt(m,"width",s[4].toFixed(0)+"%"),C(m,"class","flex flex-col justify-center whitespace-nowrap bg-yellow-600 text-center text-white shadow-none"),C(i,"class","mb-4 flex h-2 overflow-hidden rounded bg-neutral-600 text-xs"),C(t,"class","relative pt-4")},m(v,w){N(v,t,w),y(t,a),y(a,e),y(e,r),y(r,h),y(a,g),y(a,p),y(p,l),y(l,c),y(l,o),y(t,f),y(t,i),y(i,m)},p(v,w){w&8&&L(h,v[3]),w&16&&x!==(x=v[4].toFixed(0)+"")&&L(c,x),w&16&&dt(m,"width",v[4].toFixed(0)+"%")},d(v){v&&u(t)}}}function jt(s){let t,a,e,r,h,g,p,l,x,c="arrow_back",o,f=s[2]("version.back")+"",i,m,v,w,b,I,F,P,S,$=!s[1].fetching&&!s[1].error&&s[1].data.mod&&ft(s);function B(d,k){if(d[1].fetching)return qt;if(!d[1].error)return _t}let M=B(s),n=M&&M(s);const U=[Ot,Mt,zt],O=[];function et(d,k){return d[1].fetching?0:d[1].error?1:2}return b=et(s),I=O[b]=U[b](s),{c(){$&&$.c(),t=st(),a=T(),e=E("div"),r=E("h1"),h=q(`New Version for
    `),n&&n.c(),g=T(),p=E("div"),l=E("button"),x=E("span"),x.textContent=c,o=T(),i=q(f),m=T(),v=E("div"),w=E("section"),I.c(),this.h()},l(d){const k=gt("svelte-nx2zao",document.head);$&&$.l(k),t=st(),k.forEach(u),a=_(d),e=V(d,"DIV",{class:!0});var j=D(e);r=V(j,"H1",{class:!0});var J=D(r);h=z(J,`New Version for
    `),n&&n.l(J),J.forEach(u),g=_(j),p=V(j,"DIV",{});var at=D(p);l=V(at,"BUTTON",{class:!0,title:!0});var R=D(l);x=V(R,"SPAN",{class:!0,"data-svelte-h":!0}),tt(x)!=="svelte-qua3zr"&&(x.textContent=c),o=_(R),i=z(R,f),R.forEach(u),at.forEach(u),j.forEach(u),m=_(d),v=V(d,"DIV",{class:!0});var rt=D(v);w=V(rt,"SECTION",{});var ot=D(w);I.l(ot),ot.forEach(u),rt.forEach(u),this.h()},h(){C(r,"class","my-4 text-4xl font-bold"),C(x,"class","material-icons pr-2"),C(l,"class","variant-ghost-primary btn"),C(l,"title","View the description page for this mod"),C(e,"class","flex h-auto flex-wrap items-center justify-between"),C(v,"class","card p-4")},m(d,k){$&&$.m(document.head,null),y(document.head,t),N(d,a,k),N(d,e,k),y(e,r),y(r,h),n&&n.m(r,null),y(e,g),y(e,p),y(p,l),y(l,x),y(l,o),y(l,i),N(d,m,k),N(d,v,k),y(v,w),O[b].m(w,null),F=!0,P||(S=bt(l,"click",s[12]),P=!0)},p(d,[k]){!d[1].fetching&&!d[1].error&&d[1].data.mod?$?($.p(d,k),k&2&&A($,1)):($=ft(d),$.c(),A($,1),$.m(t.parentNode,t)):$&&(it(),G($,1,1,()=>{$=null}),nt()),M===(M=B(d))&&n?n.p(d,k):(n&&n.d(1),n=M&&M(d),n&&(n.c(),n.m(r,null))),(!F||k&4)&&f!==(f=d[2]("version.back")+"")&&L(i,f);let j=b;b=et(d),b===j?O[b].p(d,k):(it(),G(O[j],1,1,()=>{O[j]=null}),nt(),I=O[b],I?I.p(d,k):(I=O[b]=U[b](d),I.c()),A(I,1),I.m(w,null))},i(d){F||(A($),A(I),F=!0)},o(d){G($),G(I),F=!1},d(d){d&&(u(a),u(e),u(m),u(v)),$&&$.d(d),u(t),n&&n.d(),O[b].d(),P=!1,S()}}}function At(s,t,a){let e,r,h=H,g=()=>(h(),h=It(x,n=>a(2,r=n)),x),p,l;s.$$.on_destroy.push(()=>h());const{t:x}=wt();g();let{data:c}=t;const{modId:o}=c,f=$t(),i=K("");W(s,i,n=>a(3,p=n));const m=K(0);W(s,m,n=>a(4,l=n));const v=K();v.subscribe(n=>{n&&(n.uploaded===n.total?(i.set("Processing..."),m.set(100)):(i.set(`Uploading: ${n.uploaded}/${n.total}`),m.set(n.uploaded/n.total*100)))});const w=xt(),b=mt({query:Ct,client:f,variables:{mod:o}});W(s,b,n=>a(1,e=n));const I=async n=>Tt(n.file,e.data.mod.id,{changelog:n.changelog,stability:n.stability},v,f).then(U=>{w.trigger({message:"Version created",background:"variant-filled-success",timeout:5e3}),lt(ct+"/mod/"+o+"/version/"+U.version.id)}).catch(U=>{console.error(U),w.trigger({message:"Error creating version: "+U.message,background:"variant-filled-error",autohide:!1}),i.set("")}),F=()=>{lt(ct+"/mod/"+o)},P={type:"confirm",title:"Go Back?",buttonTextCancel:"Keep Editing",buttonTextConfirm:"Go Back",body:"Going back will discard any unsaved changes. Are you sure you wish to continue?",response:n=>{n&&F()}},S=yt(),$=()=>S.trigger(P),B=()=>{alert("Failed to update compatibility information, check browser console for more info.")},M=()=>{alert("Mod compatibility data updated. Don't forget to upload the version too!")};return s.$$set=n=>{"data"in n&&a(11,c=n.data)},[x,e,r,p,l,i,m,b,I,P,S,c,$,B,M]}class Jt extends ht{constructor(t){super(),pt(this,t,At,jt,vt,{t:0,data:11})}get t(){return this.$$.ctx[0]}}export{Jt as component,Rt as universal};
//# sourceMappingURL=18.BQdehO57.js.map

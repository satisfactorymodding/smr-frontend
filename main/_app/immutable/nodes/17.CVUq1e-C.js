import{D as mt,S as ht,i as pt,s as vt,b as st,a as _,e as E,P as M,Y as gt,f as u,g as F,c as V,d as D,Q as O,K as tt,A as N,M as y,j as C,N as bt,m as z,t as G,l as nt,R as B,a5 as wt,C as $t,F as J,G as xt,ae as yt,I as Y,J as W,L as X,O as Z,k as it,q as L,r as It,w as Q,a7 as lt,a0 as ct,h as dt}from"../chunks/vendor.C9t1ZX-H.js";import{V as Et}from"../chunks/VersionForm.dXfqzft1.js";import{u as Vt,F as kt,v as Dt,w as Pt,o as Nt}from"../chunks/graphql.CfvMSMJ1.js";import{M as Ct}from"../chunks/MetaDescriptors.DhabOU7J.js";import{E as St}from"../chunks/EditCompatibilityForm.o1A0062k.js";const Tt=async({params:s})=>({...s}),Rt=Object.freeze(Object.defineProperty({__proto__:null,load:Tt},Symbol.toStringTag,{value:"Module"})),_t=async(s,t,a,e,r)=>{const g=Math.ceil(s.size/1e7),p=new Array(g).fill(0).map((i,m)=>m).reverse(),l=(i,m,v)=>r.mutation(Pt,{modId:t,versionId:v,part:m,file:i}).toPromise(),x=10;let c=0,o=0;const f=i=>{if(c>=x||!p.length)return;const m=p.pop(),v=m*1e7,w=s.slice(v,v+1e7);return c+=1,Promise.all([l(w,m+1,i).then(()=>(c-=1,e.set({total:g,uploaded:g-p.length-c}),f(i))).catch(b=>{if(console.error("Upload failed:",b),c-=1,p.push(m),o+=1,o<5)return f(i);throw new Error("Failed uploading after 5 attempts")}),f(i)])};return r.mutation(Vt,{modId:t}).toPromise().then(async i=>(e.set({total:g,uploaded:0}),await f(i.data.createVersion),i.data.createVersion)).then(i=>(console.log("Finalizing",{versionID:i}),r.mutation(kt,{modId:t,versionId:i,version:a}).toPromise().then(()=>new Promise((m,v)=>{let w=0,b=mt({query:Dt,client:r,variables:{modId:t,versionId:i},requestPolicy:"network-only"});const I=setInterval(()=>{if(w==60)return clearInterval(I),v(new Error("Timed out waiting for mod processing"));b.pause(),b.resume(),w++},1e4),S=b.subscribe(P=>{if(!P.fetching){if(P.error){clearInterval(I),v(new Error(P.error.message)),setTimeout(S);return}P.data?.checkVersionUploadState?.version?.id&&(S(),clearInterval(I),m(P.data.checkVersionUploadState))}})})))).catch(i=>{throw console.error(i),i})};function ft(s){let t,a;return t=new Ct({props:{description:"Creating a new version of mod "+s[1].data.mod.name,title:"New version of mod "+s[1].data.mod.name}}),{c(){Y(t.$$.fragment)},l(e){W(t.$$.fragment,e)},m(e,r){X(t,e,r),a=!0},p(e,r){const h={};r&2&&(h.description="Creating a new version of mod "+e[1].data.mod.name),r&2&&(h.title="New version of mod "+e[1].data.mod.name),t.$set(h)},i(e){a||(z(t.$$.fragment,e),a=!0)},o(e){G(t.$$.fragment,e),a=!1},d(e){Z(t,e)}}}function Ft(s){let t=s[1].data.mod.name+"",a;return{c(){a=M(t)},l(e){a=O(e,t)},m(e,r){C(e,a,r)},p(e,r){r&2&&t!==(t=e[1].data.mod.name+"")&&B(a,t)},d(e){e&&u(a)}}}function Mt(s){let t;return{c(){t=M("...")},l(a){t=O(a,"...")},m(a,e){C(a,t,e)},p:L,d(a){a&&u(t)}}}function Ot(s){let t,a,e,r,h="<span>Edit Compatibility Info</span>",g,p,l,x;t=new Et({props:{onSubmit:s[8],modReference:s[1].data.mod.mod_reference,submitIcon:"add_circle"}});let c=s[3]&&ut(s);return l=new St({props:{mod:s[1].data.mod,modId:s[1].data.mod.id}}),l.$on("fail",s[13]),l.$on("submit",s[14]),{c(){Y(t.$$.fragment),a=_(),c&&c.c(),e=_(),r=E("div"),r.innerHTML=h,g=_(),p=E("div"),Y(l.$$.fragment),this.h()},l(o){W(t.$$.fragment,o),a=F(o),c&&c.l(o),e=F(o),r=V(o,"DIV",{class:!0,"data-svelte-h":!0}),tt(r)!=="svelte-uk6ytd"&&(r.innerHTML=h),g=F(o),p=V(o,"DIV",{class:!0});var f=D(p);W(l.$$.fragment,f),f.forEach(u),this.h()},h(){N(r,"class","p-4"),N(p,"class","card p-4")},m(o,f){X(t,o,f),C(o,a,f),c&&c.m(o,f),C(o,e,f),C(o,r,f),C(o,g,f),C(o,p,f),X(l,p,null),x=!0},p(o,f){const i={};f&2&&(i.modReference=o[1].data.mod.mod_reference),t.$set(i),o[3]?c?c.p(o,f):(c=ut(o),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null);const m={};f&2&&(m.mod=o[1].data.mod),f&2&&(m.modId=o[1].data.mod.id),l.$set(m)},i(o){x||(z(t.$$.fragment,o),z(l.$$.fragment,o),x=!0)},o(o){G(t.$$.fragment,o),G(l.$$.fragment,o),x=!1},d(o){o&&(u(a),u(e),u(r),u(g),u(p)),Z(t,o),c&&c.d(o),Z(l)}}}function jt(s){let t,a,e=s[1].error.message+"",r;return{c(){t=E("p"),a=M("Oh no... "),r=M(e)},l(h){t=V(h,"P",{});var g=D(t);a=O(g,"Oh no... "),r=O(g,e),g.forEach(u)},m(h,g){C(h,t,g),y(t,a),y(t,r)},p(h,g){g&2&&e!==(e=h[1].error.message+"")&&B(r,e)},i:L,o:L,d(h){h&&u(t)}}}function qt(s){let t,a="Loading...";return{c(){t=E("p"),t.textContent=a},l(e){t=V(e,"P",{"data-svelte-h":!0}),tt(t)!=="svelte-qdsr2u"&&(t.textContent=a)},m(e,r){C(e,t,r)},p:L,i:L,o:L,d(e){e&&u(t)}}}function ut(s){let t,a,e,r,h,g,p,l,x=s[4].toFixed(0)+"",c,o,f,i,m;return{c(){t=E("div"),a=E("div"),e=E("div"),r=E("span"),h=M(s[3]),g=_(),p=E("div"),l=E("span"),c=M(x),o=M("%"),f=_(),i=E("div"),m=E("div"),this.h()},l(v){t=V(v,"DIV",{class:!0});var w=D(t);a=V(w,"DIV",{class:!0});var b=D(a);e=V(b,"DIV",{});var I=D(e);r=V(I,"SPAN",{class:!0});var S=D(r);h=O(S,s[3]),S.forEach(u),I.forEach(u),g=F(b),p=V(b,"DIV",{class:!0});var P=D(p);l=V(P,"SPAN",{class:!0});var T=D(l);c=O(T,x),o=O(T,"%"),T.forEach(u),P.forEach(u),b.forEach(u),f=F(w),i=V(w,"DIV",{class:!0});var $=D(i);m=V($,"DIV",{style:!0,class:!0}),D(m).forEach(u),$.forEach(u),w.forEach(u),this.h()},h(){N(r,"class","inline-block rounded-full bg-yellow-600 px-2 py-1 text-xs font-semibold uppercase text-white"),N(l,"class","inline-block text-xs font-semibold text-white"),N(p,"class","text-right"),N(a,"class","mb-2 flex items-center justify-between"),dt(m,"width",s[4].toFixed(0)+"%"),N(m,"class","flex flex-col justify-center whitespace-nowrap bg-yellow-600 text-center text-white shadow-none"),N(i,"class","mb-4 flex h-2 overflow-hidden rounded bg-neutral-600 text-xs"),N(t,"class","relative pt-4")},m(v,w){C(v,t,w),y(t,a),y(a,e),y(e,r),y(r,h),y(a,g),y(a,p),y(p,l),y(l,c),y(l,o),y(t,f),y(t,i),y(i,m)},p(v,w){w&8&&B(h,v[3]),w&16&&x!==(x=v[4].toFixed(0)+"")&&B(c,x),w&16&&dt(m,"width",v[4].toFixed(0)+"%")},d(v){v&&u(t)}}}function At(s){let t,a,e,r,h,g,p,l,x,c="arrow_back",o,f=s[2]("version.back")+"",i,m,v,w,b,I,S,P,T,$=!s[1].fetching&&!s[1].error&&s[1].data.mod&&ft(s);function H(d,k){if(d[1].fetching)return Mt;if(!d[1].error)return Ft}let j=H(s),n=j&&j(s);const U=[qt,jt,Ot],q=[];function et(d,k){return d[1].fetching?0:d[1].error?1:2}return b=et(s),I=q[b]=U[b](s),{c(){$&&$.c(),t=st(),a=_(),e=E("div"),r=E("h1"),h=M(`New Version for
    `),n&&n.c(),g=_(),p=E("div"),l=E("button"),x=E("span"),x.textContent=c,o=_(),i=M(f),m=_(),v=E("div"),w=E("section"),I.c(),this.h()},l(d){const k=gt("svelte-nx2zao",document.head);$&&$.l(k),t=st(),k.forEach(u),a=F(d),e=V(d,"DIV",{class:!0});var A=D(e);r=V(A,"H1",{class:!0});var K=D(r);h=O(K,`New Version for
    `),n&&n.l(K),K.forEach(u),g=F(A),p=V(A,"DIV",{});var at=D(p);l=V(at,"BUTTON",{class:!0,title:!0});var R=D(l);x=V(R,"SPAN",{class:!0,"data-svelte-h":!0}),tt(x)!=="svelte-qua3zr"&&(x.textContent=c),o=F(R),i=O(R,f),R.forEach(u),at.forEach(u),A.forEach(u),m=F(d),v=V(d,"DIV",{class:!0});var rt=D(v);w=V(rt,"SECTION",{});var ot=D(w);I.l(ot),ot.forEach(u),rt.forEach(u),this.h()},h(){N(r,"class","my-4 text-4xl font-bold"),N(x,"class","material-icons pr-2"),N(l,"class","variant-ghost-primary btn"),N(l,"title","View the description page for this mod"),N(e,"class","flex h-auto flex-wrap items-center justify-between"),N(v,"class","card p-4")},m(d,k){$&&$.m(document.head,null),y(document.head,t),C(d,a,k),C(d,e,k),y(e,r),y(r,h),n&&n.m(r,null),y(e,g),y(e,p),y(p,l),y(l,x),y(l,o),y(l,i),C(d,m,k),C(d,v,k),y(v,w),q[b].m(w,null),S=!0,P||(T=bt(l,"click",s[12]),P=!0)},p(d,[k]){!d[1].fetching&&!d[1].error&&d[1].data.mod?$?($.p(d,k),k&2&&z($,1)):($=ft(d),$.c(),z($,1),$.m(t.parentNode,t)):$&&(it(),G($,1,1,()=>{$=null}),nt()),j===(j=H(d))&&n?n.p(d,k):(n&&n.d(1),n=j&&j(d),n&&(n.c(),n.m(r,null))),(!S||k&4)&&f!==(f=d[2]("version.back")+"")&&B(i,f);let A=b;b=et(d),b===A?q[b].p(d,k):(it(),G(q[A],1,1,()=>{q[A]=null}),nt(),I=q[b],I?I.p(d,k):(I=q[b]=U[b](d),I.c()),z(I,1),I.m(w,null))},i(d){S||(z($),z(I),S=!0)},o(d){G($),G(I),S=!1},d(d){d&&(u(a),u(e),u(m),u(v)),$&&$.d(d),u(t),n&&n.d(),q[b].d(),P=!1,T()}}}function zt(s,t,a){let e,r,h=L,g=()=>(h(),h=It(x,n=>a(2,r=n)),x),p,l;s.$$.on_destroy.push(()=>h());const{t:x}=wt();g();let{data:c}=t;const{modId:o}=c,f=$t(),i=Q("");J(s,i,n=>a(3,p=n));const m=Q(0);J(s,m,n=>a(4,l=n));const v=Q();v.subscribe(n=>{n&&(n.uploaded===n.total?(i.set("Processing..."),m.set(100)):(i.set(`Uploading: ${n.uploaded}/${n.total}`),m.set(n.uploaded/n.total*100)))});const w=xt(),b=mt({query:Nt,client:f,variables:{mod:o}});J(s,b,n=>a(1,e=n));const I=async n=>_t(n.file,e.data.mod.id,{changelog:n.changelog,stability:n.stability},v,f).then(U=>{w.trigger({message:"Version created",background:"variant-filled-success",timeout:5e3}),lt(ct+"/mod/"+o+"/version/"+U.version.id)}).catch(U=>{console.error(U),w.trigger({message:"Error creating version: "+U.message,background:"variant-filled-error",autohide:!1}),i.set("")}),S=()=>{lt(ct+"/mod/"+o)},P={type:"confirm",title:"Go Back?",buttonTextCancel:"Keep Editing",buttonTextConfirm:"Go Back",body:"Going back will discard any unsaved changes. Are you sure you wish to continue?",response:n=>{n&&S()}},T=yt(),$=()=>T.trigger(P),H=()=>{alert("Failed to update compatibility information, check browser console for more info.")},j=()=>{alert("Mod compatibility data updated. Don't forget to upload the version too!")};return s.$$set=n=>{"data"in n&&a(11,c=n.data)},[x,e,r,p,l,i,m,b,I,P,T,c,$,H,j]}class Kt extends ht{constructor(t){super(),pt(this,t,zt,At,vt,{t:0,data:11})}get t(){return this.$$.ctx[0]}}export{Kt as component,Rt as universal};
//# sourceMappingURL=17.CVUq1e-C.js.map

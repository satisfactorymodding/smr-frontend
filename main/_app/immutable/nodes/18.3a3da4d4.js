import{aF as K,S as Z,i as Q,s as W,bh as tt,p as et,P as rt,e as j,R as z,u as E,I as S,U as q,a_ as at,d as $,V as U,v as P,w as V,J as _,X as A,Y as F,Z as y,a as I,_ as O,b as N,t as D,c as X,a4 as nt,a5 as T,aD as ot,a8 as L,a9 as C,bi as st,g as Y,L as k,ar as it,aG as lt,aN as ft,K as M,aq as B}from"../chunks/vendor.96815c21.js";import{T as ct}from"../chunks/Toast.3173ee9a.js";import{V as dt}from"../chunks/VersionForm.853c8d4e.js";import{z as ut,F as mt,B as pt,H as $t,I as ht}from"../chunks/graphql.22d32a05.js";import{M as gt}from"../chunks/MetaDescriptors.e9d71f4a.js";const vt=async({params:s})=>({...s}),jt=Object.freeze(Object.defineProperty({__proto__:null,load:vt},Symbol.toStringTag,{value:"Module"})),wt=async(s,t,r,e,a)=>{const n=Math.ceil(s.size/1e7),m=new Array(n).fill(0).map((c,f)=>f).reverse(),l=(c,f,v)=>a.mutation($t,{modId:t,versionId:v,part:f,file:c}).toPromise(),w=10;let g=0,u=0;const b=c=>{if(g>=w||!m.length)return;const f=m.pop(),v=f*1e7,h=s.slice(v,v+1e7);return g+=1,Promise.all([l(h,f+1,c).then(()=>(g-=1,e.set({total:n,uploaded:n-m.length-g}),b(c))).catch(o=>{if(console.error("Upload failed:",o),g-=1,m.push(f),u+=1,u<5)return b(c);throw new Error("Failed uploading after 5 attempts")}),b(c)])};return a.mutation(ut,{modId:t}).toPromise().then(async c=>(e.set({total:n,uploaded:0}),await b(c.data.createVersion),c.data.createVersion)).then(c=>(console.log("Finalizing",{versionID:c}),a.mutation(mt,{modId:t,versionId:c,version:r}).toPromise().then(()=>new Promise((f,v)=>{let h=0,o=K({query:pt,client:a,variables:{modId:t,versionId:c},requestPolicy:"network-only"});const p=setInterval(()=>{if(h==60)return clearInterval(p),v(new Error("Timed out waiting for mod processing"));o.pause(),o.resume(),h++},1e4),d=o.subscribe(x=>{if(!x.fetching){if(x.error){clearInterval(p),v(new Error(x.error.message)),setTimeout(d);return}x.data?.checkVersionUploadState?.version?.id&&(d(),clearInterval(p),f(x.data.checkVersionUploadState))}})})))).catch(c=>{throw console.error(c),c})};function G(s){let t,r;return t=new gt({props:{description:"Creating a new version of mod "+s[3].data.mod.name,title:"New version of mod "+s[3].data.mod.name}}),{c(){q(t.$$.fragment)},l(e){A(t.$$.fragment,e)},m(e,a){O(t,e,a),r=!0},p(e,a){const i={};a&8&&(i.description="Creating a new version of mod "+e[3].data.mod.name),a&8&&(i.title="New version of mod "+e[3].data.mod.name),t.$set(i)},i(e){r||(N(t.$$.fragment,e),r=!0)},o(e){D(t.$$.fragment,e),r=!1},d(e){T(t,e)}}}function xt(s){let t=s[3].data.mod.name+"",r;return{c(){r=S(t)},l(e){r=_(e,t)},m(e,a){I(e,r,a)},p(e,a){a&8&&t!==(t=e[3].data.mod.name+"")&&M(r,t)},d(e){e&&$(r)}}}function yt(s){let t;return{c(){t=S("...")},l(r){t=_(r,"...")},m(r,e){I(r,t,e)},p:k,d(r){r&&$(t)}}}function bt(s){let t,r,e,a;t=new dt({props:{onSubmit:s[8],modReference:s[3].data.mod.mod_reference}});let i=s[4]&&J(s);return{c(){q(t.$$.fragment),r=z(),i&&i.c(),e=j()},l(n){A(t.$$.fragment,n),r=U(n),i&&i.l(n),e=j()},m(n,m){O(t,n,m),I(n,r,m),i&&i.m(n,m),I(n,e,m),a=!0},p(n,m){const l={};m&8&&(l.modReference=n[3].data.mod.mod_reference),t.$set(l),n[4]?i?i.p(n,m):(i=J(n),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i(n){a||(N(t.$$.fragment,n),a=!0)},o(n){D(t.$$.fragment,n),a=!1},d(n){T(t,n),n&&$(r),i&&i.d(n),n&&$(e)}}}function It(s){let t,r,e=s[3].error.message+"",a;return{c(){t=E("p"),r=S("Oh no... "),a=S(e)},l(i){t=P(i,"P",{});var n=V(t);r=_(n,"Oh no... "),a=_(n,e),n.forEach($)},m(i,n){I(i,t,n),y(t,r),y(t,a)},p(i,n){n&8&&e!==(e=i[3].error.message+"")&&M(a,e)},i:k,o:k,d(i){i&&$(t)}}}function Et(s){let t,r;return{c(){t=E("p"),r=S("Loading...")},l(e){t=P(e,"P",{});var a=V(t);r=_(a,"Loading..."),a.forEach($)},m(e,a){I(e,t,a),y(t,r)},p:k,i:k,o:k,d(e){e&&$(t)}}}function J(s){let t,r,e,a,i,n,m,l,w=s[5].toFixed(0)+"",g,u,b,c,f;return{c(){t=E("div"),r=E("div"),e=E("div"),a=E("span"),i=S(s[4]),n=z(),m=E("div"),l=E("span"),g=S(w),u=S("%"),b=z(),c=E("div"),f=E("div"),this.h()},l(v){t=P(v,"DIV",{class:!0});var h=V(t);r=P(h,"DIV",{class:!0});var o=V(r);e=P(o,"DIV",{});var p=V(e);a=P(p,"SPAN",{class:!0});var d=V(a);i=_(d,s[4]),d.forEach($),p.forEach($),n=U(o),m=P(o,"DIV",{class:!0});var x=V(m);l=P(x,"SPAN",{class:!0});var H=V(l);g=_(H,w),u=_(H,"%"),H.forEach($),x.forEach($),o.forEach($),b=U(h),c=P(h,"DIV",{class:!0});var R=V(c);f=P(R,"DIV",{style:!0,class:!0}),V(f).forEach($),R.forEach($),h.forEach($),this.h()},h(){F(a,"class","text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-white bg-yellow-600"),F(l,"class","text-xs font-semibold inline-block text-white"),F(m,"class","text-right"),F(r,"class","flex mb-2 items-center justify-between"),B(f,"width",s[5].toFixed(0)+"%"),F(f,"class","shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-yellow-600"),F(c,"class","overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-600"),F(t,"class","relative pt-4")},m(v,h){I(v,t,h),y(t,r),y(r,e),y(e,a),y(a,i),y(r,n),y(r,m),y(m,l),y(l,g),y(l,u),y(t,b),y(t,c),y(c,f)},p(v,h){h&16&&M(i,v[4]),h&32&&w!==(w=v[5].toFixed(0)+"")&&M(g,w),h&32&&B(f,"width",v[5].toFixed(0)+"%")},d(v){v&&$(t)}}}function Pt(s){let t,r,e,a;const i=[Et,It,bt],n=[];function m(l,w){return l[3].fetching?0:l[3].error?1:2}return t=m(s),r=n[t]=i[t](s),{c(){r.c(),e=j()},l(l){r.l(l),e=j()},m(l,w){n[t].m(l,w),I(l,e,w),a=!0},p(l,w){let g=t;t=m(l),t===g?n[t].p(l,w):(Y(),D(n[g],1,1,()=>{n[g]=null}),X(),r=n[t],r?r.p(l,w):(r=n[t]=i[t](l),r.c()),N(r,1),r.m(e.parentNode,e))},i(l){a||(N(r),a=!0)},o(l){D(r),a=!1},d(l){n[t].d(l),l&&$(e)}}}function Vt(s){let t,r;return t=new st({props:{$$slots:{default:[Pt]},$$scope:{ctx:s}}}),{c(){q(t.$$.fragment)},l(e){A(t.$$.fragment,e)},m(e,a){O(t,e,a),r=!0},p(e,a){const i={};a&16440&&(i.$$scope={dirty:a,ctx:e}),t.$set(i)},i(e){r||(N(t.$$.fragment,e),r=!0)},o(e){D(t.$$.fragment,e),r=!1},d(e){T(t,e)}}}function Nt(s){let t,r;return{c(){t=E("span"),r=S(s[1])},l(e){t=P(e,"SPAN",{});var a=V(t);r=_(a,s[1]),a.forEach($)},m(e,a){I(e,t,a),y(t,r)},p(e,a){a&2&&M(r,e[1])},d(e){e&&$(t)}}}function St(s){let t,r,e,a,i,n,m,l,w,g,u=!s[3].fetching&&!s[3].error&&s[3].data.mod&&G(s);function b(o,p){if(o[3].fetching)return yt;if(!o[3].error)return xt}let c=b(s),f=c&&c(s);n=new tt({props:{$$slots:{default:[Vt]},$$scope:{ctx:s}}});function v(o){s[11](o)}let h={$$slots:{default:[Nt]},$$scope:{ctx:s}};return s[0]!==void 0&&(h.running=s[0]),l=new ct({props:h}),et.push(()=>rt(l,"running",v)),{c(){u&&u.c(),t=j(),r=z(),e=E("h1"),a=S(`New Version for
  `),f&&f.c(),i=z(),q(n.$$.fragment),m=z(),q(l.$$.fragment),this.h()},l(o){const p=at("svelte-nx2zao",document.head);u&&u.l(p),t=j(),p.forEach($),r=U(o),e=P(o,"H1",{class:!0});var d=V(e);a=_(d,`New Version for
  `),f&&f.l(d),d.forEach($),i=U(o),A(n.$$.fragment,o),m=U(o),A(l.$$.fragment,o),this.h()},h(){F(e,"class","text-4xl my-4 font-bold")},m(o,p){u&&u.m(document.head,null),y(document.head,t),I(o,r,p),I(o,e,p),y(e,a),f&&f.m(e,null),I(o,i,p),O(n,o,p),I(o,m,p),O(l,o,p),g=!0},p(o,[p]){!o[3].fetching&&!o[3].error&&o[3].data.mod?u?(u.p(o,p),p&8&&N(u,1)):(u=G(o),u.c(),N(u,1),u.m(t.parentNode,t)):u&&(Y(),D(u,1,1,()=>{u=null}),X()),c===(c=b(o))&&f?f.p(o,p):(f&&f.d(1),f=c&&c(o),f&&(f.c(),f.m(e,null)));const d={};p&16440&&(d.$$scope={dirty:p,ctx:o}),n.$set(d);const x={};p&16386&&(x.$$scope={dirty:p,ctx:o}),!w&&p&1&&(w=!0,x.running=o[0],nt(()=>w=!1)),l.$set(x)},i(o){g||(N(u),N(n.$$.fragment,o),N(l.$$.fragment,o),g=!0)},o(o){D(u),D(n.$$.fragment,o),D(l.$$.fragment,o),g=!1},d(o){u&&u.d(o),$(t),o&&$(r),o&&$(e),f&&f.d(),o&&$(i),T(n,o),o&&$(m),T(l,o)}}}function _t(s,t,r){let e,a,i,n=k,m=()=>(n(),n=it(a,d=>r(3,i=d)),a),l,w;s.$$.on_destroy.push(()=>n());let{data:g}=t;const u=ot(),b=L("");C(s,b,d=>r(4,l=d));const c=L(0);C(s,c,d=>r(5,w=d));const f=L();f.subscribe(d=>{d&&(d.uploaded===d.total?(b.set("Processing..."),c.set(100)):(b.set(`Uploading: ${d.uploaded}/${d.total}`),c.set(d.uploaded/d.total*100)))});let v="",h=!1;const o=async d=>wt(d.file,i.data.mod.id,{changelog:d.changelog,stability:d.stability},f,u).then(x=>{console.log({success:x}),lt(ft+"/mod/"+e+"/version/"+x.version.id)}).catch(x=>{console.error(x),r(1,v="Error creating version: "+x.message),r(0,h=!0),b.set("")});function p(d){h=d,r(0,h)}return s.$$set=d=>{"data"in d&&r(9,g=d.data)},s.$$.update=()=>{s.$$.dirty&512&&r(10,{modId:e}=g,e),s.$$.dirty&1024&&m(r(2,a=K({query:ht,client:u,variables:{mod:e}}))),s.$$.dirty&1&&(h||r(1,v=""))},[h,v,a,i,l,w,b,c,o,g,e,p]}class qt extends Z{constructor(t){super(),Q(this,t,_t,St,W,{data:9})}}export{qt as component,jt as universal};
//# sourceMappingURL=18.3a3da4d4.js.map

{"version":3,"file":"17.349e39eb.js","sources":["../../../../../../src/routes/mod/[modId]/edit/+page.ts","../../../../../../src/routes/mod/[modId]/edit/+page.svelte"],"sourcesContent":["import type { PageLoad } from './$types';\n\nexport const load: PageLoad = async ({ params }) => ({\n  ...params\n});\n","<script lang=\"ts\">\n  import { getContextClient, queryStore } from '@urql/svelte';\n  import { EditModDocument, GetModDocument } from '$lib/generated';\n  import Toast from '$lib/components/general/Toast.svelte';\n  import { goto } from '$app/navigation';\n  import ModForm from '$lib/components/mods/ModForm.svelte';\n  import type { ModData } from '$lib/models/mods';\n  import { base } from '$app/paths';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n  import Card, { Content } from '@smui/card';\n  import type { PageData } from './$types';\n\n  export let data: PageData;\n\n  $: ({ modId } = data);\n\n  const client = getContextClient();\n\n  let errorMessage = '';\n  let errorToast = false;\n\n  $: mod = queryStore({\n    query: GetModDocument,\n    client,\n    variables: { mod: modId }\n  });\n\n  const onSubmit = (modData: ModData) => {\n    client\n      .mutation(EditModDocument, {\n        modId: $mod.data.mod.id,\n        mod: modData\n      })\n      .toPromise()\n      .then((value) => {\n        if (value.error) {\n          console.error(value.error.message);\n          errorMessage = 'Error editing mod: ' + value.error.message;\n          errorToast = true;\n        } else {\n          // TODO Toast or something\n          goto(base + '/mod/' + value.data.updateMod.id);\n        }\n      });\n  };\n\n  $: if (!errorToast) {\n    errorMessage = '';\n  }\n\n  $: initialValues = $mod.data\n    ? {\n        ...$mod.data.mod,\n        logo: undefined\n      }\n    : undefined;\n</script>\n\n<svelte:head>\n  {#if !$mod.fetching && !$mod.error && $mod.data.mod}\n    <MetaDescriptors\n      description=\"Editing mod {$mod.data.mod.name}\"\n      title=\"Edit mod {$mod.data.mod.name}\"\n      image={$mod.data.mod.logo} />\n  {/if}\n</svelte:head>\n\n<h1 class=\"text-4xl my-4 font-bold\">Edit Mod</h1>\n\n<Card>\n  <Content>\n    {#if $mod.fetching}\n      <p>Loading...</p>\n    {:else if $mod.error}\n      <p>Oh no... {$mod.error.message}</p>\n    {:else}\n      <ModForm {onSubmit} {initialValues} editing={true} submitText=\"Save\" />\n    {/if}\n  </Content>\n</Card>\n\n<Toast bind:running={errorToast}>\n  <span>{errorMessage}</span>\n</Toast>\n"],"names":["load","async","params","t","description","ctx","data","mod","name","title","image","logo","dirty","metadescriptors_changes","error","message","insert_hydration","target","p","anchor","set_data","t1","t1_value","fetching","span","create_if_block_2","h1","$$props","client","getContextClient","errorMessage","errorToast","onSubmit","modData","mutation","EditModDocument","modId","$mod","id","toPromise","then","value","console","$$invalidate","goto","base","updateMod","$$subscribe_mod","queryStore","query","GetModDocument","variables","initialValues","undefined"],"mappings":"2gBAEO,MAAMA,GAAiBC,OAASC,OAAcC,CAAA,KAAA,CAAA,GAChDD,wJC0D2BE,YAAA,eAAAC,EAAK,CAAA,EAAAC,KAAKC,IAAIC,KACvBC,MAAA,YAAAJ,EAAK,CAAAC,EAAAA,KAAKC,IAAIC,KACxBE,MAAAL,EAAK,CAAAC,EAAAA,KAAKC,IAAII,IAAAA,CAAAA,CAAAA,0FAFKC,EAAA,IAAAC,EAAAT,YAAA,eAAAC,EAAK,CAAAC,EAAAA,KAAKC,IAAIC,MACvBI,EAAA,IAAAC,EAAAJ,MAAA,YAAAJ,EAAK,CAAAC,EAAAA,KAAKC,IAAIC,MACxBI,EAAA,IAAAC,EAAAH,MAAAL,EAAK,GAAAC,KAAKC,IAAII,wLAawB,+PAFhCN,EAAI,GAACS,MAAMC,QAAO,6BAA5B,yDAAA,2CAAHC,EAAmCC,EAAAC,EAAAC,CAAAA,oCAAtBd,EAAI,CAAA,EAACS,MAAMC,QAAO,KAAAK,EAAAC,EAAAC,0EAF5B,mDAAA,YAAA,uBAAHN,EAAgBC,EAAAC,EAAAC,yGADb,OAAAd,KAAKkB,SAAQ,EAERlB,KAAKS,MAAK,ypBASfT,EAAY,CAAA,CAAA,0CAAZA,EAAY,yBAAnBW,EAA0BC,EAAAO,EAAAL,2BAAnBd,EAAY,8DAvBbA,EAAI,CAACkB,EAAAA,UAAAA,CAAalB,EAAI,CAAA,EAACS,OAAST,EAAI,CAAA,EAACC,KAAKC,KAAGkB,EAAApB,yIAsBhCA,EAAU,CAAA,IAAA,mBAAVA,EAAU,6FAdK,8LAAA,iMAApCW,EAAgDC,EAAAS,EAAAP,8DARxCd,EAAI,CAACkB,EAAAA,UAAAA,CAAalB,EAAI,CAAA,EAACS,OAAST,EAAI,CAAA,EAACC,KAAKC,2OAsB7BF,EAAU,2TArElBC,CAAcqB,EAAAA,EAInB,MAAAC,EAASC,IAEX,IAAAC,EAAe,GACfC,EAAa,GAQX,MAAAC,EAAYC,GAChBL,CAAAA,EACGM,SAASC,IACRC,MAAOC,EAAK/B,KAAKC,IAAI+B,GACrB/B,IAAK0B,CAENM,CAAAA,EAAAA,UAAAA,EACAC,KAAMC,GACD,CAAAA,EAAM3B,OACR4B,QAAQ5B,MAAM2B,EAAM3B,MAAMC,OAAAA,EAC1B4B,EAAA,EAAAb,EAAe,sBAAwBW,EAAM3B,MAAMC,SACnD4B,EAAA,EAAAZ,EAAa,EAAA,GAGba,EAAKC,GAAO,QAAUJ,EAAMnC,KAAKwC,UAAUR,EAAAA,mBAwChCP,EAAUU,uFAnE5BE,EAAA,EAAKP,CAAAA,MAAAA,CAAAA,EAAU9B,EAAI8B,mBAOnBW,EAAAJ,EAAA,EAAEpC,EAAMyC,EAAU,CACjBC,MAAOC,GACPtB,SACAuB,UAAS,CAAI5C,IAAK6B,CAAAA,CAAAA,CAAAA,CAAAA,CAAAA,iBAsBZL,GACNY,EAAA,EAAAb,EAAe,EAAA,iBAGda,EAAA,EAAAS,EAAgBf,EAAK/B,KAEf,CAAA,GAAA+B,EAAK/B,KAAKC,IACbI,KAAM0C,MAAAA,EAERA"}
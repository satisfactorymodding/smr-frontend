{"version":3,"file":"custom_protocol-0f2aaaf6.js","sources":["../../../../../src/lib/utils/custom_protocol.ts"],"sourcesContent":["/* eslint-disable */\n\nconst browser = {\n  getUserAgent: function () {\n    return window.navigator.userAgent;\n  },\n\n  userAgentContains: function (browserName) {\n    browserName = browserName.toLowerCase();\n    return this.getUserAgent().toLowerCase().indexOf(browserName) > -1;\n  },\n\n  isOSX: function () {\n    return this.userAgentContains('Macintosh');\n  },\n\n  isFirefox: function () {\n    return this.userAgentContains('firefox');\n  },\n\n  isInternetExplorer: function () {\n    return this.userAgentContains('trident');\n  },\n  /**\n   * Detects IE 11 and older\n   * @return {Boolean} Returns true when IE 11 and older\n   */\n  isIE: function () {\n    const ua = this.getUserAgent().toLowerCase();\n\n    // Test values.\n    // Uncomment to check result\n\n    // IE 10\n    // ua = 'Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; Trident/6.0)';\n\n    // IE 11\n    // ua = 'Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko/20100101 Firefox/12.0';\n\n    const msie = ua.indexOf('msie');\n    if (msie > 0) {\n      // IE 10 or older\n      return true;\n    }\n\n    const trident = ua.indexOf('trident/');\n    if (trident > 0) {\n      // IE 11\n      return true;\n    }\n\n    // other browser\n    return false;\n  },\n\n  isEdge: function () {\n    const ua = this.getUserAgent().toLowerCase();\n\n    // Test values.\n    // Uncomment to check result\n\n    // Edge\n    // ua = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.135 Safari/537.36 Edge/12.10240';\n\n    const edge = ua.indexOf('edge');\n    if (edge > 0) {\n      return true;\n    }\n\n    return false;\n  },\n\n  isChrome: function () {\n    // IE11 returns undefined for window.chrome\n    // and new Opera 30 outputs true for window.chrome\n    // but needs to check if window.opr is not undefined\n    // and new IE Edge outputs to true for window.chrome\n    // and if not iOS Chrome check\n    // @ts-ignore\n    const isChromium = window.chrome;\n    const winNav = window.navigator;\n    const vendorName = winNav.vendor;\n    // @ts-ignore\n    const isOpera = typeof window.opr !== 'undefined';\n    const isIEedge = winNav.userAgent.indexOf('Edge') > -1;\n    const isIOSChrome = winNav.userAgent.match('CriOS');\n    return (\n      (isChromium !== null &&\n        typeof isChromium !== 'undefined' &&\n        vendorName === 'Google Inc.' &&\n        isOpera === false &&\n        isIEedge === false) ||\n      isIOSChrome\n    );\n  },\n\n  isOpera: function () {\n    return this.userAgentContains(' OPR/');\n  }\n};\n\nlet DEFAULT_CUSTOM_PROTOCOL_FAIL_CALLBACK_TIMEOUT;\n\nconst registerEvent = (target, eventType, cb) => {\n  if (target.addEventListener) {\n    target.addEventListener(eventType, cb);\n    return {\n      remove: function () {\n        target.removeEventListener(eventType, cb);\n      }\n    };\n  } else {\n    target.attachEvent(eventType, cb);\n    return {\n      remove: function () {\n        target.detachEvent(eventType, cb);\n      }\n    };\n  }\n};\n\nconst createHiddenIframe = (target, uri) => {\n  const iframe = document.createElement('iframe');\n  iframe.src = uri;\n  iframe.id = 'hiddenIframe';\n  iframe.style.display = 'none';\n  target.appendChild(iframe);\n\n  return iframe;\n};\n\nconst openUriWithHiddenFrame = (uri, failCb, successCb) => {\n  const timeout = setTimeout(function () {\n    failCb();\n    handler.remove();\n  }, DEFAULT_CUSTOM_PROTOCOL_FAIL_CALLBACK_TIMEOUT);\n\n  let iframe = document.querySelector('#hiddenIframe');\n  if (!iframe) {\n    iframe = createHiddenIframe(document.body, 'about:blank');\n  }\n\n  const onBlur = () => {\n    clearTimeout(timeout);\n    handler.remove();\n    successCb();\n  };\n  const handler = registerEvent(window, 'blur', onBlur);\n\n  // @ts-ignore\n  iframe.contentWindow.location.href = uri;\n};\n\nconst openUriWithTimeoutHack = (uri, failCb, successCb) => {\n  const timeout = setTimeout(function () {\n    failCb();\n    handler.remove();\n  }, DEFAULT_CUSTOM_PROTOCOL_FAIL_CALLBACK_TIMEOUT);\n\n  //handle page running in an iframe (blur must be registered with top level window)\n  let target = window;\n  while (target.parent && target != target.parent) {\n    // @ts-ignore\n    target = target.parent;\n  }\n\n  const onBlur = () => {\n    clearTimeout(timeout);\n    handler.remove();\n    successCb();\n  };\n\n  const handler = registerEvent(target, 'blur', onBlur);\n\n  window.location.href = uri;\n};\n\nconst openUriUsingFirefox = (uri, failCb, successCb) => {\n  let iframe = document.querySelector('#hiddenIframe');\n\n  if (!iframe) {\n    iframe = createHiddenIframe(document.body, 'about:blank');\n  }\n\n  try {\n    // @ts-ignore\n    iframe.contentWindow.location.href = uri;\n    successCb();\n  } catch (e) {\n    if (e.name == 'NS_ERROR_UNKNOWN_PROTOCOL') {\n      failCb();\n    }\n  }\n};\n\nconst openUriWithMsLaunchUri = (uri, failCb, successCb) => {\n  // @ts-ignore\n  navigator.msLaunchUri(uri, successCb, failCb);\n};\n\nconst getBrowserVersion = () => {\n  const ua = window.navigator.userAgent;\n  let tem,\n    M = ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\\/))\\/?\\s*(\\d+)/i) || [];\n  if (/trident/i.test(M[1])) {\n    tem = /\\brv[ :]+(\\d+)/g.exec(ua) || [];\n    return parseFloat(tem[1]) || '';\n  }\n  if (M[1] === 'Chrome') {\n    tem = ua.match(/\\b(OPR|Edge)\\/(\\d+)/);\n    if (tem != null) {\n      return parseFloat(tem[2]);\n    }\n  }\n  M = M[2] ? [M[1], M[2]] : [window.navigator.appName, window.navigator.appVersion, '-?'];\n  if ((tem = ua.match(/version\\/(\\d+)/i)) != null) M.splice(1, 1, tem[1]);\n  return parseFloat(M[1]);\n};\n\nexport const protocolCheck = (uri, failCb, successCb, timeout = 2000, unsupportedCb) => {\n  const failCallback = () => {\n    failCb && failCb();\n  };\n\n  const successCallback = () => {\n    successCb && successCb();\n  };\n\n  const unsupportedCallback = () => {\n    unsupportedCb && unsupportedCb();\n  };\n\n  const openUri = () => {\n    if (browser.isFirefox()) {\n      const browserVersion = getBrowserVersion();\n      if (browserVersion >= 64) {\n        openUriWithHiddenFrame(uri, failCallback, successCallback);\n      } else {\n        openUriUsingFirefox(uri, failCallback, successCallback);\n      }\n    } else if (browser.isChrome()) {\n      openUriWithTimeoutHack(uri, failCallback, successCallback);\n    } else if (browser.isOSX()) {\n      openUriWithHiddenFrame(uri, failCallback, successCallback);\n    } else {\n      //not supported, implement please\n      unsupportedCallback();\n    }\n  };\n\n  if (timeout) {\n    DEFAULT_CUSTOM_PROTOCOL_FAIL_CALLBACK_TIMEOUT = timeout;\n  }\n\n  if (browser.isEdge() || browser.isIE()) {\n    //for IE and Edge in Win 8 and Win 10\n    openUriWithMsLaunchUri(uri, failCb, successCb);\n  } else {\n    if (document.hasFocus()) {\n      openUri();\n    } else {\n      const focusHandler = registerEvent(window, 'focus', () => {\n        focusHandler.remove();\n        openUri();\n      });\n    }\n  }\n};\n"],"names":[],"mappings":"AAEA,KAAM,GAAU,CACd,aAAc,UAAY,OACjB,QAAO,UAAU,WAG1B,kBAAmB,SAAU,EAAa,UAC1B,EAAY,cACnB,KAAK,eAAe,cAAc,QAAQ,GAAe,IAGlE,MAAO,UAAY,OACV,MAAK,kBAAkB,cAGhC,UAAW,UAAY,OACd,MAAK,kBAAkB,YAGhC,mBAAoB,UAAY,OACvB,MAAK,kBAAkB,YAMhC,KAAM,UAAY,MACV,GAAK,KAAK,eAAe,oBAY3B,AADS,GAAG,QAAQ,QACb,GAMP,AADY,EAAG,QAAQ,YACb,GAShB,OAAQ,UAAY,OAUd,AADS,AARF,MAAK,eAAe,cAQf,QAAQ,QACb,GAOb,SAAU,UAAY,MAOd,GAAa,OAAO,OACpB,EAAS,OAAO,UAChB,EAAa,EAAO,OAEpB,EAAU,MAAO,QAAO,KAAQ,YAChC,EAAW,EAAO,UAAU,QAAQ,QAAU,GAC9C,EAAc,EAAO,UAAU,MAAM,eAExC,KAAe,MACd,MAAO,IAAe,aACtB,IAAe,eACf,IAAY,IACZ,IAAa,IACf,GAIJ,QAAS,UAAY,OACZ,MAAK,kBAAkB,WAIlC,GAAI,GAEJ,KAAM,GAAgB,CAAC,EAAQ,EAAW,IACpC,EAAO,oBACF,iBAAiB,EAAW,GAC5B,CACL,OAAQ,UAAY,GACX,oBAAoB,EAAW,SAInC,YAAY,EAAW,GACvB,CACL,OAAQ,UAAY,GACX,YAAY,EAAW,MAMhC,EAAqB,CAAC,EAAQ,IAAQ,MACpC,GAAS,SAAS,cAAc,mBAC/B,IAAM,IACN,GAAK,iBACL,MAAM,QAAU,SAChB,YAAY,GAEZ,GAGH,EAAyB,CAAC,EAAK,EAAQ,IAAc,MACnD,GAAU,WAAW,UAAY,OAE7B,UACP,MAEC,GAAS,SAAS,cAAc,iBAC/B,MACM,EAAmB,SAAS,KAAM,qBAQvC,GAAU,EAAc,OAAQ,OALvB,IAAM,cACN,KACL,iBAMH,cAAc,SAAS,KAAO,GAGjC,EAAyB,CAAC,EAAK,EAAQ,IAAc,MACnD,GAAU,WAAW,UAAY,OAE7B,UACP,MAGC,GAAS,YACN,EAAO,QAAU,GAAU,EAAO,UAE9B,EAAO,YASZ,GAAU,EAAc,EAAQ,OANvB,IAAM,cACN,KACL,sBAMH,SAAS,KAAO,GAGnB,EAAsB,CAAC,EAAK,EAAQ,IAAc,IAClD,GAAS,SAAS,cAAc,iBAE/B,MACM,EAAmB,SAAS,KAAM,mBAGzC,GAEK,cAAc,SAAS,KAAO,YAE9B,GACH,EAAE,MAAQ,mCAMZ,EAAyB,CAAC,EAAK,EAAQ,IAAc,WAE/C,YAAY,EAAK,EAAW,IAGlC,EAAoB,IAAM,MACxB,GAAK,OAAO,UAAU,aACxB,GACF,EAAI,EAAG,MAAM,iEAAmE,SAC9E,WAAW,KAAK,EAAE,OACd,kBAAkB,KAAK,IAAO,GAC7B,WAAW,EAAI,KAAO,IAE3B,EAAE,KAAO,aACL,EAAG,MAAM,uBACX,GAAO,MACF,WAAW,EAAI,OAGtB,EAAE,GAAK,CAAC,EAAE,GAAI,EAAE,IAAM,CAAC,OAAO,UAAU,QAAS,OAAO,UAAU,WAAY,SACvE,EAAG,MAAM,qBAAuB,QAAQ,OAAO,EAAG,EAAG,EAAI,IAC7D,WAAW,EAAE,MAGT,EAAgB,CAAC,EAAK,EAAQ,EAAW,EAAU,IAAM,IAAkB,MAChF,GAAe,IAAM,IACf,KAGN,EAAkB,IAAM,IACf,KAGT,EAAsB,IAAM,IACf,KAGb,EAAU,IAAM,CAChB,EAAQ,YAEN,AADmB,KACD,KACG,EAAK,EAAc,KAEtB,EAAK,EAAc,GAEhC,EAAQ,aACM,EAAK,EAAc,GACjC,EAAQ,UACM,EAAK,EAAc,WAO1C,MAC8C,GAG9C,EAAQ,UAAY,EAAQ,SAEP,EAAK,EAAQ,WAEhC,SAAS,mBAEN,MACC,GAAe,EAAc,OAAQ,QAAS,IAAM,GAC3C"}
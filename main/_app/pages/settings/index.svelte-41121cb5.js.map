{"version":3,"file":"index.svelte-41121cb5.js","sources":["../../../../../../src/routes/settings/index.svelte"],"sourcesContent":["<svelte:head>\n  <title>Settings - SMR</title>\n</svelte:head>\n\n<script lang=\"ts\">\n  import {mutation} from '@urql/svelte';\n  import {UpdateUserDocument} from \"$lib/generated\";\n  import Toast from \"$lib/components/general/Toast.svelte\";\n  import {goto} from '$app/navigation';\n  import {createForm} from \"felte\";\n  import {validator} from \"@felte/validator-zod\";\n  import {svelteReporter, ValidationMessage} from \"@felte/reporter-svelte\";\n  import {trimNonSchema} from \"$lib/utils/forms\";\n  import {user} from \"$lib/stores/user\";\n  import * as zod from \"zod\";\n  import type {Form} from \"@felte/core\";\n  import {base} from \"$app/paths\";\n\n  let errorMessage = '';\n  let errorToast = false;\n\n  const updateUser = mutation({\n    query: UpdateUserDocument\n  });\n\n  export const userSchema = zod.object({\n    avatar: zod.optional(zod.any().refine(logo => 'name' in logo && 'size' in logo && 'type' in logo)),\n    username: zod.string().min(3).max(32),\n  });\n\n  let userForm: Form<{ [key: string]: string }>['form'];\n\n  $: {\n    if ($user) {\n      const {form} = createForm({\n        initialValues: {\n          username: $user.username\n        },\n        extend: [validator, svelteReporter],\n        validateSchema: userSchema,\n        onSubmit: (data) => {\n          updateUser({\n            user: trimNonSchema(data, userSchema),\n            userId: $user.id\n          }).then(value => {\n            if (value.error) {\n              console.error(value.error.message);\n              errorMessage = 'Error editing guide: ' + value.error.message;\n              errorToast = true;\n            } else {\n              // TODO Toast or something\n              goto(base + '/user/' + value.data.updateUser.id);\n            }\n          });\n        },\n      });\n\n      userForm = form;\n    }\n  }\n\n  $: if (!errorToast) errorMessage = '';\n</script>\n\n<h1 class=\"text-4xl my-4 font-bold\">Settings</h1>\n\n{#if !userForm}\n  <p>Please log in</p>\n{:else}\n  <form use:userForm>\n    <div class=\"grid grid-flow-row gap-6\">\n      <div class=\"grid grid-flow-row gap-2\">\n        <label for=\"avatar\">Avatar:</label>\n        <input id=\"avatar\" class=\"base-input\" name=\"avatar\" type=\"file\" accept=\"image/png,image/jpeg,image/gif\"\n               placeholder=\"Avatar\">\n        <ValidationMessage for=\"avatar\" let:messages={message}>\n          <span class=\"validation-message\">{message || ''}</span>\n        </ValidationMessage>\n      </div>\n\n      <div class=\"grid grid-flow-row gap-2\">\n        <label for=\"username\">Username:</label>\n        <input id=\"username\" class=\"base-input\" name=\"username\" type=\"text\" placeholder=\"Username\">\n        <ValidationMessage for=\"username\" let:messages={message}>\n          <span class=\"validation-message\">{message || ''}</span>\n        </ValidationMessage>\n      </div>\n\n      <div>\n        <input type=\"submit\" value=\"Save\" class=\"px-4 py-2 rounded text-base bg-blue-500 cursor-pointer\">\n      </div>\n    </div>\n  </form>\n{/if}\n\n<Toast bind:running={errorToast}>\n  <span>{errorMessage}</span>\n</Toast>\n"],"names":["message","ctx","ctx2","errorMessage","errorToast","updateUser","mutation","query","UpdateUserDocument","userSchema","zod.object","avatar","zod.optional","zod.any","refine","logo","username","zod.string","min","max","userForm","$user","form","createForm","initialValues","extend","validator","svelteReporter","validateSchema","onSubmit","user","trimNonSchema","data","userId","id","then","value","error","base"],"mappings":"8yBA2EsDA,wBAAAA,gGAQEA,wBAAAA,0FAX5B,uFASE,+OATF,kOASE,yxCAdzB,sDAAA,iHASkD,mNAAA,+DAQA,mNAAA,iFAY9CC,8CAAAA,4DAAAC,sGA9BHA,mHA6BeD,iBAAAA,iFA/Be,yKAAA,icA+BfC,mNA7EfC,EAAe,GACfC,GAAa,QAEXC,EAAaC,GACjBC,MAAOC,IAGIC,EAAaC,GACxBC,OAAQC,EAAaC,IAAUC,WAAe,SAAUC,GAAQ,SAAUA,GAAQ,SAAUA,KAC5FC,SAAUC,IAAaC,IAAI,GAAGC,IAAI,UAGhCC,4CAGEC,cACKC,GAAQC,GACbC,eACER,SAAUK,EAAML,UAElBS,QAASC,EAAWC,GACpBC,eAAgBnB,EAChBoB,gBAEIC,KAAMC,EAAcC,EAAMvB,GAC1BwB,OAAQZ,EAAMa,KACbC,UACGC,EAAMC,eACAA,MAAMD,EAAMC,MAAMrC,aAC1BG,EAAe,wBAA0BiC,EAAMC,MAAMrC,aACrDI,GAAa,MAGRkC,EAAO,SAAWF,EAAMJ,KAAK3B,WAAW6B,cAMrDd,EAAWE,kBAIPlB,OAAYD,EAAe"}
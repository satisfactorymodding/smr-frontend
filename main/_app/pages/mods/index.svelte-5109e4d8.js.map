{"version":3,"file":"index.svelte-5109e4d8.js","sources":["../../../../../../src/lib/components/mods/ModGrid.svelte","../../../../../../src/routes/mods/index.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { operationStore, query } from '@urql/svelte';\n  import { GetModsDocument, ModFields, Order } from '$lib/generated';\n  import ModCard from './ModCard.svelte';\n  import PageControls from '$lib/components/utils/PageControls.svelte';\n  import { get, writable } from 'svelte/store';\n  import { base } from '$app/paths';\n  import Button from '@smui/button';\n  import { Input } from '@smui/textfield';\n  import Paper from '@smui/paper';\n  import Fab from '@smui/fab';\n  import { Icon } from '@smui/common';\n  import { goto } from '$app/navigation';\n  import { page as storePage } from '$app/stores';\n  import { user } from '$lib/stores/user';\n  import FicsitCard from '$lib/components/general/FicsitCard.svelte';\n  import Select, { Option } from '@smui/select';\n  import { browser } from '$app/env';\n\n  export let colCount: 4 | 5 = 4;\n  export let newMod = false;\n  export let showSearch = false;\n\n  let search = $storePage.url.searchParams.get('q');\n\n  // TODO Selectable\n  const perPage = 40;\n  let order: Order = Order.Desc;\n  let orderBy: ModFields = ModFields.LastVersionDate;\n\n  const mods = operationStore(GetModsDocument, { offset: 0, limit: perPage, search, order, orderBy });\n\n  const page = writable<number>(parseInt($storePage.url.searchParams.get('p'), 10) || 1);\n  let totalMods: number;\n\n  let searchField = search;\n  $: {\n    let changed = false;\n    if ($mods.variables.search !== search) {\n      changed = true;\n      $mods.variables.search = search;\n    }\n\n    if ($mods.variables.order !== order) {\n      changed = true;\n      $mods.variables.order = order;\n    }\n\n    if ($mods.variables.orderBy !== orderBy && orderBy) {\n      changed = true;\n      $mods.variables.orderBy = orderBy;\n    }\n\n    if (changed) {\n      $mods.reexecute();\n    }\n  }\n\n  let timer: number;\n  $: {\n    clearTimeout(timer);\n    timer = setTimeout(() => {\n      if (searchField && searchField.length > 2) {\n        if ((search === '' || search === null) && searchField !== '' && searchField !== null) {\n          orderBy = ModFields.Search;\n          page.set(1);\n        }\n\n        search = searchField;\n      } else if (searchField === '' || searchField === null) {\n        if (orderBy === ModFields.Search || !orderBy) {\n          orderBy = ModFields.LastVersionDate;\n        }\n\n        search = null;\n      }\n    }, 250) as unknown as number;\n  }\n\n  const updateUrl = () => {\n    if (browser) {\n      const params = {};\n\n      params['p'] = get(page);\n\n      if (searchField !== '' && searchField !== null) {\n        params['q'] = searchField;\n      }\n\n      const resultQuery = Object.keys(params)\n        .map((key) => key + '=' + encodeURIComponent(params[key]))\n        .join('&');\n\n      goto(base + '/mods?' + resultQuery);\n    }\n  };\n\n  page.subscribe((p) => {\n    $mods.variables.offset = (p - 1) * perPage;\n    $mods.reexecute();\n    updateUrl();\n  });\n\n  $: totalMods = $mods?.data?.getMods?.count || 0;\n\n  query(mods);\n\n  $: gridClasses =\n    colCount == 4\n      ? '3xl:grid-cols-4 2xl:grid-cols-3 lg:grid-cols-2 grid-cols-1'\n      : '3xl:grid-cols-3 2xl:grid-cols-2 grid-cols-1';\n\n  const handleKeyDown = (event: CustomEvent | KeyboardEvent) => {\n    if ((event as KeyboardEvent).key === 'Enter') {\n      updateUrl();\n    }\n  };\n\n  $: orderFields = [\n    ['Name', 'name'],\n    ['Views', 'views'],\n    ['Downloads', 'downloads'],\n    ['Hotness (Views)', 'hotness'],\n    ['Popularity (Downloads)', 'popularity'],\n    ['Creation Date', 'created_at'],\n    ['Last Version', 'last_version_date'],\n    ...(search !== '' && search !== null ? [['Search', 'search']] : [])\n  ];\n</script>\n\n<div class=\"ml-auto flex flex-wrap justify-between items-center mb-5\">\n  {#if newMod && $user !== null}\n    <Button variant=\"outlined\" href=\"{base}/new-mod\">New Mod</Button>\n  {/if}\n\n  {#if showSearch}\n    <div class=\"search-container flex flex-wrap sm:px-4\">\n      <div class=\"mr-3\">\n        <Select bind:value={orderBy} label=\"Order By\">\n          {#each orderFields as orderField}\n            <Option value={orderField[1]}>{orderField[0]}</Option>\n          {/each}\n        </Select>\n      </div>\n      <div class=\"mr-3\">\n        <Select bind:value={order} label=\"Order\">\n          <Option value=\"asc\">Ascending</Option>\n          <Option value=\"desc\">Descending</Option>\n        </Select>\n      </div>\n      <Paper class=\"search-paper mr-3\" elevation={6}>\n        <Icon class=\"material-icons\">search</Icon>\n        <Input bind:value={searchField} on:keypress={handleKeyDown} placeholder=\"Search\" />\n      </Paper>\n      <Fab on:click={() => goto(base + '/mods?q=' + search)} color=\"primary\" mini class=\"solo-fab\" aria-label=\"Search\">\n        <Icon class=\"material-icons\">arrow_forward</Icon>\n      </Fab>\n    </div>\n  {/if}\n\n  <div>\n    <PageControls totalPages={Math.ceil(totalMods / perPage)} currentPage={page} />\n  </div>\n</div>\n\n{#if $mods.fetching}\n  <div class=\"grid {gridClasses} gap-4\">\n    {#each Array(perPage) as _}\n      <FicsitCard fake />\n    {/each}\n  </div>\n{:else if $mods.error}\n  <p>Oh no... {$mods.error.message}</p>\n{:else}\n  <div class=\"grid {gridClasses} gap-4\">\n    {#each $mods.data.getMods.mods as mod}\n      <ModCard {mod} />\n    {/each}\n  </div>\n{/if}\n\n<div class=\"mt-5 ml-auto flex justify-end\">\n  <div>\n    <PageControls totalPages={Math.ceil(totalMods / perPage)} currentPage={page} />\n  </div>\n</div>\n\n<style>\n  .search-container {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-grow: 1;\n  }\n\n  * :global(.search-paper) {\n    display: flex;\n    align-items: center;\n    flex-grow: 1;\n    max-width: 600px;\n    height: 48px;\n  }\n\n  * :global(.search-paper > *) {\n    display: inline-block;\n    margin: 0 12px;\n  }\n</style>\n","<script lang=\"ts\">\n  import ModGrid from '$lib/components/mods/ModGrid.svelte';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n</script>\n\n<svelte:head>\n  <MetaDescriptors description=\"Mods available from the Satisfactory Mod Repository\" title=\"Mods\" />\n</svelte:head>\n\n<ModGrid showSearch={true} newMod={true} colCount={4} />\n"],"names":["page","get"],"mappings":"mxCAoIsC,oTAAe,uBAAA,gLAMzB,wBAAA,+IAOA,yBAAA,0GAKsB,ytBAd9C,SACE,0BAOA,yJANsB,qGAOA,kYALe,MAAW,mFAAX,MAAW,oFAA3B,MAAW,wJAAX,MAAW,oKADrB,0BAAL,qQAAK,uBAAL,+HAAA,8DAAA,wJAOkB,yBAAA,kFACC,0BAAA,yoBAIM,sBAAA,oNACV,yBAAA,sEAA0B,sPAA1B,qMAGU,6BAAA,mZAoB1B,KAAM,KAAK,QAAQ,0BAAxB,0QADc,sCAAlB,+EACS,KAAM,KAAK,QAAQ,uBAAxB,uHAAA,8DADc,4EACd,6IAHS,KAAM,MAAM,qCAAtB,0EAAA,uFAAH,+CAAa,KAAM,MAAM,wEALhB,MAAM,wBAAX,mOADc,sCAAlB,+FAAkB,4EACd,2nBApCC,MAAU,QAAU,cAIpB,wCA0BuB,KAAK,KAAK,KAAY,eAAuB,uDAItE,MAAM,WAMD,KAAM,mEAYc,KAAK,KAAK,KAAY,eAAuB,6pBArD3E,qDA8BE,iDAqBF,SACE,gCAnDK,MAAU,QAAU,uGAIpB,uIA0BuB,KAAK,KAAK,KAAY,4LAsBtB,KAAK,KAAK,KAAY,sOA7J5C,GAAU,kFAPL,WAAkB,MAClB,SAAS,OACT,aAAa,MAEpB,EAAS,EAAW,IAAI,aAAa,IAAI,KAIzC,EAAe,GAAM,KACrB,EAAqB,EAAU,qBAE7B,GAAO,GAAe,IAAmB,OAAQ,EAAG,MAAO,EAAS,SAAQ,QAAO,oCAEnFA,GAAO,GAAiB,SAAS,EAAW,IAAI,aAAa,IAAI,KAAM,KAAO,MAChF,GAEA,EAAc,EAuBd,OAqBE,cAEI,MAEN,EAAO,EAAOC,GAAID,GAEd,IAAgB,IAAM,IAAgB,MACxC,GAAO,EAAO,QAGV,IAAc,OAAO,KAAK,GAC7B,IAAK,IAAQ,GAAM,IAAM,mBAAmB,EAAO,MACnD,KAAK,KAER,GAAK,GAAO,SAAW,MAI3BA,EAAK,UAAW,QACd,EAAM,UAAU,OAAU,GAAI,GAAK,KACnC,EAAM,YACN,MAKF,GAAM,QAOA,GAAiB,IAChB,EAAwB,MAAQ,SACnC,mBAwBsB,+CAOA,yBAOD,wBAEA,GAAK,GAAO,WAAa,uKA9FhD,cAAa,QACb,EAAQ,gBACF,GAAe,EAAY,OAAS,EACjC,MAAW,IAAM,IAAW,OAAS,IAAgB,IAAM,IAAgB,WAC9E,EAAU,EAAU,QACpBA,EAAK,IAAI,QAGX,EAAS,IACA,KAAgB,IAAM,IAAgB,OAC3C,MAAY,EAAU,SAAW,QACnC,EAAU,EAAU,qBAGtB,EAAS,QAEV,4BAvCC,GAAU,GACV,EAAM,UAAU,SAAW,GAC7B,GAAU,OACV,EAAM,UAAU,OAAS,MAGvB,EAAM,UAAU,QAAU,GAC5B,GAAU,OACV,EAAM,UAAU,MAAQ,MAGtB,EAAM,UAAU,UAAY,GAAW,GACzC,GAAU,OACV,EAAM,UAAU,QAAU,MAGxB,GACF,EAAM,kCAiDP,EAAY,GAAO,MAAM,SAAS,OAAS,4BAI3C,EACD,GAAY,EACR,6DACA,oEAQH,IACA,OAAQ,SACR,QAAS,UACT,YAAa,cACb,kBAAmB,YACnB,yBAA0B,eAC1B,gBAAiB,eACjB,eAAgB,wBACb,IAAW,IAAM,IAAW,OAAS,SAAU,8UCrHlC,UAAc,YAAgB"}
{"version":3,"file":"20.CaPVO5bI.js","sources":["../../../../../../src/routes/mod/[modId]/version/[versionId]/edit/+page.ts","../../../../../../src/routes/mod/[modId]/version/[versionId]/edit/+page.svelte"],"sourcesContent":["import type { PageLoad } from './$types';\n\nexport const load: PageLoad = async ({ params }) => ({\n  ...params\n});\n","<script lang=\"ts\">\n  import { queryStore, getContextClient } from '@urql/svelte';\n  import { GetModVersionDocument, UpdateVersionDocument } from '$lib/generated';\n  import { goto } from '$app/navigation';\n  import VersionForm from '$lib/components/versions/VersionForm.svelte';\n  import type { VersionData } from '$lib/models/versions';\n  import { base } from '$app/paths';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n  import type { PageData } from './$types';\n  import { getModalStore, getToastStore, type ModalSettings } from '@skeletonlabs/skeleton';\n\n  export let data: PageData;\n\n  $: ({ modId, versionId } = data);\n\n  const client = getContextClient();\n\n  const toastStore = getToastStore();\n\n  $: version = queryStore({\n    query: GetModVersionDocument,\n    client,\n    variables: { version: versionId }\n  });\n\n  const onSubmit = async (versionData: VersionData) =>\n    client\n      .mutation(UpdateVersionDocument, {\n        versionId: versionId,\n        version: versionData\n      })\n      .toPromise()\n      .then((value) => {\n        if (value.error) {\n          console.error(value.error.message);\n          toastStore.trigger({\n            message: 'Error editing version: ' + value.error.message,\n            background: 'variant-filled-error',\n            autohide: false\n          });\n        } else {\n          toastStore.trigger({\n            message: `Version updated`,\n            background: 'variant-filled-success',\n            timeout: 5000\n          });\n          return goto(base + '/mod/' + modId + '/version/' + versionId);\n        }\n      });\n\n  $: initialValues = $version.data\n    ? {\n        ...$version.data.getVersion,\n        logo: undefined\n      }\n    : undefined;\n\n  const goBackFn = () => {\n    goto(base + '/mod/' + modId + '/version/' + versionId);\n  };\n\n  const backModal: ModalSettings = {\n    type: 'confirm',\n    title: 'Go Back?',\n    buttonTextCancel: 'Keep Editing',\n    buttonTextConfirm: 'Go Back',\n    body: 'Going back will discard any unsaved changes. Are you sure you wish to continue?',\n    response: (r: boolean) => {\n      if (r) {\n        goBackFn();\n      }\n    }\n  };\n\n  const modalStore = getModalStore();\n</script>\n\n<svelte:head>\n  {#if !$version.fetching && !$version.error && $version.data.getVersion}\n    <MetaDescriptors\n      description=\"Editing mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\"\n      title=\"Edit mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\" />\n  {/if}\n</svelte:head>\n\n<div class=\"flex h-auto flex-wrap items-center justify-between\">\n  <h1 class=\"my-4 text-4xl font-bold\">Edit Version</h1>\n  <div>\n    <button class=\"variant-ghost-primary btn\" on:click={() => modalStore.trigger(backModal)}>\n      <span class=\"material-icons pr-2\">arrow_back</span>\n      Back to Versions</button>\n  </div>\n</div>\n\n<div class=\"card p-4\">\n  <section>\n    {#if $version.fetching}\n      <p>Loading...</p>\n    {:else if $version.error}\n      <p>Oh no... {$version.error.message}</p>\n    {:else}\n      <VersionForm\n        {onSubmit}\n        {initialValues}\n        modReference={$version.data.getVersion.mod.mod_reference}\n        editing={true}\n        submitText=\"Save\"\n        submitIcon=\"save\" />\n    {/if}\n  </section>\n</div>\n"],"names":["load","async","params","description","ctx","data","getVersion","mod","name","version","title","dirty","metadescriptors_changes","modReference","mod_reference","versionform_changes","error","message","insert_hydration_dev","target","p","anchor","set_data_dev","t1","t1_value","fetching","create_if_block_2","div1","append_hydration_dev","h1","div0","button","span","div2","section","$$props","client","getContextClient","toastStore","getToastStore","onSubmit","mutation","UpdateVersionDocument","versionId","versionData","toPromise","then","value","console","trigger","background","autohide","timeout","goto","base","modId","goBackFn","backModal","type","buttonTextCancel","buttonTextConfirm","body","response","r","modalStore","getModalStore","$$invalidate","$$subscribe_version","queryStore","query","GetModVersionDocument","variables","initialValues","$version","logo","undefined"],"mappings":"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"}